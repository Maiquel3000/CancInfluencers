<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Título Cambiado a CANCINFLUENCERS -->
    <title>CancInfluencers</title>
    <!-- Favicon Añadido -->
    <link rel="icon" type="image/x-icon" href="https://i.imgur.com/qQ7aGbv.png">
    <style>

            :root {
        --tier-s-color: #ff7f7f;
        --tier-a-color: #ffbf7f;
        --tier-b-color: #ffff7f;
        --tier-c-color: #7fff7f;
        --tier-d-color: #7fffff;
        --tier-f-color: #7f7fff;
    }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            /* Flexbox para centrar el logo y el título verticalmente */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Estilo para el logo añadido */
        .header-logo {
            max-height: 60px;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 10px rgba(168, 85, 247, 0.5));
            transition: transform 0.3s ease;
        }

        .header-logo:hover {
            transform: scale(1.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #a855f7, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #d1d5db;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px; /* Reducido un poco para que quepan mejor */
            margin-bottom: 30px;
            flex-wrap: nowrap; /* FUERZA a estar en una sola línea */
        }

        .search-input {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            background-color: #374151;
            color: white;
            width: 250px;
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #a855f7;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .shuffle-btn {
            background: linear-gradient(to right, #a855f7, #ec4899);
            color: white;
        }

        .shuffle-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        .add-btn {
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
        }

        .add-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .tierlist-btn {
            background: linear-gradient(to right, #f59e0b, #d97706);
            color: white;
        }

        .tierlist-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .card-container {
            position: relative;
            width: 100%;
            height: 300px;
            perspective: 1000px;
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s;
            cursor: pointer;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.animating {
            animation: flipToCenter 0.8s ease-in-out forwards;
        }

        @keyframes flipToCenter {
            0% {
                transform: rotateY(0deg) scale(1);
            }
            50% {
                transform: rotateY(90deg) scale(1.1);
            }
            100% {
                transform: rotateY(180deg) scale(1);
            }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            user-select: none;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            text-align: center;
            user-select: none;
        }

        .card-front:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46a1 100%);
        }

        .music-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .card-front-text {
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }

        .card-front-subtext {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .card-back {
            background-color: #1f2937;
            transform: rotateY(180deg);
            display: flex;
            flex-direction: column;
        }

        .influencer-header {
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            padding: 10px;
            text-align: center;
        }

        .influencer-name {
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .influencer-feat {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8); /* Blanco un poco transparente */
            font-weight: normal;
            margin-top: -2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .video-container {
            flex-grow: 1;
            position: relative;
            background-color: black;
        }

        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
        }

        .play-button::after {
            content: "▶";
            font-size: 20px;
            color: #333;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 600px;
            background-color: #1f2937;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease-in-out;
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            z-index: 10;
        }

        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }

        .modal-video {
            flex-grow: 1;
            background-color: black;
            position: relative;
        }

        .modal-video iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

                /* Estilo para el modal de video cuando está sobre la tierlist */
        .modal.on-top-of-tierlist {
            z-index: 1001; /* Un nivel por encima del modal de la tierlist */
            background-color: rgba(0, 0, 0, 0.4); /* Fondo más transparente para ver la tierlist */
        }

        /* Asegura que el contenido del modal siga siendo opaco y legible */
        .modal.on-top-of-tierlist .modal-content {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7); /* Sombra más fuerte para resaltar */
        }

        .tier-selection-panel {
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tier-selection-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: #d1d5db;
        }

        .tier-options {
            display: flex;
            justify-content: center;
            gap: 8px; /* Mantenemos el espacio entre botones */
            margin-bottom: 10px;
            flex-wrap: wrap; /* Permite que los botones se envuelvan a la siguiente línea si no caben */
            max-width: 100%; /* Asegura que no desborde el contenedor */
        }

    .tier-option {
        width: auto; /* Cambiado de 40px a auto para que se ajuste al contenido */
        min-width: 50px; /* Ancho mínimo para que no sean demasiado pequeños */
        max-width: 120px; /* Ancho máximo para evitar que sean demasiado grandes */
        height: 40px; /* Mantenemos la altura fija */
        padding: 0 12px; /* Añadimos padding horizontal para dar espacio al texto */
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1rem;
        color: white;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        white-space: nowrap; /* Evita que el texto se divida en múltiples líneas */
        overflow: hidden; /* Oculta el texto que desborda */
        text-overflow: ellipsis; /* Muestra "..." si el texto es demasiado largo */
        border: none;         /* 1. Quita el borde feo por defecto del button */
        outline: none;        /* 2. Quita el outline por defecto */
        background-color: transparent; /* Asegura que no tenga fondo gris extra */
    }

        .tier-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tier-option.selected {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px white;
        }
        .tier-option:focus {
            /* IMPORTANTE: Ponemos 'none' para que NO se marque al hacer clic con ratón */
            outline: none;
            /* Opcional: Puedes dejar la escala si quieres feedback táctil */
            transform: scale(1.05);
        }

        /* Comportamiento al usar TECLADO (Tabulador) */
        .tier-option:focus-visible {
            /* Aquí SÍ queremos el marco para usuarios de teclado */
            outline: 3px solid white;
            outline-offset: 2px;
        }

        .tier-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tier-option.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        .tier-s { background-color: var(--tier-s-color); }
        .tier-a { background-color: var(--tier-a-color); }
        .tier-b { background-color: var(--tier-b-color); }
        .tier-c { background-color: var(--tier-c-color); }
        .tier-d { background-color: var(--tier-d-color); }
        .tier-f { background-color: var(--tier-f-color); }

        .tier-selection-status {
            text-align: center;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .tier-selection-status.success {
            color: #10b981;
        }

        /* Modal para añadir influencer */
        .add-modal-content {
            width: 100%;
            max-width: 500px;
            background-color: #1f2937;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }


        .add-modal-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
            flex-shrink: 0; /* Evita que el botón se encoja */
        }

        .add-modal-title {
            flex-grow: 1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(to right, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #d1d5db;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #374151;
            background-color: #374151;
            color: white;
            font-size: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }

        .form-input::placeholder {
            color: #9ca3af;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .form-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .submit-btn {
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
        }

        .submit-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .cancel-btn {
            background-color: #374151;
            color: white;
        }

        .cancel-btn:hover {
            background-color: #4b5563;
            transform: scale(1.02);
        }

        .error-message {
            color: #ef4444;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            background-color: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }

        /* Toggle para canciones de fans */
        .fans-toggle-container {
            margin: 40px 0;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(236, 72, 153, 0.1));
            border-radius: 16px;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .fans-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .fans-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: #d1d5db;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background-color: #374151;
            border-radius: 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background: linear-gradient(to right, #a855f7, #ec4899);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .fans-count {
            font-size: 0.9rem;
            color: #9ca3af;
            margin-top: 10px;
        }

        .fans-section {
            margin-top: 20px;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease-in-out, max-height 0.5s ease-in-out;
        }

        .fans-section.active {
            opacity: 1;
            max-height: 2000px;
        }

        .fans-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(to right, #f59e0b, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #9ca3af;
            font-size: 0.9rem;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .creator-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            color: #d1d5db;
        }

        .creator-name {
            font-weight: bold;
            color: #a855f7;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #e1306c, #c13584);
            border-radius: 50%;
            color: white;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .social-link:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .social-link svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .card.revealed .card-front {
            opacity: 0.7;
        }
        
        .card.revealed .music-icon {
            animation: none;
        }

/* Modal para ver tierlist */
.tierlist-modal-content {
    width: 95%;
    max-width: 1200px;
    height: 95vh; /* Ocupa casi toda la altura de la ventana */
    background-color: #1f2937;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    display: flex; /* Activa Flexbox para el contenido del modal */
    flex-direction: column; /* Alinea los elementos en columna */
    overflow: hidden; /* Evita que cualquier hijo se salga del modal */
    position: relative;
}

.tierlist-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    flex-shrink: 0; /* Evita que el encabezado se encoja */
}

.tierlist-title {
    font-size: 1.5rem;
    font-weight: bold;
    background: linear-gradient(to right, #f59e0b, #d97706);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.tierlist-actions {
    display: flex;
    gap: 10px;
}

.edit-tiers-btn {
    background: linear-gradient(to right, #8b5cf6, #6366f1);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: transform 0.2s, box-shadow 0.2s;
}

.edit-tiers-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
}

.tier-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 15px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    flex-shrink: 0; /* Evita que las estadísticas se encojan */
}

.tier-stat {
    text-align: center;
}

.tier-stat-number {
    font-size: 1.2rem;
    font-weight: bold;
    color: #f59e0b;
}

.tier-stat-label {
    font-size: 0.8rem;
    color: #d1d5db;
}

.reorder-hint {
    text-align: center;
    color: #9ca3af;
    font-size: 0.8rem;
    margin-bottom: 10px;
    font-style: italic;
    flex-shrink: 0; /* Evita que la pista se encoja */
}

/* ESTE ES EL CONTENEDOR CLAVE */
.tierlist-container {
    flex-grow: 1; /* ¡CLAVE! Ocupa todo el espacio vertical restante */
    display: flex;
    flex-direction: column;
    overflow-y: auto; /* ¡CLAVE! Reactiva el scroll vertical */
    padding-right: 10px; /* Espacio para la barra de scroll */
    min-height: 0; /* ¡CLAVE! Permite que los hijos flexibles se encojan por debajo de su tamaño de contenido */
}

/* ESTILOS PARA LA BARRA DE SCROLL */
.tierlist-container::-webkit-scrollbar {
    width: 8px;
}

.tierlist-container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

.tierlist-container::-webkit-scrollbar-thumb {
    background: linear-gradient(to right, #f59e0b, #d97706);
    border-radius: 4px;
}

.tierlist-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(to right, #d97706, #b45309);
}

/* CADA FILA DE TIER SE ADJUSTARÁ */
.tier-row {
    display: flex;
    /* ¡CLAVE! Todas las filas crecerán por igual para llenar el espacio disponible */
    flex-grow: 1;
    flex-shrink: 1; /* Permite que las filas se encojan si es necesario */
    margin-bottom: 5px;
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    min-height: 60px; /* Altura mínima para que no sean demasiado pequeñas */
}

.tier-row.drag-over {
    background-color: rgba(255, 255, 255, 0.1);
}

.tier-label {
    width: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1rem;
    color: white;
    flex-shrink: 0; /* La etiqueta no cambia de tamaño */
}


/* EL CONTENEDOR DE ITEMS SE AJUSTA A LA ALTURA DE SU FILA */
.tier-items {
    flex-grow: 1; /* Ocupa el ancho restante de la fila */
    background-color: rgba(255, 255, 255, 0.1);
    display: flex;
    flex-wrap: wrap;
    align-items: center; /* Centra los items verticalmente */
    padding: 5px;
    gap: 5px;
    overflow: auto; /* Permite scroll si hay muchos items en una fila */
}

/* Estilo específico para la etiqueta "Sin Clasificar" */
.tier-row .tier-label {
    width: 7%; /* Ancho porcentual como solicitaste */
    height: auto; /* Permite que la altura sea automática */
    min-height: 80px; /* Altura mínima para que no sea demasiado pequeña */
    
    /* --- FUENTE DINÁMICA (LA CLAVE PARA QUE NO SE ESCAPE) --- */
    font-size: clamp(0.6rem, 1.5vw, 0.9rem); /* Ajusta el tamaño de letra según el espacio */
    line-height: 1.2; /* Espaciado entre líneas ajustado */
    
    text-align: center; /* Centra el texto horizontalmente */
    white-space: normal; /* Permite que el texto se divida en líneas */
    overflow-wrap: break-word; /* Rompe palabras largas si es necesario */
    word-break: break-word; /* Asegura el corte en navegadores antiguos */
    padding: 5px; /* Un pequeño padding para que no toque los bordes */
    
    /* Usamos Flexbox para centrar perfectamente el contenido */
    display: flex;
    flex-direction: column;
    justify-content: center; /* Centra verticalmente el bloque de texto */
    align-items: center; /* Centra horizontalmente el bloque de texto */
    flex-shrink: 0; /* Evita que la etiqueta se encoja */
}

/* ESTILOS PARA EL SCROLL DENTRO DE CADA FILA */
.tier-items::-webkit-scrollbar {
    height: 6px;
}

.tier-items::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 3px;
}

.tier-items::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px;
}

.tier-item {
    background-color: #374151;
    border-radius: 6px;
    padding: 4px 8px;
    display: flex;
    align-items: center;
    gap: 6px;
    max-width: 180px;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: move;
    position: relative;
    height: 45px;
    flex-shrink: 0; /* Evita que los items se encojan */
    cursor: default; /* Cambia el cursor a una mano para indicar que es clicable */
    transition: transform 0.2s, box-shadow 0.2s, border 0.2s; /* Añadimos 'border' a la transición */
    border: 1px solid transparent; /* Borde transparente por defecto */
}

.tier-item:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.4); /* Añade un borde sutil al pasar el ratón */
}

.tier-item.dragging {
    opacity: 0.5;
    transform: rotate(5deg);
}

.tier-item-thumbnail {
    width: 30px;
    height: 30px;
    border-radius: 4px;
    object-fit: cover;
}

.tier-item-name {
    font-size: 0.8rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.tier-item-remove {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 18px;
    height: 18px;
    background-color: #ef4444;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 11px;
    color: white;
    opacity: 0;
    transition: opacity 0.2s;
}

.tier-item:hover .tier-item-remove {
    opacity: 1;
}

.empty-tierlist {
    text-align: center;
    padding: 40px;
    color: #9ca3af;
}

.empty-tierlist-icon {
    font-size: 3rem;
    margin-bottom: 15px;
}

        /* Modal para editar tiers */
        .edit-tiers-modal-content {
            width: 100%;
            max-width: 600px;
            background-color: #1f2937;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .edit-tiers-header {
            margin-bottom: 25px;
            text-align: center;
        }

        .edit-tiers-title {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(to right, #8b5cf6, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .edit-tiers-subtitle {
            color: #9ca3af;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .tier-edit-group {
            margin-bottom: 20px;
        }

        .tier-edit-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-weight: 500;
            color: #d1d5db;
        }

        .tier-color-preview {
            width: 24px;
            height: 24px;
            border-radius: 4px;
        }

        .tier-edit-input {
            width: 100%;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #374151;
            background-color: #374151;
            color: white;
            font-size: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .tier-edit-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }

        .edit-tiers-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .reset-tiers-btn {
            background-color: #374151;
            color: white;
        }

        .reset-tiers-btn:hover {
            background-color: #4b5563;
            transform: scale(1.02);
        }

        .save-tiers-btn {
            background: linear-gradient(to right, #8b5cf6, #6366f1);
            color: white;
        }

        .save-tiers-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        
        /* Estilos para el botón de categorías */
.categories-btn {
    background: linear-gradient(to right, #06b6d4, #0891b2);
    color: white;
}

.categories-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
}

/* Estilos para el filtro activo */
.active-category {
    background-color: rgba(6, 182, 212, 0.2);
    border: 1px solid #06b6d4;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.active-category-name {
    font-weight: bold;
    color: #06b6d4;
    font-size: 1.1rem;
}

.clear-filter-btn {
    background: none;
    border: 1px solid #06b6d4;
    color: #06b6d4;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 0.9rem;
    transition: background-color 0.2s, color 0.2s;
}

.clear-filter-btn:hover {
    background-color: #06b6d4;
    color: white;
}

/* Estilos para el modal de categorías */
.categories-modal-content {
    width: 95%;
    max-width: 900px;
    height: 80vh;
    background-color: #1f2937;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
}


.categories-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.categories-title {
    font-size: 1.8rem;
    font-weight: bold;
    background: linear-gradient(to right, #06b6d4, #0891b2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Estilos para el contenedor de categorías - VERSIÓN GRID */
.categories-container {
    flex-grow: 1;
    display: grid;
    place-items: center;
    justify-items: start;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Columnas automáticas de mínimo 150px */
    gap: 12px; /* Espacio entre botones */
    overflow-y: auto;
    padding-right: 10px;
    align-content: start; /* Alinea el contenido arriba */
}

.categories-container::-webkit-scrollbar {
    width: 8px;
}

.categories-container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

.categories-container::-webkit-scrollbar-thumb {
    background: linear-gradient(to right, #06b6d4, #0891b2);
    border-radius: 4px;
}

.categories-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(to right, #0891b2, #0e7490);
}

.category-header-btn {
    width: 100%;
    
    /* CAMBIO CLAVE: Usamos padding fijo en píxeles, NO porcentaje.
       El porcentaje (25%) hacía el botón gigante y desproporcionado. */
    padding: 44px 10px; 
    display: flex;
    flex-direction: column; /* Hace que el título y el contador se apilen verticalmente */
    align-items: center;     /* Centra horizontalmente ambas líneas */
    justify-content: center; /* Centra verticalmente el contenido en el botón */
    text-align: center;      /* Asegura que si el texto es largo, se centre línea por línea */
    background: linear-gradient(to right, #374151, #4b5563);
    color: white;
    font-weight: bold;
    font-size: 1rem;
    cursor: pointer;
    border: none;
    border-radius: 12px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    min-height: 70px; /* Altura mínima para que quepan dos líneas cómodas */
}

/* Aseguramos que los spans internos hereden bien la alineación */
.category-name {
    line-height: 1.2;
    margin-bottom: 4px; /* Pequeño espacio entre título y número */
}

.category-count {
    display: block;
    font-size: 0.75rem;
    font-weight: normal;
    color: rgba(255, 255, 255, 0.7);
}

.category-header-btn:hover {
    background: linear-gradient(to right, #4b5563, #6b7280);
    transform: scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.category-header-btn:active {
    transform: scale(0.98);
}

.category-header-btn.selected {
    background: linear-gradient(to right, #06b6d4, #0891b2);
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.5);
}

.category-header-btn.selected:hover {
    background: linear-gradient(to right, #0891b2, #0e7490);
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.7);
}

.category-header-btn.all-btn {
    background: linear-gradient(to right, #10b981, #059669);
}

.category-header-btn.all-btn.selected {
    background: linear-gradient(to right, #059669, #047857);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.5);
}

.category-header-btn.all-btn:hover {
    background: linear-gradient(to right, #059669, #047857);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
}

.category-header-btn.all-btn.selected:hover {
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.7);
}

.category-header-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.category-header-btn:hover::before {
    left: 100%;
}

.category-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.apply-filters-btn {
    flex: 1;
    padding: 12px 20px;
    background: linear-gradient(to right, #06b6d4, #0891b2);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.apply-filters-btn:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
}

.clear-all-btn {
    padding: 12px 20px;
    background-color: #374151;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.2s;
}

.clear-all-btn:hover {
    background-color: #4b5563;
    transform: scale(1.02);
}

.category-stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
}

.category-stat {
    text-align: center;
}

.category-stat-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: #06b6d4;
}

.category-stat-label {
    font-size: 0.9rem;
    color: #d1d5db;
}

.filter-info {
    text-align: center;
    color: #9ca3af;
    font-size: 0.9rem;
    margin-top: 10px;
    font-style: italic;
}

.selected-count {
    background-color: rgba(6, 182, 212, 0.2);
    border: 1px solid #06b6d4;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 15px;
    text-align: center;
    font-weight: bold;
    color: #06b6d4;
}

/* ESTILOS PARA LAS NOTIFICACIONES (ACTUALIZADOS) */
.notification {
    position: fixed;
    top: 20px;          /* Posicionado arriba */
    right: 20px;        /* Posicionado a la derecha */
    background: linear-gradient(to right, #10b981, #059669); /* Fondo verde */
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4); /* Sombra verde para combinar */
    z-index: 2000;       /* Asegura que esté por encima de todo */
    opacity: 0;          /* Oculto por defecto */
    transform: translateY(-20px); /* Posición inicial, un poco más arriba */
    transition: opacity 0.4s ease, transform 0.4s ease; /* Animación suave */
    font-weight: bold;
    font-size: 0.95rem;
    max-width: 300px;
    pointer-events: none; /* Evita que la notificación bloquee clics */
}

.notification.show {
    opacity: 1;          /* Visible */
    transform: translateY(0); /* Posición final, en su lugar */
}

.reset-app-btn-icon {
    background: #374151; /* Color gris sutil */
    border: none;
    border-radius: 50%; /* Lo hace circular */
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #9ca3af; /* Color de icono grisáceo */
    transition: all 0.2s ease;
    flex-shrink: 0; /* Evita que el botón se encoja */
    margin-top: 10px; /* Lo baja un poco para alinearlo visualmente con el título */
}

.reset-app-btn-icon:hover {
    background: #ef4444; /* Se vuelve rojo al pasar el ratón (peligro) */
    color: white;
    transform: scale(1.1);
}

/* Estilos para el botón de revelar todas las cartas */
.reveal-all-btn {
    background: linear-gradient(to right, #ec4899, #db2777);
    color: white;
}

.reveal-all-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4);
}

        /* Filter Logic Toggle Styles */
        .filter-logic-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 12px;
        }

        .logic-label {
            font-size: 0.95rem;
            font-weight: bold;
            color: #9ca3af;
            transition: color 0.3s;
        }

        .logic-label.active {
            color: #06b6d4;
        }

        .logic-switch {
            position: relative;
            width: 70px;
            height: 34px;
            background-color: #374151;
            border-radius: 17px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: 2px solid #4b5563;
        }

        .logic-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 26px;
            height: 26px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: #374151;
        }

        /* State: AND is active (slider right) */
        .logic-switch.and-active {
            background-color: #06b6d4;
            border-color: #06b6d4;
        }

        .logic-switch.and-active .logic-slider {
            transform: translateX(36px);
            color: #06b6d4; /* Icon color matches background */
        }
        
        /* State: OR is active (slider left - default) */
        .logic-switch.or-active .logic-slider {
             color: #10b981; /* Icon color for OR */
        }

                /* Estilos para el botón de exportar imagen */
        .export-image-btn {
            background: linear-gradient(to right, #ec4899, #be185d);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .export-image-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4);
        }

                /* Estilos para el botón de compartir código */
        .share-code-btn {
            background: linear-gradient(to right, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .share-code-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* Modal para compartir/importar código */
        .share-modal-content {
            width: 100%;
            max-width: 500px;
            background-color: #1f2937;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .share-section {
            margin-bottom: 25px;
        }

        .share-section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #d1d5db;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #374151;
            background-color: #111827;
            color: white;
            font-family: monospace;
            font-size: 0.8rem;
            resize: none;
            margin-bottom: 10px;
        }

        .share-textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .copy-btn {
            flex: 1;
            padding: 10px;
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .copy-btn:hover {
            transform: scale(1.02);
        }

        .import-btn {
            flex: 1;
            padding: 10px;
            background: linear-gradient(to right, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .import-btn:hover {
            transform: scale(1.02);
        }

                /* --- ESTILOS PACK OPENING (CONFETI Y ANIMACIÓN) --- */
        
        /* Canvas para el confeti (pantalla completa) */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* Animación de volteo rápido para pack opening */
        .card.pack-flip {
            animation: packFlip 0.6s ease-out forwards;
        }

        @keyframes packFlip {
            0% { transform: rotateY(0deg) scale(1); }
            50% { transform: rotateY(90deg) scale(1.2); }
            100% { transform: rotateY(180deg) scale(1); }
        }

        /* Partículas de explosión detrás de la carta */
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            animation: particleFade 0.8s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        /* Efecto de "Brillo" momentáneo en la carta al revelarse */
        .card.pack-flash::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            opacity: 0;
            animation: flashEffect 0.5s ease-out;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes flashEffect {
            0% { opacity: 1; transform: scale(0.5); }
            100% { opacity: 0; transform: scale(1.5); }
        }
                /* Estilos para Calculadora de Match */
        .match-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(to right, #ec4899, #be185d); /* Rosa para el amor ❤️ */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            margin-top: 5px;
        }

        .match-btn:hover {
            transform: scale(1.02);
        }

        .match-result {
            margin-top: 15px;
            text-align: center;
            background: rgba(236, 72, 153, 0.1);
            border: 1px solid rgba(236, 72, 153, 0.3);
            border-radius: 8px;
            padding: 15px;
        }

        .match-percentage {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(to right, #ec4899, #f43f5e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .match-details {
            font-size: 0.9rem;
            color: #d1d5db;
        }

                /* --- BOTÓN FLOTANTE DE SUGERENCIAS --- */
        .suggestion-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); /* Azul distintivo */
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none; /* Es un enlace */
            font-size: 1.8rem;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.5);
            z-index: 999; /* Debajo de modales pero encima de todo */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .suggestion-btn:hover {
            transform: scale(1.15) rotate(-5deg);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        /* Tooltip (texto que aparece al pasar el ratón) */
        .suggestion-tooltip {
            position: absolute;
            left: 75px;
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: bold;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateX(-10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .suggestion-btn:hover .suggestion-tooltip {
            opacity: 1;
            transform: translateX(0);
        }

        /* Responsivo: Ajustar posición en móvil */
        @media (max-width: 600px) {
            .suggestion-btn {
                bottom: 20px;
                left: 20px;
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            .suggestion-tooltip {
                display: none; /* En móvil ocultamos el texto para no molestar */
            }
        }

                /* =============================================== */
        /* ESTILOS MODAL SUGERENCIAS (WCAG AA) */
        /* =============================================== */
        
        /* Contenedor del Modal */
        #suggestionModal .modal-content {
            max-width: 800px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-primary);
        }

        /* Cabecera: Usamos Blue-600 -> Violet-600 para asegurar contraste > 4.5:1 con texto blanco */
        #suggestionModal .modal-header {
            background: linear-gradient(to right, #2563eb, #7c3aed);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        #suggestionModal .modal-title {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--text-primary); /* Blanco */
        }

        /* Cuerpo: Fondo blanco para el formulario de Google */
        #suggestionModal .modal-body {
            flex-grow: 1;
            padding: 0;
            position: relative;
            background-color: #ffffff;
            border-radius: 0 0 16px 16px; /* Redondeado abajo */
            overflow: hidden; /* Para que el iframe no se salga */
        }

        /* Iframe */
        #suggestionModal iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

                /* =============================================== */
        /* ACCESIBILIDAD (A11y) - WCAG 2.1 */
        /* =============================================== */

        /* Skip Link - Navegación con teclado */
        .skip-link {
            position: absolute;
            top: -100px;
            left: 0;
            background: #a855f7;
            color: white;
            padding: 10px 20px;
            z-index: 9999;
            transition: top 0.3s;
            text-decoration: none;
            border-radius: 0 0 8px 0;
            font-weight: bold;
        }
        .skip-link:focus {
            top: 0;
        }

        /* Focus Visible - Indicador claro */
        *:focus-visible {
            outline: 3px solid #06b6d4;
            outline-offset: 2px;
        }
        .btn:focus { outline: 3px solid rgba(255, 255, 255, 0.5); outline-offset: 2px; }
        .card:focus { outline: none }
        /* Comportamiento al usar TECLADO (Tab) */
        .card:focus-visible {
            outline: 3px solid #a855f7; /* Marco morado SOLO con teclado */
            outline-offset: 2px;
        }
        
        /* Reducción de Movimiento */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .music-icon { animation: none; }
            .particle { display: none; } /* Oculta partículas para usuarios sensibles */
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            .btn, .card-face, .modal-content {
                border: 2px solid white;
            }
        }
        
                /* =============================================== */
        /* SISTEMA DE LOGROS - ESTILOS */
        /* =============================================== */

        /* Modal de logros */
        .achievements-modal-content {
        max-width: 600px;
        height: 85vh; /* Altura grande: 85% de la pantalla */
        background-color: #1f2937;
        display: flex;       /* Necesario para el layout interno */
        flex-direction: column; /* Apila header y body verticalmente */
       }   

        .achievements-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .achievements-count {
            font-size: 3rem;
            margin-bottom: 5px;
            background: linear-gradient(to right, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .achievements-subtitle {
            color: #9ca3af;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            flex-grow: 1;      /* Hace que el grid llene el resto del modal */
            overflow-y: auto;  /* Activa el scroll interno si hay muchos logros */
            min-height: 0;     /* Corrección técnica para flexbox */
            padding-right: 5px;
        }

        /* Tarjeta de logro individual */
        .achievement-card {
            background: #374151;
            border-radius: 12px;
            padding: 15px;
            display: flex;
            gap: 12px;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .achievement-card:hover {
            transform: scale(1.02);
        }

        .achievement-card.unlocked {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.1));
        }

        /* Icono del logro */
        .achievement-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            flex-shrink: 0;
            user-select: none;
        }

        .achievement-card.unlocked .achievement-icon {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* Informacion del logro */
        .achievement-info {
            flex: 1;
            min-width: 0;
        }

        .achievement-name {
            font-weight: bold;
            margin-bottom: 4px;
            color: #ffffff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .achievement-description {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        /* Barra de progreso del logro */
        .achievement-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(to right, #f59e0b, #d97706);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .achievement-progress-text {
            font-size: 0.75rem;
            color: #78716c;
            margin-top: 4px;
            text-align: right;
        }

        /* =============================================== */
        /* POPUP DE LOGRO DESBLOQUEADO */
        /* =============================================== */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.4);
            z-index: 3000; /* Por encima de todo */
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.5s ease;
            pointer-events: none;
        }

        .achievement-popup.show {
            opacity: 1;
            transform: translateX(0);
        }

        .achievement-popup-icon {
            font-size: 3rem;
        }

        .achievement-popup-text h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            font-weight: 800;
        }

        .achievement-popup-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Estilos del boton de logros */
        .achievements-btn { 
            background: linear-gradient(to right, #8b5cf6, #6366f1); 
            color: white;
        }
        .achievements-btn:hover { 
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        /* --- UNIFICAR ESTILO DE HEADER: LOGROS (VERSIÓN CON EMOJI CORRECTO) --- */
        #achievementsModal .modal-header {
            background: transparent; /* Fondo limpio */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Línea separadora */
            margin-bottom: 20px; 
            padding-bottom: 15px;
        }

        #achievementsModal .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex; /* Alinea emoji y texto */
            align-items: center;
            gap: 10px; /* Espacio entre emoji y texto */
        }

        /* Aplicamos el degradado SOLO al texto, no al emoji */
        #achievementsModal .modal-title .text-gradient {
            background: linear-gradient(to right, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

                /* Estilos para el botón de eliminar influencer */
        .delete-influencer-btn {
            width: 100%;
            margin-top: 15px;
            padding: 10px;
            background: linear-gradient(to right, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, opacity 0.2s;
        }

        .delete-influencer-btn:hover {
            transform: scale(1.02);
            opacity: 0.9;
        }

        /* --- LAYOUT SPLIT FINAL: Modal Principal (Izq) + Sidebar (Der) --- */
        #tierlistModal {
            flex-direction: row; /* Alinea el main y el sidebar en fila */
            justify-content: center;
            align-items: stretch; /* Iguala alturas */
            gap: 0; /* Sin espacio entre columnas */
        }

        /* Contenido Principal (Izquierda) */
        .tierlist-modal-main {
            width: 75%;
            max-width: 1100px;
            height: 95vh;
            background-color: #1f2937;
            border-radius: 16px 0 0 16px; /* Redondeado solo izquierda */
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* Sidebar Derecha (Gráfica) */
        .tierlist-sidebar {
            width: 320px;
            height: 95vh;
            background-color: #111827; /* Un poco más oscuro */
            border-radius: 0 16px 16px 0; /* Redondeado solo derecha */
            border-left: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
        }

        .sidebar-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #f59e0b;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        /* Contenedor de la gráfica dentro del sidebar */
        .tierlist-sidebar .tier-chart-container {
            flex-grow: 1;
            width: 100%;
            height: auto;
            background: transparent;
            border: none;
            margin: 0;
            padding: 0;
        }

        /* Responsive: En móvil, apilar verticalmente */
        @media (max-width: 1024px) {
            #tierlistModal {
                flex-direction: column; /* Pone la gráfica debajo */
                padding: 10px;
            }
            .tierlist-modal-main {
                width: 100%;
                height: 70vh;
                border-radius: 16px 16px 0 0;
            }
            .tierlist-sidebar {
                width: 100%;
                height: 30vh; /* Menos altura en móvil */
                border-radius: 0 0 16px 16px;
                border-left: none;
                border-top: 1px solid rgba(255,255,255,0.1);
            }
        }

                /* --- LEYENDA GRID PERSONALIZADA (CON CORRECCIÓN DE TEXTO) --- */
        .chart-legend-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columnas */
            gap: 8px;
            margin-top: 15px;
            width: 100%;
            padding: 0 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
            border: 1px solid transparent;
            overflow: hidden; /* Evita que el contenido se salga visualmente */
        }

        .legend-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .legend-color-box {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            flex-shrink: 0; /* El cuadrado de color nunca se encoge */
        }

        .legend-text-container {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
            overflow: hidden;
            min-width: 0; /* CLAVE: Permite que el texto se encoja dentro del flex */
        }

        .legend-label {
            font-size: 0.8rem;
            font-weight: bold;
            color: #fff;
            /* PROPIEDADES PARA CORTAR TEXTO LARGO */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* Pone los "..." al final */
        }

        .legend-value {
            font-size: 0.7rem;
            color: #9ca3af;
        }

        /* Estilo cuando se oculta un segmento */
        .legend-item.strikethrough {
            opacity: 0.4;
            text-decoration: line-through;
        }

                /* --- ESTILOS PARA MODALES DE CONFIRMACIÓN PERSONALIZADOS --- */
        .confirm-modal-content {
            background: #1f2937;
            padding: 30px;
            border-radius: 16px;
            width: 90%;
            max-width: 420px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .modal.active .confirm-modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .confirm-icon {
            font-size: 5rem;
            margin-bottom: 15px;
            line-height: 1;
            animation: bounceIn 0.6s ease;
            user-select: none;

        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .confirm-modal-content h3 {
            margin-bottom: 10px;
            font-size: 1.5rem;
            color: white;
        }

        .confirm-modal-content p {
            color: #9ca3af;
            margin-bottom: 15px;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .confirm-modal-content ul {
            text-align: left;
            margin: 10px auto 20px;
            color: #d1d5db;
            width: 80%;
            list-style: none;
            padding: 0;
        }
        
        .confirm-modal-content ul li::before {
            content: "• ";
            color: #6b7280;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

            .confirm-buttons .btn {
            flex: 1; /* Ambos ocuparán el 50% del ancho */
            padding: 12px; /* Mismo padding para igualar altura */
            justify-content: center; /* Centra el texto */
        }

        /* Variante Peligro (Reset) */
        .confirm-modal-content.danger {
            border-color: rgba(239, 68, 68, 0.3);
        }
        .danger .confirm-icon { text-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }
        .danger .warning-text { color: #fca5a5; font-size: 0.85rem; margin-top: -5px; }
        
.danger-btn {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            /* Quitamos el flex: 1 de aquí */
        }
        .danger-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        /* Variante Éxito (Reveal) */
        .confirm-modal-content.success {
            border-color: rgba(16, 185, 129, 0.3);
        }
        .success .confirm-icon { text-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
        
        .success-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            /* Quitamos el flex: 1 de aquí */
        }
        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

                /* --- MODO FIESTA PERMANENTE --- */
        
        /* Animación de fondo Arcoíris */
        @keyframes rainbowBg {
            0% { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); }
            25% { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
            50% { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
            75% { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
            100% { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); }
        }

        body.party-mode {
            animation: rainbowBg 15s ease infinite;
            background-size: 400% 400%;
        }

        /* Estrella brillante en el logo */
        body.party-mode .header-logo {
            animation: starPulse 1.5s infinite alternate;
            filter: drop-shadow(0 0 15px gold);
        }

        @keyframes starPulse {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(10deg); }
        }

        /* Texto de título con borde dorado */
        body.party-mode h1 {
            text-shadow: 2px 2px 0px #ffb700, 4px 4px 0px #ff6b6b;
            animation: textGlow 2s infinite alternate;
        }

        @keyframes textGlow {
            from { filter: brightness(1); }
            to { filter: brightness(1.3); }
        }

        /* Notificaciones especiales en modo fiesta */
        body.party-mode .notification {
            background: linear-gradient(to right, #ff6b6b, #feca57) !important;
            color: #000 !important;
            font-weight: 900 !important;
            border: 2px solid #fff;
        }

        /* Confeti CSS persistente (floaters) */
        .party-confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            animation: confettiFall linear infinite;
            z-index: 9998;
            pointer-events: none;
            opacity: 0.7;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(720deg); }
        }

                /* --- ESTILOS SIDEBAR TABS --- */
        .sidebar-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .sidebar-tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #9ca3af;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .sidebar-tab-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar-tab-btn.active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        .sidebar-tab-btn .tab-icon {
            font-size: 1.1rem;
        }

        .sidebar-content {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            min-height: 0; /* Importante para flex */
        }

        .tab-panel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            overflow-y: auto;
            padding-right: 5px; /* Espacio scrollbar */
        }

        .tab-panel.active {
            opacity: 1;
            visibility: visible;
            position: relative; /* Vuelve al flujo para que crezca si es necesario */
        }

        /* Ajustes específicos para el contenido de progreso */
        #tab-progress {
            display: flex;
            flex-direction: column;
        }

        /* --- ESTILOS CALCULADORA DE HUECOS (CORREGIDO) --- */
        .category-gaps-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
            overflow-y: auto; /* Permite scroll si es muy largo */
            padding-right: 5px;
            flex-grow: 1; /* HACE QUE OCUPE EL ESPACIO RESTANTE */
        }

        .category-gaps-container::-webkit-scrollbar {
            width: 4px;
        }
        .category-gaps-container::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 2px;
        }

        .gap-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            border-left: 3px solid #6b7280; /* Gris por defecto */
            transition: all 0.3s ease;
        }

        .gap-item.completed {
            border-left-color: #10b981; /* Verde completado */
            background: rgba(16, 185, 129, 0.1);
        }

        .gap-item.missing {
            border-left-color: #f59e0b; /* Naranja/Alerta */
            background: rgba(245, 158, 11, 0.1);
        }

        .gap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .gap-name {
            font-weight: bold;
            font-size: 0.85rem;
            color: #e5e7eb;
        }

        .gap-status {
            font-size: 0.75rem;
            font-weight: bold;
        }

        .gap-status.complete { color: #10b981; }
        .gap-status.alert { color: #f59e0b; }

        .gap-progress-track {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .gap-progress-fill {
            height: 100%;
            background: linear-gradient(to right, #10b981, #34d399);
            transition: width 0.5s ease;
        }

                /* --- ESTILOS VISTA CARRUSEL (MOBILE FRIENDLY) --- */
        .carousel-view {
            display: none; /* Oculto por defecto */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 60vh;
            position: relative;
            padding: 20px 0;
        }

        .carousel-container {
            position: relative;
            width: 100%;
            max-width: 350px; /* Ancho ideal para móvil */
            height: 450px; /* Altura fija para la carta */
            margin: 0 auto;
            perspective: 1000px;
        }

        .carousel-track {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Hacemos que la carta llene el contenedor del carrusel */
        .carousel-track .card-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            touch-action: manipulation; /* Mejor respuesta táctil */
        }

        .carousel-nav:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .carousel-nav.prev {
            left: -60px;
        }

        .carousel-nav.next {
            right: -60px;
        }

        /* En móvil, ponemos las flechas dentro del flujo */
        @media (max-width: 500px) {
            .carousel-nav.prev {
                left: 10px;
                top: auto;
                bottom: -70px;
                transform: none;
            }
            .carousel-nav.next {
                right: 10px;
                top: auto;
                bottom: -70px;
                transform: none;
            }
            .carousel-container {
                height: 400px; /* Un poco más pequeña en móvil */
            }
        }

        .carousel-counter {
            margin-top: 20px;
            font-size: 1rem;
            color: #9ca3af;
            font-weight: bold;
        }

        /* Botón de cambio de vista */
        .view-mode-btn {
            background: linear-gradient(to right, #6366f1, #4f46e5);
            color: white;
        }
        .view-mode-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

                /* --- ESTILOS MENÚ DESPLEGABLE "MODOS" --- */
        .dropdown-container {
            position: relative;
            display: inline-block;
        }

        .dropdown-menu {
            display: none; /* Oculto por defecto */
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #374151;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 100;
            border-radius: 8px;
            margin-top: 8px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Clase para mostrar el menú */
        .dropdown-menu.show {
            display: block;
            animation: fadeInDown 0.2s ease;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Botones dentro del menú */
        .dropdown-item {
            color: white;
            padding: 12px 16px;
            text-decoration: none;
            display: flex; /* Alineación icono texto */
            align-items: center;
            gap: 10px;
            width: 100%;
            text-align: left;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* Estado activo (selección actual) */
        .dropdown-item.active {
            background-color: rgba(168, 85, 247, 0.2);
            color: #a855f7;
            font-weight: bold;
        }

        /* Estilo del botón principal "Modos" */
        .modes-btn {
            background: linear-gradient(to right, #6366f1, #4f46e5);
            color: white;
        }
        .modes-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

                /* --- ESTILOS MODAL DE MODOS --- */
        .modes-modal-content {
            max-width: 400px;
            text-align: center;
        }

        .mode-selector-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }

        .mode-option-card {
            background: #374151;
            border-radius: 12px;
            padding: 20px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .mode-option-card:hover {
            background: #4b5563;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .mode-option-card.selected {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }

        .mode-option-icon {
            font-size: 2rem;
        }

        .mode-option-label {
            font-weight: bold;
            font-size: 1rem;
        }

        /* Responsivo: En móvil una sola columna */
        @media (max-width: 400px) {
            .mode-selector-grid {
                grid-template-columns: 1fr;
            }
        }

                /* --- ESTILOS MODO IMPOSTOR --- */
        .impostor-modal-content {
            max-width: 600px;
            text-align: center;
        }

        .impostor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .impostor-card {
            background: #374151;
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .impostor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.3);
        }

        .impostor-card.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }

        .impostor-card.wrong {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
            opacity: 0.6;
        }

        .impostor-card-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #111827;
        }

        .impostor-card-name {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .impostor-result-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .impostor-card.revealed .impostor-result-overlay {
            opacity: 1;
        }

        .impostor-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .impostor-btn {
            background: linear-gradient(to right, #ec4899, #be185d);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        .impostor-btn:hover { transform: scale(1.05); }

        /* Responsive móvil */
        @media (max-width: 400px) {
            .impostor-grid {
                grid-template-columns: 1fr;
            }
            .impostor-card-image { height: 150px; }
        }

                /* --- ESTILOS MODO IMPOSTOR (ACTUALIZADO) --- */
        .impostor-modal-content {
            max-width: 600px;
            text-align: center;
        }

        .impostor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            min-height: 300px; /* Altura mínima para que no salte */
        }

        .impostor-card {
            background: #374151;
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .impostor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.3);
        }

        .impostor-card.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }

        .impostor-card.wrong {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
            opacity: 0.7;
        }

        .impostor-card-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #111827;
        }

        .impostor-card-name {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .impostor-result-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .impostor-card.revealed .impostor-result-overlay {
            opacity: 1;
        }

        .impostor-icon { font-size: 2rem; margin-bottom: 5px; }
        
        /* Botones y Resultados */
        .impostor-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            min-height: 40px; /* Reserva espacio */
        }

        .skip-btn {
            background: #4b5563;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        .skip-btn:hover { background: #6b7280; }

        .next-btn {
            background: linear-gradient(to right, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            display: none; /* Oculto por defecto */
        }
        .next-btn:hover { transform: scale(1.05); }

        .impostor-feedback {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            display: none;
        }
        
        .reveal-category {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 5px;
        }

        @media (max-width: 400px) {
            .impostor-grid { grid-template-columns: 1fr; }
        }        /* --- ESTILOS MODO IMPOSTOR (ACTUALIZADO) --- */
        .impostor-modal-content {
            max-width: 600px;
            text-align: center;
        }

        .impostor-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
            min-height: 300px; /* Altura mínima para que no salte */
        }

        .impostor-card {
            background: #374151;
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .impostor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.3);
        }

        .impostor-card.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }

        .impostor-card.wrong {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
            opacity: 0.7;
        }

        .impostor-card-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #111827;
        }

        .impostor-card-name {
            font-weight: bold;
            font-size: 0.9rem;
        }

        .impostor-result-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .impostor-card.revealed .impostor-result-overlay {
            opacity: 1;
        }

        .impostor-icon { font-size: 2rem; margin-bottom: 5px; }
        
        /* Botones y Resultados */
        .impostor-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            min-height: 40px; /* Reserva espacio */
        }

        .skip-btn {
            background: #4b5563;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        .skip-btn:hover { background: #6b7280; }

        .next-btn {
            background: linear-gradient(to right, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            display: none; /* Oculto por defecto */
        }
        .next-btn:hover { transform: scale(1.05); }

        .impostor-feedback {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            display: none;
        }
        
        .reveal-category {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 5px;
        }

        @media (max-width: 400px) {
            .impostor-grid { grid-template-columns: 1fr; }
        }

                /* --- ESTILOS MODO CIEGAS (BLIND TEST) --- */
        .blindtest-modal-content {
            max-width: 500px;
            text-align: center;
        }

        .blindtest-status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .blindtest-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fbbf24;
        }

        .blindtest-timer.warning { color: #ef4444; animation: pulse 0.5s infinite; }

        .blindtest-score {
            font-size: 1.2rem;
            color: #10b981;
        }

        .blindtest-visualizer {
            height: 60px;
            background: #111827;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            overflow: hidden;
        }

        .blindtest-bar {
            width: 6px;
            background: #8b5cf6;
            border-radius: 2px;
            animation: soundBar 0.5s ease-in-out infinite alternate;
        }

        @keyframes soundBar {
            0% { height: 10px; opacity: 0.5; }
            100% { height: 40px; opacity: 1; }
        }

        .blindtest-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .blindtest-option {
            background: #374151;
            border: 2px solid transparent;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .blindtest-option:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .blindtest-option.correct { border-color: #10b981; background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .blindtest-option.wrong { border-color: #ef4444; background: rgba(239, 68, 68, 0.2); color: #ef4444; opacity: 0.6; }

        .blindtest-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .blindtest-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }

        .blindtest-btn.skip { background: #4b5563; color: white; }
        .blindtest-btn.next { background: linear-gradient(to right, #8b5cf6, #6366f1); color: white; display: none; }
    
        /* Contenedor del Player de YouTube (Invisible pero presente) */
        .blindtest-player-hidden {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;          /* Totalmente invisible */
            pointer-events: none; /* No interfiere con clics */
            z-index: 0;          /* Debajo de la UI */
        }

                /* Botón central de Play para desbloquear audio */
        .blindtest-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(139, 92, 246, 0.9);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
            z-index: 10;
            transition: transform 0.2s;
        }
        .blindtest-play-btn:hover { transform: translate(-50%, -50%) scale(1.1); }
        
        .blindtest-play-btn.hidden { display: none; }
        
    </style>
        <!-- LIBRERÍA NECESARIA PARA EXPORTAR IMAGEN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <!-- Chart.js para gráficas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- YouTube IFrame API (NECESARIO PARA AUDIO EN CIEGAS) -->
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
                            <!-- Skip Link para Accesibilidad -->
    <a href="#main-content" class="skip-link">Saltar a las cartas</a>
    <div class="container">
        <header>
            <!-- Logo Añadido -->
            <img src="https://i.imgur.com/qQ7aGbv.png" alt="Cancinfluencers Logo" class="header-logo">
            <h1>CANCINFLUENCERS</h1>
            <p class="subtitle">Descubre las canciones de tus influencers favoritos haciendo clic en las tarjetas</p>
        </header>

               <!-- Controles con ARIA Roles y SVG accesibles -->
        <div class="controls" role="toolbar" aria-label="Controles principales">
            <button class="reset-app-btn-icon" id="resetAppBtn" aria-label="Reiniciar Aplicación" title="Reiniciar Aplicación">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
            </button>
            <input type="text" class="search-input" placeholder="Buscar influencer..." id="searchInput" aria-label="Buscar influencer por nombre">
            
            <button class="btn shuffle-btn" id="shuffleBtn" aria-label="Reordenar cartas aleatoriamente">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                Reordenar
            </button>
            
            <button class="btn add-btn" id="addBtn" aria-label="Añadir nuevo influencer">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                Añadir Influencer
            </button>
            
            <button class="btn tierlist-btn" id="tierlistBtn" aria-label="Ver mi tierlist">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                Ver Tierlist
            </button>
            
            <button class="btn categories-btn" id="categoriesBtn" aria-label="Filtrar por categorías">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                Categorías
            </button>
            
            <button class="btn achievements-btn" id="achievementsBtn" aria-label="Ver logros y badges">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="8" r="6"></circle><path d="M15.477 12.89L17 22l-5-3-5 3 1.523-9.11"></path></svg>
                Logros
            </button>

            <button class="btn modes-btn" id="modesBtn" aria-label="Cambiar modo de vista">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                Modos
            </button>

            <button class="btn reveal-all-btn" id="revealAllBtn" aria-label="Revelar todas las cartas">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                Revelar Todas
            </button>
        </div>

                <main id="main-content" tabindex="-1">
            <!-- VISTA CUADRÍCULA (Por defecto) -->
            <div class="cards-grid" id="cardsGrid" role="list" aria-label="Lista de influencers">
                <!-- Las tarjetas se generarán dinámicamente -->
            </div>

            <!-- VISTA CARRUSEL (Oculta por defecto) -->
            <div class="carousel-view" id="carouselView">
                <div class="carousel-container">
                    <div class="carousel-track" id="carouselTrack">
                        <!-- La carta activa se inyecta aquí -->
                    </div>
                    
                    <!-- Flechas -->
                    <button class="carousel-nav prev" id="carouselPrev" aria-label="Anterior">‹</button>
                    <button class="carousel-nav next" id="carouselNext" aria-label="Siguiente">›</button>
                </div>
                <div class="carousel-counter" id="carouselCounter">1 / 1</div>
            </div>
            
            <div class="no-results" id="noResults" style="display: none;">
                <p>No se encontraron influencers con ese nombre</p>
            </div>

            <div class="fans-toggle-container">
                <div class="fans-toggle">
                    <span class="fans-label" id="fans-label-text">🎵 Canciones de Fans</span>
                    <!-- Añadido role, aria-checked, aria-labelledby, tabindex -->
                    <div class="toggle-switch" id="fansToggle" role="switch" aria-checked="false" aria-labelledby="fans-label-text" tabindex="0">
                        <div class="toggle-slider" aria-hidden="true"></div>
                    </div>
                </div>
                <!-- Añadido aria-live para anuncios -->
                <div class="fans-count" id="fansCount" aria-live="polite">10 canciones disponibles</div>
            </div>

            <!-- Sección de canciones de fans -->
            <div class="fans-section" id="fansSection">
                <h2 class="fans-title">CANCIONES DE FANS</h2>
                <div class="cards-grid" id="fansCardsGrid">
                    <!-- Las tarjetas de fans se generarán dinámicamente -->
                </div>
            </div>
            
            <!-- Información de filtro activo -->
            <div class="active-category" id="activeCategoryInfo" style="display: none;">
                <div class="active-category-name" id="activeCategoryName"></div>
                <button class="clear-filter-btn" id="clearFilterBtn">Limpiar filtro</button>
            </div>
        <footer>
            <div class="footer-content">
                <div class="creator-info">
                    <span>Creado por</span>
                    <span class="creator-name">Maiquel3000</span>
                    <span>© 2025 - Todos los derechos reservados</span>
                </div>
                <div class="social-links">
                    <a href="https://www.instagram.com/miguel.gandia" target="_blank" class="social-link" title="Sígueme en Instagram">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1 1 12.324 0 6.162 6.162 0 0 1-12.324 0zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm4.965-10.405a1.44 1.44 0 1 1 2.881.001 1.44 1.44 0 0 1-2.881-.001z"></path>
                        </svg>
                    </a>
                </div>
            </div>
        </footer>

        <!-- Modal para ver el video (CORREGIDO) -->
    <div class="modal" id="videoModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle"></h3>
                <button class="close-btn" id="closeModal" aria-label="Cerrar video">×</button>
            </div>
            
            <div class="modal-body">
                <div class="modal-video">
                    <!-- Añadido title al iframe -->
                    <iframe id="modalVideo" title="Video del influencer" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
                </div>
                
                <div class="tier-selection-panel">
                    <div class="tier-selection-title">Selecciona un tier:</div>
                    
                    <!-- CAMBIO CLAVE: role="group", aria-label y <button> en vez de <div> -->
                    <div class="tier-options" role="group" aria-label="Opciones de tier">
                        <button class="tier-option tier-s" data-tier="s" aria-pressed="false">S</button>
                        <button class="tier-option tier-a" data-tier="a" aria-pressed="false">A</button>
                        <button class="tier-option tier-b" data-tier="b" aria-pressed="false">B</button>
                        <button class="tier-option tier-c" data-tier="c" aria-pressed="false">C</button>
                        <button class="tier-option tier-d" data-tier="d" aria-pressed="false">D</button>
                        <button class="tier-option tier-f" data-tier="f" aria-pressed="false">F</button>
                    </div>
                    
                    <!-- NUEVO: Botón para eliminar carta personalizada -->
                    <button class="delete-influencer-btn" id="deleteInfluencerBtn" style="display: none;">
                        🗑️ Eliminar esta carta
                    </button>

                    <!-- Añadido aria-live para que lea los cambios -->
                    <div class="tier-selection-status" id="tierSelectionStatus" aria-live="polite">Haz clic en un tier para clasificar esta canción</div>
                </div>
            </div>
        </div>
    </div>

         <!-- Modal para el Juego del Impostor (INFINITO) -->
    <div class="modal" id="impostorModal">
        <div class="modal-content impostor-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🕵️ ¿Quién es el Impostor?</h3>
                <button class="close-btn" id="closeImpostorModal" aria-label="Cerrar">×</button>
            </div>
            <div class="modal-body">
                <p style="color: #fbbf24; font-weight: bold;">
                    3 comparten una categoría secreta, 1 no encaja.
                </p>

                <div class="impostor-grid" id="impostorGrid">
                    <!-- Las 4 cartas se generan aquí -->
                </div>

                <div class="impostor-feedback" id="impostorFeedback">
                    <div class="reveal-category" id="revealCategoryText"></div>
                    <div id="resultMessage" style="color: white; font-size: 0.9rem;"></div>
                </div>

                <div class="impostor-actions">
                    <button class="skip-btn" id="skipImpostorBtn">⏭️ Saltar</button>
                    <button class="next-btn" id="nextImpostorBtn">Siguiente Ronda ➡️</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para añadir influencer -->
    <div class="modal" id="addModal">
        <div class="add-modal-content">
            <div class="add-modal-header">
                <h2 class="add-modal-title">Añadir Nuevo Influencer</h2>
            </div>
            
            <div class="success-message" id="successMessage">
                ¡Influencer añadido correctamente!
            </div>
            
            <form id="addInfluencerForm">
                <div class="form-group">
                    <label class="form-label" for="influencerName">Nombre del Influencer</label>
                    <input type="text" class="form-input" id="influencerName" placeholder="Ej: ElRubius" required="">
                    <div class="error-message" id="nameError">Por favor, ingresa un nombre válido</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="youtubeUrl">URL del Video de YouTube</label>
                    <input type="url" class="form-input" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." required="">
                    <div class="error-message" id="urlError">Por favor, ingresa una URL válida de YouTube</div>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="form-btn cancel-btn" id="cancelAddBtn">Cancelar</button>
                    <button type="submit" class="form-btn submit-btn">Añadir</button>
                </div>
            </form>
        </div>
    </div>

<!-- Modal para ver categorías -->
<div class="modal" id="categoriesModal">
    <div class="categories-modal-content">
        <div class="categories-header">
            <h2 class="categories-title">CATEGORÍAS DE INFLUENCERS</h2>
            <button class="close-btn" id="closeCategoriesModal">×</button>
        </div>
        
        <div class="category-stats">
            <div class="category-stat">
                <div class="category-stat-number" id="totalCategories">7</div>
                <div class="category-stat-label">Categorías Disponibles</div>
            </div>
            <div class="category-stat">
                <div class="category-stat-number" id="totalInfluencers">130</div>
                <div class="category-stat-label">Total Influencers</div>
            </div>
        </div>
                <!-- NUEVO: Toggle para cambiar lógica de filtro -->
        <div class="filter-logic-container">
            <span class="logic-label active" id="labelOr">🔓 (Flexible)</span>
            <div class="logic-switch or-active" id="logicSwitch">
                <div class="logic-slider" id="logicSlider">⬅</div>
            </div>
            <span class="logic-label" id="labelAnd">🔒 (Estricto)</span>
        </div>
        
        <div class="filter-info">💡 Selecciona múltiples categorías para filtrar influencers</div>
        
        <div class="selected-count" id="selectedCount" style="display: none;">
            0 categorías seleccionadas
        </div>
        
        <div class="categories-container" id="categoriesContainer">
            <!-- Las categorías se generarán dinámicamente -->
        </div>
        
        <div class="category-actions">
            <button class="apply-filters-btn" id="applyFiltersBtn">Aplicar filtros</button>
            <button class="clear-all-btn" id="clearAllBtn">Limpiar todo</button>
        </div>
    </div>
</div>

        <!-- Modal para ver tierlist -->
        <div class="modal" id="tierlistModal">
            <!-- COLUMNA IZQUIERDA: Contenido Principal -->
            <div class="tierlist-modal-main">
                <div class="tierlist-header">
                    <h2 class="tierlist-title">MI TIERLIST</h2>
                    <div class="tierlist-actions">
                        <button class="export-image-btn" id="exportImageBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            Exportar
                        </button>
                        <button class="edit-tiers-btn" id="editTiersBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Editar
                        </button>
                        <button class="share-code-btn" id="shareCodeBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                            Compartir
                        </button>
                        <button class="close-btn" id="closeTierlistModal">×</button>
                    </div>
                </div>

                <div class="tier-stats">
                    <div class="tier-stat">
                        <div class="tier-stat-number" id="totalRevealed">0</div>
                        <div class="tier-stat-label">Reveladas</div>
                    </div>
                    <div class="tier-stat">
                        <div class="tier-stat-number" id="totalClassified">0</div>
                        <div class="tier-stat-label">Clasificadas</div>
                    </div>
                    <div class="tier-stat">
                        <div class="tier-stat-number" id="totalSongs">0</div>
                        <div class="tier-stat-label">Total</div>
                    </div>
                </div>
                
                <div class="reorder-hint">💡 Arrastra y suelta los elementos para reordenar tu tierlist</div>
                
                <div class="tierlist-container">
                    <!-- Aquí van los tiers S, A, B, C, D, F y Sin Clasificar -->
                    <!-- Copia y pega aquí tus divs .tier-row existentes para no perderlos -->
                    <div class="tier-row" data-tier="s">
                        <div class="tier-label tier-s">S</div>
                        <div class="tier-items" id="tier-s"></div>
                    </div>
                    <div class="tier-row" data-tier="a">
                        <div class="tier-label tier-a">A</div>
                        <div class="tier-items" id="tier-a"></div>
                    </div>
                    <div class="tier-row" data-tier="b">
                        <div class="tier-label tier-b">B</div>
                        <div class="tier-items" id="tier-b"></div>
                    </div>
                    <div class="tier-row" data-tier="c">
                        <div class="tier-label tier-c">C</div>
                        <div class="tier-items" id="tier-c"></div>
                    </div>
                    <div class="tier-row" data-tier="d">
                        <div class="tier-label tier-d">D</div>
                        <div class="tier-items" id="tier-d"></div>
                    </div>
                    <div class="tier-row" data-tier="f">
                        <div class="tier-label tier-f">F</div>
                        <div class="tier-items" id="tier-f"></div>
                    </div>
                    <div class="tier-row" data-tier="unclassified">
                        <div class="tier-label tier-unclassified">Sin Clasificar</div>
                        <div class="tier-items" id="tier-unclassified"></div>
                    </div>
                </div>
            </div>

            <!-- COLUMNA DERECHA: Sidebar con Pestañas -->
            <aside class="tierlist-sidebar">
                <!-- Navegación de Pestañas -->
                <div class="sidebar-tabs">
                    <button class="sidebar-tab-btn active" data-tab="distribution">
                        <span class="tab-icon">📊</span>
                        <span class="tab-text">Distribución</span>
                    </button>
                    <button class="sidebar-tab-btn" data-tab="progress">
                        <span class="tab-icon">🎯</span>
                        <span class="tab-text">Progreso</span>
                    </button>
                </div>

                <!-- Contenido de Pestañas -->
                <div class="sidebar-content">
                    
                    <!-- PESTAÑA 1: DISTRIBUCIÓN -->
                    <div id="tab-distribution" class="tab-panel active">
                        <div class="tier-chart-container">
                            <canvas id="tierlistPieChart"></canvas>
                        </div>
                        <div id="customChartLegend" class="chart-legend-grid"></div>
                    </div>

                    <!-- PESTAÑA 2: PROGRESO -->
                    <div id="tab-progress" class="tab-panel">
                        <div id="categoryGapsContainer" class="category-gaps-container">
                            <!-- Se llena dinámicamente -->
                        </div>
                    </div>
                </div>
            </aside>
        </div>

<!-- Modal para editar tiers -->
<div class="modal" id="editTiersModal">
    <div class="edit-tiers-modal-content">
        <div class="edit-tiers-header">
            <h2 class="edit-tiers-title">Personalizar Tiers</h2>
            <p class="edit-tiers-subtitle">Edita el nombre y el color de cada tier</p>
        </div>
        
        <!-- Tier S -->
        <div class="tier-edit-group">
            <div class="tier-edit-label">
                <div class="tier-color-preview tier-s"></div>
                <span>Tier S:</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="tier-edit-input" id="tier-name-s" placeholder="Nombre..." maxlength="15">
                <input type="color" class="tier-color-input" id="tier-color-s" title="Color del Tier S">
            </div>
        </div>

        <!-- Tier A -->
        <div class="tier-edit-group">
            <div class="tier-edit-label">
                <div class="tier-color-preview tier-a"></div>
                <span>Tier A:</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="tier-edit-input" id="tier-name-a" placeholder="Nombre..." maxlength="15">
                <input type="color" class="tier-color-input" id="tier-color-a" title="Color del Tier A">
            </div>
        </div>

        <!-- Tier B -->
        <div class="tier-edit-group">
            <div class="tier-edit-label">
                <div class="tier-color-preview tier-b"></div>
                <span>Tier B:</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="tier-edit-input" id="tier-name-b" placeholder="Nombre..." maxlength="15">
                <input type="color" class="tier-color-input" id="tier-color-b" title="Color del Tier B">
            </div>
        </div>

        <!-- Tier C -->
        <div class="tier-edit-group">
            <div class="tier-edit-label">
                <div class="tier-color-preview tier-c"></div>
                <span>Tier C:</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="tier-edit-input" id="tier-name-c" placeholder="Nombre..." maxlength="15">
                <input type="color" class="tier-color-input" id="tier-color-c" title="Color del Tier C">
            </div>
        </div>

        <!-- Tier D -->
        <div class="tier-edit-group">
            <div class="tier-edit-label">
                <div class="tier-color-preview tier-d"></div>
                <span>Tier D:</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="tier-edit-input" id="tier-name-d" placeholder="Nombre..." maxlength="15">
                <input type="color" class="tier-color-input" id="tier-color-d" title="Color del Tier D">
            </div>
        </div>

        <!-- Tier F -->
        <div class="tier-edit-group">
            <div class="tier-edit-label">
                <div class="tier-color-preview tier-f"></div>
                <span>Tier F:</span>
            </div>
            <div style="display: flex; gap: 10px;">
                <input type="text" class="tier-edit-input" id="tier-name-f" placeholder="Nombre..." maxlength="15">
                <input type="color" class="tier-color-input" id="tier-color-f" title="Color del Tier F">
            </div>
        </div>

        <div class="edit-tiers-buttons">
            <button class="form-btn reset-tiers-btn" id="resetTiersBtn">Restablecer</button>
            <button class="form-btn save-tiers-btn" id="saveTiersBtn">Guardar Cambios</button>
        </div>
    </div>		
</div>

        <!-- Modal para compartir/importar código -->
<div class="modal" id="shareCodeModal">
    <div class="share-modal-content">
        <div class="add-modal-header">
            <h2 class="add-modal-title">Compartir / Importar Tierlist</h2>
            <button class="close-btn" id="closeShareModal">×</button>
        </div>
        
        <div class="share-section">
            <div class="share-section-title">
                📤 Tu Código de Tierlist
            </div>
            <textarea class="share-textarea" id="exportCodeArea" readonly placeholder="Genera tu código para compartir..."></textarea>
            <div class="share-buttons">
                <button class="copy-btn" id="generateExportBtn">Generar Código</button>
                <button class="copy-btn" id="copyCodeBtn" style="display:none;">Copiar Código</button>
            </div>
        </div>
        
        <div class="share-section">
            <div class="share-section-title">
                📥 Importar Tierlist
            </div>
            <textarea class="share-textarea" id="importCodeArea" placeholder="Pega aquí el código de un amigo..."></textarea>
            <button class="import-btn" id="importCodeBtn">Importar Código</button>
        </div>

        <!-- NUEVA SECCIÓN: CALCULADORA DE MATCH -->
        <div class="share-section">
            <div class="share-section-title">
                ❤️ Calculadora de Match
            </div>
            <textarea class="share-textarea" id="matchCodeArea" placeholder="Pega aquí el código de tu amigo para comparar..." style="height: 80px;"></textarea>
            <button class="match-btn" id="calculateMatchBtn">Calcular Compatibilidad</button>
            
            <div class="match-result" id="matchResult" style="display: none;">
                <div class="match-percentage" id="matchPercentage">0%</div>
                <div class="match-details" id="matchDetails">Detalles aquí...</div>
            </div>
        </div>
        <!-- FIN NUEVA SECCIÓN -->

    </div>
</div>


    <script>

// --- CÓDIGO DEL EASTER EGG (CÓDIGO KONAMI - VERSIÓN CORREGIDA) ---

const konamiCode = ['arrowup', 'arrowup', 'arrowdown', 'arrowdown', 'arrowleft', 'arrowright', 'arrowleft', 'arrowright', 'b', 'a'];
let konamiCodePosition = 0;

// Función para activar el Easter Egg (sin cambios)
function triggerEasterEgg() {
    if (localStorage.getItem('cancinfluencers_easterEggActivated') === 'true') {
        showNotification('El Easter Egg ya fue descubierto.');
        konamiCodePosition = 0;
        return;
    }

    const easterEggInfluencer = {
        id: 'easter_egg_maiquel3k',
        name: 'Maiquel3k',
        youtubeUrl: 'https://youtu.be/wIRDTP21jcs',
        videoId: 'lfVKuIAdfRY',
        tier: 's'
    };

    mainInfluencersData.push(easterEggInfluencer);
    mainInfluencers.push(easterEggInfluencer);
    revealedCards.add(easterEggInfluencer.id);
    tierlistData.s.push(easterEggInfluencer);

    localStorage.setItem('cancinfluencers_easterEggActivated', 'true');
    saveRevealedCardsToLocalStorage();
    saveTierlistDataToLocalStorage();

    renderCards();
    updateTierlistStats();
    showNotification('🎉 ¡Código Konami Activado! Encontraste el Easter egg!');
    openModal(easterEggInfluencer);
    konamiCodePosition = 0;
    updateAchievement('konami', 1);
}

// Función para cargar el Easter Egg si ya fue activado (sin cambios)
function loadEasterEgg() {
    if (localStorage.getItem('cancinfluencers_easterEggActivated') === 'true') {
        const easterEggInfluencer = {
            id: 'easter_egg_maiquel3k',
            name: 'Maiquel3k',
            youtubeUrl: 'https://youtu.be/wIRDTP21jcs',
            videoId: 'lfVKuIAdfRY',
            tier: 's'
        };
        
        if (!mainInfluencersData.find(i => i.id === easterEggInfluencer.id)) {
            mainInfluencersData.push(easterEggInfluencer);
            mainInfluencers.push(easterEggInfluencer);
            revealedCards.add(easterEggInfluencer.id);
        }
    }
}

// Listener para detectar el Código Konami (MÁS ROBUSTO)
document.addEventListener('keydown', function(e) {
    // Ignorar si el foco está en un campo de entrada de texto
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
        return;
    }

    // Usamos e.key.toLowerCase() para que funcione tanto con 'b' como con 'B'
    const key = e.key.toLowerCase();

    // Comprobamos si la tecla es la correcta en la secuencia
    if (key === konamiCode[konamiCodePosition]) {
        konamiCodePosition++;
        
        // Si se ha completado toda la secuencia
        if (konamiCodePosition === konamiCode.length) {
            triggerEasterEgg();
        }
    } else {
        // Si la tecla es incorrecta, reiniciar la secuencia
        konamiCodePosition = 0;
    }
});

    // --- FUNCIONES DE LOCALSTORAGE ---

    // Guardar el siguiente ID disponible
function saveNextIdToLocalStorage() {
    try {
        localStorage.setItem('cancinfluencers_nextId', nextId.toString());
    } catch (e) {
        console.error('Error al guardar nextId:', e);
    }
}

// Cargar el siguiente ID disponible
function loadNextIdFromLocalStorage() {
    try {
        const saved = localStorage.getItem('cancinfluencers_nextId');
        if (saved) {
            nextId = parseInt(saved, 10);
        }
    } catch (e) {
        console.error('Error al cargar nextId:', e);
    }
}

// Guardar las tarjetas reveladas
function saveRevealedCardsToLocalStorage() {
    try {
        const revealedArray = Array.from(revealedCards);
        localStorage.setItem('cancinfluencers_revealedCards', JSON.stringify(revealedArray));
    } catch (e) {
        console.error('Error al guardar tarjetas reveladas:', e);
    }
}

// Cargar las tarjetas reveladas
function loadRevealedCardsFromLocalStorage() {
    try {
        const saved = localStorage.getItem('cancinfluencers_revealedCards');
        if (saved) {
            const revealedArray = JSON.parse(saved);
            revealedCards = new Set(revealedArray);
        }
    } catch (e) {
        console.error('Error al cargar tarjetas reveladas:', e);
        revealedCards = new Set(); // Resetear a un Set vacío en caso de error
    }
}

// Guardar los datos de la tierlist
function saveTierlistDataToLocalStorage() {
    try {
        localStorage.setItem('cancinfluencers_tierlistData', JSON.stringify(tierlistData));
    } catch (e) {
        console.error('Error al guardar datos de la tierlist:', e);
    }
}

// Cargar los datos de la tierlist
function loadTierlistDataFromLocalStorage() {
    try {
        const saved = localStorage.getItem('cancinfluencers_tierlistData');
        if (saved) {
            tierlistData = JSON.parse(saved);
        }
    } catch (e) {
        console.error('Error al cargar datos de la tierlist:', e);
        // Resetear a los valores por defecto en caso de error
        tierlistData = {
            unclassified: [],
            s: [],
            a: [],
            b: [],
            c: [],
            d: [],
            f: []
        };
    }
}

// Guardar la lista completa de influencers principales
function saveInfluencersDataToLocalStorage() {
    try {
        localStorage.setItem('cancinfluencers_mainInfluencersData', JSON.stringify(mainInfluencersData));
    } catch (e) {
        console.error('Error al guardar la lista de influencers:', e);
    }
}

// Cargar la lista completa de influencers principales (VERSIÓN MEJORADA)
function loadInfluencersDataFromLocalStorage() {
    try {
        const saved = localStorage.getItem('cancinfluencers_mainInfluencersData');
        if (saved) {
            const loadedInfluencers = JSON.parse(saved);
            
            // 1. Identificar los IDs que ya tenemos guardados
            const savedIds = new Set(loadedInfluencers.map(inf => inf.id));
            
            // 2. Buscar en el código duro (mainInfluencersData original) cartas que falten
            // Usamos una copia temporal de los datos originales si es necesario, 
            // pero como mainInfluencersData se define arriba, comparamos con lo que debería tener.
            
            // Como mainInfluencersData ya fue definido arriba en el script, 
            // "sabemos" que las cartas por defecto son los IDs 1 al 142 (y 1000s para fans).
            // Vamos a asegurarnos de que si falta la 141 o 142, se añadan.
            
            const defaultIds = new Set(mainInfluencersData.map(inf => inf.id));
            let needsUpdate = false;
            
            // Verificar si falta algún ID por defecto
            defaultIds.forEach(id => {
                if (!savedIds.has(id)) {
                    // Si falta, buscamos la carta en los datos originales (que tenemos arriba en el script)
                    // Nota: mainInfluencersData todavía tiene los datos del código hasta que los sobrescribamos.
                    const missingCard = mainInfluencersData.find(inf => inf.id === id);
                    if (missingCard) {
                        loadedInfluencers.push(missingCard); // La añadimos a la lista cargada
                        needsUpdate = true;
                    }
                }
            });

            // 3. Aplicar la lista combinada
            mainInfluencersData.length = 0;
            mainInfluencersData.push(...loadedInfluencers);
            
            // 4. Si añadimos algo nuevo, guardamos la versión actualizada
            if (needsUpdate) {
                console.log("Actualizando lista con nuevas cartas del sistema...");
                saveInfluencersDataToLocalStorage();
            }
        }
    } catch (e) {
        console.error('Error al cargar la lista de influencers:', e);
    }
}

// Sincronizar los tiers de los influencers con los datos cargados
function syncInfluencerTiersFromLoadedData() {
    // 1. Resetear todos los tiers en los datos maestros a null
    [...mainInfluencersData, ...fansInfluencersData].forEach(influencer => {
        influencer.tier = null;
    });

    // 2. Crear un conjunto (Set) con todos los IDs de los influencers clasificados
    const classifiedIds = new Set();
    Object.keys(tierlistData).forEach(tierKey => {
        // Ignorar la lista de 'unclassified' por ahora
        if (tierKey !== 'unclassified') {
            tierlistData[tierKey].forEach(influencer => {
                classifiedIds.add(influencer.id);
                // Actualizar el tier en los datos maestros
                const masterInfluencer = findInfluencerById(influencer.id);
                if (masterInfluencer) {
                    masterInfluencer.tier = tierKey;
                }
            });
        }
    });

    // 3. RE-CONSTRUIR la lista de 'unclassified' desde cero.
    // --- CORRECCIÓN CLAVE: Añadimos la condición de que esté revelado ---
    tierlistData.unclassified = [...mainInfluencersData, ...fansInfluencersData].filter(influencer => 
        !classifiedIds.has(influencer.id) && revealedCards.has(influencer.id)
    );
}
        // Datos de los influencers principales - LISTA ACTUALIZADA CON CATEGORÍAS
    const mainInfluencersData = [
        { id: '1', name: 'OllieGamerZ', youtubeUrl: 'https://www.youtube.com/watch?v=62pWsLpR8so', videoId: '62pWsLpR8so', tier: null, categories: ['Minecraft', 'Españoles'] },
        { id: '2', name: 'DalasReview', youtubeUrl: 'https://youtu.be/oMGHCWXNBOU?si=LuSrD52-_GmyEG1q', videoId: 'oMGHCWXNBOU', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '3', name: 'ElRubiusOMG', youtubeUrl: 'https://www.youtube.com/watch?v=VZzSBv6tXMw', videoId: 'VZzSBv6tXMw', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '4', name: 'ElRubiusOMG', youtubeUrl: 'https://youtu.be/OkFOETs00QA?si=oX9m0GMS6CI3KfaA', videoId: 'OkFOETs00QA', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Kidd Keo'] },
        { id: '5', name: 'Ibai', youtubeUrl: 'https://www.youtube.com/watch?v=n66zQBqwI9A', videoId: 'n66zQBqwI9A', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '6', name: 'Robleis', youtubeUrl: 'https://youtu.be/GpFoGiscj7k?si=y_jc2UR1T4uAhzOT', videoId: 'GpFoGiscj7k', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '7', name: 'Agustin51', youtubeUrl: 'https://youtu.be/YNwg-tWMyyY?si=UtRJSu8xqDksTig_', videoId: 'YNwg-tWMyyY', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '8', name: 'RickyEdit', youtubeUrl: 'https://youtu.be/Y0VM6DtwM8g?si=k-QlE6h54mNYBrpP', videoId: 'Y0VM6DtwM8g', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '9', name: 'illojuan', youtubeUrl: 'https://youtu.be/65o77VtTcEk?si=Wj9TiQkPIk9lyyGF', videoId: '65o77VtTcEk', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '10', name: 'YoSoyPlex', youtubeUrl: 'https://youtu.be/7lQfj-_8Zg0?si=T3VR9-vxskBU9W4f', videoId: '7lQfj-_8Zg0', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '11', name: 'Xokas', youtubeUrl: 'https://youtu.be/0j3R4_PED1Q?si=l-r6wd7ZqXFCQMa3', videoId: '0j3R4_PED1Q', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '12', name: 'Karina', youtubeUrl: 'https://youtu.be/kKKgU8xf3qI?si=LsiA3A_7pA5TcyA5', videoId: 'kKKgU8xf3qI', tier: null, categories: ['Latinos'] },
        { id: '13', name: 'Mikecrack', youtubeUrl: 'https://youtu.be/TaQj43Lf3tw?si=hKMDcCz0IByWk6en', videoId: 'TaQj43Lf3tw', tier: null, categories: ['Mainstream', 'Minecraft', 'Niños', 'Españoles'] },
        { id: '14', name: 'Fede', youtubeUrl: 'https://youtu.be/CHeEEyi8Y-g?si=Qko7o2ii8PDm_QiP', videoId: 'CHeEEyi8Y-g', tier: null, categories: ['Niños', 'Latinos'] },
        { id: '15', name: 'Salva (DualCoC)', youtubeUrl: 'https://youtu.be/XJaLFrYe6mk?si=_lCu3wxi7h2ZNNRl', videoId: 'XJaLFrYe6mk', tier: null, categories: ['Viejas Reliquias', 'Españoles'] },
        { id: '16', name: 'Nil Ojeda', youtubeUrl: 'https://youtu.be/9DhPBgrSIaA?si=hZ5amS1ePWWjRAWp', videoId: '9DhPBgrSIaA', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '17', name: 'Goorgo', youtubeUrl: 'https://youtu.be/-zeayRzldyI?si=KRUk_-L5UDA6e02L', videoId: '-zeayRzldyI', tier: null, categories: ['Viejas Reliquias', 'Españoles'], featuring: ['TheShooterCoC'] },
        { id: '18', name: 'Willyrex', youtubeUrl: 'https://youtu.be/CW9uky3MZXM?si=0h8nlM-VDBJ1VwU6', videoId: 'CW9uky3MZXM', tier: null, categories: ['Mainstream', 'Minecraft', 'Españoles'] },
        { id: '19', name: 'WhiteZunder', youtubeUrl: 'https://youtu.be/rN7mwzCICn0?si=ob-Gm5K1DaEeEXWT', videoId: 'rN7mwzCICn0', tier: null, categories: ['Minecraft', 'Españoles'] },
        { id: '20', name: 'MissaSinfonia', youtubeUrl: 'https://youtu.be/iuQoT2hUVjk?si=LGj6HQ5_aFpjPFc3', videoId: 'iuQoT2hUVjk', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '21', name: 'YellowMellow', youtubeUrl: 'https://youtu.be/Bnip21mbOD0?si=wdIeziNpbaafhPR_', videoId: 'Bnip21mbOD0', tier: null, categories: ['Viejas Reliquias', 'Españoles'] },
        { id: '22', name: 'Spreen', youtubeUrl: 'https://youtu.be/5rjCRPG3mkw?si=Ndpw-VX17K-KScZ1', videoId: '5rjCRPG3mkw', tier: null, categories: ['Mainstream', 'Minecraft', 'Latinos'] },
        { id: '23', name: 'Carreraa', youtubeUrl: 'https://youtu.be/oE2rfyhIsuk?si=F067GpyMxTXkTSNw', videoId: 'oE2rfyhIsuk', tier: null, categories: ['Mainstream', 'Latinos'], featuring: ['Spreen'] },
        { id: '24', name: 'JuanGuarnizo', youtubeUrl: 'https://youtu.be/VoN4x3R0TCQ?si=OrIQXpTTTNYoqQbu', videoId: 'VoN4x3R0TCQ', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '25', name: 'AriGameplays', youtubeUrl: 'https://youtu.be/aHYvmY3nV5U?si=5uOMvcyJPG3KiMaC', videoId: 'aHYvmY3nV5U', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '26', name: 'Fernanfloo', youtubeUrl: 'https://youtu.be/3oY5qoqo7Mg?si=dV-6B72Wrewrk85g', videoId: '3oY5qoqo7Mg', tier: null, categories: ['Mainstream', 'Viejas Reliquias', 'Latinos'] },
        { id: '27', name: 'German Garmendia', youtubeUrl: 'https://youtu.be/9EmXVhPsJQQ?si=lup3rdjHQENE5dF2', videoId: '9EmXVhPsJQQ', tier: null, categories: ['Mainstream', 'Viejas Reliquias', 'Latinos'] },
        { id: '28', name: 'rojuu', youtubeUrl: 'https://youtu.be/wxKBvF2pS_A?si=avaObdkacZ-OAnzH', videoId: 'wxKBvF2pS_A', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Orslok'] },
        { id: '29', name: 'Orslok', youtubeUrl: 'https://youtu.be/xMAmnQgV6ss?si=oeXwqY5Tmsh91oq4', videoId: 'xMAmnQgV6ss', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '30', name: 'Oscu', youtubeUrl: 'https://youtu.be/TXu9N_zhSZE?si=m7StAyOjApZ_dZWR', videoId: 'TXu9N_zhSZE', tier: null, categories: ['Españoles'] },
        { id: '31', name: 'Angie Velasco', youtubeUrl: 'https://youtu.be/1C1awEClK84?si=yCXeBmoS4xPcsbYk', videoId: '1C1awEClK84', tier: null, categories: ['Latinos'] },
        { id: '32', name: 'Alondrissa', youtubeUrl: 'https://youtu.be/yU1_NmePLFg?si=GNIZBYj8HzxpImvI', videoId: 'yU1_NmePLFg', tier: null, categories: ['Latinos'] },
        { id: '33', name: 'Coscu', youtubeUrl: 'https://youtu.be/87y1ZCFFYqc?si=cLCot9mK3ocPXVmv', videoId: '87y1ZCFFYqc', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '34', name: 'RobertoCein', youtubeUrl: 'https://youtu.be/LSXw8cketoc?si=yJE8Ie3UettzDjjZ', videoId: 'LSXw8cketoc', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '35', name: 'Rodezel', youtubeUrl: 'https://youtu.be/ZXpk7tv47kc?si=PM_58WfB2_HtdcnU', videoId: 'ZXpk7tv47kc', tier: null, categories: ['Mainstream', 'Latinos'], featuring: ['Barcagamer', 'Hasvik'] },
        { id: '36', name: 'Nuvia', youtubeUrl: 'https://youtu.be/S2eQjr_MXIE?si=QVD8_kx8oZJxcbzw', videoId: 'S2eQjr_MXIE', tier: null, categories: ['Latinos'], featuring: ['Rodezel'] },
        { id: '37', name: 'ElMariana', youtubeUrl: 'https://youtu.be/vcdxMNgHTrc?si=aTppOKFNuN2zCbRe', videoId: 'vcdxMNgHTrc', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '38', name: 'Komanche', youtubeUrl: 'https://youtu.be/gSTwJTgYm3I?si=i_b-F8xxuj-pFnWC', videoId: 'gSTwJTgYm3I', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '39', name: 'Lyna Vallejos', youtubeUrl: 'https://youtu.be/zFJAX23KIh8?si=mK2BUoC3r39n1tmy', videoId: 'zFJAX23KIh8', tier: null, categories: ['Niños', 'Latinos'] },
        { id: '40', name: 'Wismichu', youtubeUrl: 'https://youtu.be/FBGE-ptCGT8?si=hwGhfGzTAixN834h', videoId: 'FBGE-ptCGT8', tier: null, categories: ['Viejas Reliquias', 'Españoles'] },
        { id: '41', name: 'Yao Cabrera', youtubeUrl: 'https://youtu.be/t4sAPvqKlgw?si=B5RAil8nl2Rwri9G', videoId: 't4sAPvqKlgw', tier: null, categories: ['Mainstream', 'Viejas Reliquias', 'Latinos', 'Niños'] },
        { id: '42', name: 'Jordi Wild', youtubeUrl: 'https://youtu.be/IHD4zT8a4Lg?si=pqXBJiSNl3gYqOnZ', videoId: 'IHD4zT8a4Lg', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '43', name: 'Momo', youtubeUrl: 'https://youtu.be/5EouEAo9wy0?si=U_AuI-TGIdDT0yqB', videoId: '5EouEAo9wy0', tier: null, categories: ['Latinos'] },
        { id: '44', name: 'Jägger', youtubeUrl: 'https://youtu.be/gLsMfF5m08Y?si=_WzBUhccKEkMecL0', videoId: 'gLsMfF5m08Y', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '45', name: 'Maximus', youtubeUrl: 'https://youtu.be/1LnTBgw-aGU?si=r9QeEt4ol_mjx27_', videoId: '1LnTBgw-aGU', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Orslok'] },
        { id: '46', name: 'Zorman', youtubeUrl: 'https://youtu.be/h6k5qbt72Os?si=Ajt_Qi0eREYWAXse', videoId: 'h6k5qbt72Os', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '47', name: 'Jaime Altozano', youtubeUrl: 'https://youtu.be/ziJuNQcJn24?si=iR34OM4NZZWAw2-C', videoId: 'ziJuNQcJn24', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '48', name: 'Corxea (Spaceronin7)', youtubeUrl: 'https://youtu.be/DMXdutHKJls?si=n-XHphP-3TuGBLPK', videoId: 'DMXdutHKJls', tier: null, categories: ['Viejas Reliquias', 'Latinos'] },
        { id: '49', name: 'Jpelirrojo', youtubeUrl: 'https://youtu.be/UJGQaUu-uzA?si=8Twqa8vLKnC6GtRL', videoId: 'UJGQaUu-uzA', tier: null, categories: ['Viejas Reliquias', 'Españoles'] },
        { id: '50', name: 'Wescol', youtubeUrl: 'https://youtu.be/EY47yXiQ1yM?t=172', videoId: 'EY47yXiQ1yM', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '51', name: 'Wescol2', youtubeUrl: 'https://youtu.be/o2eqeodAHj8?si=w70M-xaDCQTsiWZj', videoId: 'o2eqeodAHj8', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '52', name: 'DaniRep 2017', youtubeUrl: 'https://youtu.be/Wq6qp5ZsduY?si=nRyC-_HG88Zc2BZG', videoId: 'Wq6qp5ZsduY', tier: null, categories: ['Viejas Reliquias', 'Españoles'] },
        { id: '53', name: 'DaniRep Actual', youtubeUrl: 'https://youtu.be/ZgkkEcx03Xw?si=KysF_254s-3L42aB', videoId: 'ZgkkEcx03Xw', tier: null, categories: ['Mainstream', 'Viejas Reliquias', 'Españoles'] },
        { id: '54', name: 'ONE COIN', youtubeUrl: 'https://youtu.be/vPN4WNZxxxE?si=LEF5lXNaUAJUJ-CX', videoId: 'vPN4WNZxxxE', tier: null, categories: ['Latinos'], featuring: ['MAAU', 'PUVLO', 'LATE', 'URIEL'] },
        { id: '55', name: 'LATE', youtubeUrl: 'https://youtu.be/zKO2FJEEVsw?si=vGiMHXz0ZUyoDZD8', videoId: 'zKO2FJEEVsw', tier: null, categories: ['Latinos'] },
        { id: '56', name: 'Cry', youtubeUrl: 'https://youtu.be/rsfosxNojKc?si=AgwS8OncESvkmSAS', videoId: 'rsfosxNojKc', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '57', name: 'Capitán Gato', youtubeUrl: 'https://youtu.be/XG3_pbsUcCA?si=LjKx3Wg6RuuOA3h5', videoId: 'XG3_pbsUcCA', tier: null, categories: ['Latinos'] },
        { id: '58', name: 'StarVTuber', youtubeUrl: 'https://youtu.be/ZyDUc1h582U?si=xFNdopPqw3l9HrqI', videoId: 'ZyDUc1h582U', tier: null, categories: ['Latinos'] },
        { id: '59', name: 'Naim Darrechi', youtubeUrl: 'https://youtu.be/zFch_ru4eaI?si=iT8RliEeiaowSlkX', videoId: 'zFch_ru4eaI', tier: null, categories: ['Viejas Reliquias', 'Tiktokers', 'Españoles'] },
        { id: '60', name: 'Quackity', youtubeUrl: 'https://youtu.be/shniqa1sH_o?si=M4AbxTSYJnk7yN2m', videoId: 'shniqa1sH_o', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '61', name: 'Alana (participación corta)', youtubeUrl: 'https://youtu.be/UGTCE1W81jg?si=Q5wuEi1WYPhxwCz6', videoId: 'UGTCE1W81jg', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '62', name: 'Alana', youtubeUrl: 'https://youtu.be/Ue8dX791o18?si=HmXcxYqADFCYcxxm', videoId: 'Ue8dX791o18', tier: null, categories: ['Mainstream', 'Latinos'], featuring: ['Barcagamer'] },
        { id: '63', name: 'Yuya', youtubeUrl: 'https://youtu.be/SNa5Z8W-70I?si=P1rZtF_cSw8Vq-xL', videoId: 'SNa5Z8W-70I', tier: null, categories: ['Viejas Reliquias', 'Latinos'] },
        { id: '64', name: 'Masi', youtubeUrl: 'https://youtu.be/GoMGw4BkhfM?si=O3AhXZrpktcvTYv5', videoId: 'GoMGw4BkhfM', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '65', name: 'Guanyar', youtubeUrl: 'https://youtu.be/5BYBDd_udCk?si=7aft3sem3RLMnuy0', videoId: '5BYBDd_udCk', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Misho Amoli','Nil Ojeda'] },
        { id: '66', name: 'Cristinini', youtubeUrl: 'https://youtu.be/RP4gxh-yqLs?si=fLNzyotoujEFxHCY', videoId: 'RP4gxh-yqLs', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '67', name: 'clersssss', youtubeUrl: 'https://youtu.be/cUydAxe0CYM?si=MEf_6LZELWQ-YUC_', videoId: 'cUydAxe0CYM', tier: null, categories: ['Mainstream', 'Tiktokers', 'Españoles'] },
        { id: '68', name: 'caprimint', youtubeUrl: 'https://youtu.be/2BZ3g0CaMQQ?si=4Wjag-tOXaxotUoA', videoId: '2BZ3g0CaMQQ', tier: null, categories: ['Latinos'] },
        { id: '69', name: 'Bb trickz', youtubeUrl: 'https://youtu.be/C8WmCFg65C0?si=4zs8KrELlgsgzSr3', videoId: 'C8WmCFg65C0', tier: null, categories: ['Mainstream', 'Tiktokers', 'Españoles'] },
        { id: '70', name: 'Ruth \'La Peke\'', youtubeUrl: 'https://youtu.be/1dtugsaskAQ?si=m6p-XI6r6oWgQGQc', videoId: '1dtugsaskAQ', tier: null, categories: ['Mainstream', 'Tiktokers', 'Españoles'] },
        { id: '71', name: 'Yeri Mua', youtubeUrl: 'https://youtu.be/eJS0WziQHGw?si=fPaqhoxlsRISDeQr', videoId: 'eJS0WziQHGw', tier: null, categories: ['Latinos'] },
        { id: '72', name: 'Arta', youtubeUrl: 'https://youtu.be/SZh1lPZX9XY?si=SRIqwOe1Aw3QegKL', videoId: 'SZh1lPZX9XY', tier: null, categories: ['Niños', 'Españoles'] },
        { id: '73', name: 'vMario', youtubeUrl: 'https://youtu.be/qv9jUOXLK30?si=nOwybGC2jliOl_Hb', videoId: 'qv9jUOXLK30', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '74', name: 'Yolo', youtubeUrl: 'https://youtu.be/Hblc4xt-9Pc?si=f1T9IifozX-Z5dsW', videoId: 'Hblc4xt-9Pc', tier: null, categories: ['Niños', 'Latinos'] },
        { id: '75', name: 'Ricky Limon', youtubeUrl: 'https://youtu.be/xuNObVb4LpM?si=kIs07PztOu99z-du', videoId: 'xuNObVb4LpM', tier: null, categories: ['Niños', 'Latinos'] },
        { id: '76', name: 'Susy Mouriz', youtubeUrl: 'https://youtu.be/K-zVyV0yuZU?si=v5ACXZV1oap98jow', videoId: 'K-zVyV0yuZU', tier: null, categories: ['Niños', 'Latinos'] },
        { id: '77', name: 'ChuyMine', youtubeUrl: 'https://youtu.be/bpCEZ49hQMU?si=-3dxMVktwaev3aFC', videoId: 'bpCEZ49hQMU', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '78', name: 'xTurbo', youtubeUrl: 'https://youtu.be/cedhJXxVayE?si=8GNMg8DL0KBDPUlJ', videoId: 'cedhJXxVayE', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '79', name: 'Awita', youtubeUrl: 'https://youtu.be/GEgHoQtCWto?si=zlIG97iXBewHWv1O', videoId: 'GEgHoQtCWto', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'], featuring: ['Jardred'] },
        { id: '80', name: 'Jardred', youtubeUrl: 'https://youtu.be/JBJYfWHSMY4?si=rXSVwT3RdAu4ioJg', videoId: 'JBJYfWHSMY4', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'], featuring: ['Elo YT'] },
        { id: '81', name: 'Elo YT', youtubeUrl: 'https://youtu.be/V5mMG7EdHGg?si=bEwYwQs6CbHRqDbZ', videoId: 'V5mMG7EdHGg', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'], featuring: ['Jardred','Kara'] },
        { id: '82', name: 'Arsel', youtubeUrl: 'https://youtu.be/EVDvU4ejh3M?si=KBZgxCldNXgXItTA', videoId: 'EVDvU4ejh3M', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'], featuring: ['Arsel'] },
        { id: '83', name: 'iTownGamePlay', youtubeUrl: 'https://youtu.be/-0xzODfv9aw?si=7K3gRO3I9Z0Q26pT', videoId: '-0xzODfv9aw', tier: null, categories: ['Viejas Reliquias', 'Minecraft', 'Españoles'] },
        { id: '84', name: 'KillerCreeper55', youtubeUrl: 'https://youtu.be/T843uWKiW4g?si=4in1cW-DK-pUHIXx', videoId: 'T843uWKiW4g', tier: null, categories: ['Minecraft', 'Españoles'] },
        { id: '85', name: 'Farfadox', youtubeUrl: 'https://youtu.be/7SO1uxxzqa8?si=MFp41IasWmDr5WeN', videoId: '7SO1uxxzqa8', tier: null, categories: ['Minecraft', 'Latinos'] },
        { id: '86', name: 'iLeoVlogs', youtubeUrl: 'https://youtu.be/6SeJxBXKnj4?si=CUeANi9t81KC0nS1', videoId: '6SeJxBXKnj4', tier: null, categories: ['Viejas Reliquias', 'Españoles'], featuring: ['Agapito'] },
        { id: '87', name: 'iLeoVlogs (Parodia)', youtubeUrl: 'https://youtu.be/Hi6QsZTpbg4?si=A5ooIPHeDo7-ZgYe', videoId: 'Hi6QsZTpbg4', tier: null, categories: ['Viejas Reliquias', 'Españoles'], featuring: ['Carla Laubaló'] },
        { id: '88', name: 'Agapito', youtubeUrl: 'https://youtu.be/KOpiio8fWxk?si=Iq6xpIzXYY66r16I', videoId: 'KOpiio8fWxk', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '89', name: 'Exi', youtubeUrl: 'https://youtu.be/UXjC9CdRumg?si=YKZhmTnCsICcFBQm', videoId: 'UXjC9CdRumg', tier: null, categories: ['Mainstream', 'Minecraft', 'Niños', 'Tiktokers', 'Españoles'] },
        { id: '90', name: 'Joaquinpa \'Jokki\'', youtubeUrl: 'https://youtu.be/sZyT29vwxXU?si=4UeYQo8PA4hzj8aG', videoId: 'sZyT29vwxXU', tier: null, categories: ['Mainstream', 'Viejas Reliquias', 'Españoles'] },
        { id: '91', name: 'Jokki \'Joaquinpa\'', youtubeUrl: 'https://youtu.be/RYrSxuaend4?si=4pvCBxMKhuPNoE-m', videoId: 'RYrSxuaend4', tier: null, categories: ['Mainstream', 'Viejas Reliquias', 'Españoles'] },
        { id: '92', name: 'RoEnLaRed', youtubeUrl: 'https://youtu.be/u_jaF3BhGW0?si=HY2pAYbe9GsiguMa', videoId: 'u_jaF3BhGW0', tier: null, categories: ['Viejas Reliquias', 'Españoles'] },
        { id: '93', name: 'TheDaarick28', youtubeUrl: 'https://youtu.be/P2RIdVV1tdM?si=q2E6LIriBMwBTDxf', videoId: 'P2RIdVV1tdM', tier: null, categories: ['Viejas Reliquias', 'Minecraft', 'Latinos'] },
        { id: '94', name: 'Celopan', youtubeUrl: 'https://youtu.be/7xOOOn27kOQ?si=Y3GjyEvFXfTWAFBB', videoId: '7xOOOn27kOQ', tier: null, categories: ['Viejas Reliquias', 'Minecraft', 'Españoles'] },
        { id: '95', name: 'WindyGirk', youtubeUrl: 'https://youtu.be/Vs0EaVF11hE?si=Vmn2tB7zZ3ZygalZ', videoId: 'Vs0EaVF11hE', tier: null, categories: ['Viejas Reliquias', 'Latinos'] },
        { id: '96', name: 'Kajal Napalm', youtubeUrl: 'https://youtu.be/KCHIZjiq7xE?si=2sjBnFR2TaZBvHbm', videoId: 'KCHIZjiq7xE', tier: null, categories: ['Viejas Reliquias', 'Españoles'], featuring: ['Joaquinpa','Carla Laubaló'] },
        { id: '97', name: 'Angie Corine', youtubeUrl: 'https://youtu.be/MaOTXphstBg?si=OfkLPmXSILnKP7-d', videoId: 'MaOTXphstBg', tier: null, categories: ['Mainstream', 'Tiktokers', 'Españoles'] },
        { id: '98', name: 'Carla Laubalo', youtubeUrl: 'https://youtu.be/RpBy2THK-PM?si=yKiVuYebNbAHkyfm', videoId: 'RpBy2THK-PM', tier: null, categories: ['Españoles'], featuring: ['iLeoVlogs'] },
        { id: '99', name: 'Epidemic77', youtubeUrl: 'https://youtu.be/uuoL1k_gaeA?si=elNc8BLbq9R9R8uM', videoId: 'uuoL1k_gaeA', tier: null, categories: ['Latinos'] },
        { id: '100', name: 'Manucraft (Parodia)', youtubeUrl: 'https://youtu.be/TIasEF9dfes?si=2QdupINBZOzhzRLx', videoId: 'TIasEF9dfes', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '101', name: 'Manucraft', youtubeUrl: 'https://youtu.be/g41QnkH1YhQ?si=-dldElbvDXL0ytS6', videoId: 'g41QnkH1YhQ', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '102', name: 'Tatito Tales', youtubeUrl: 'https://youtu.be/ySw9EG4dmRk?si=gC9cF-NMWNcodMB1', videoId: 'ySw9EG4dmRk', tier: null, categories: ['Minecraft', 'Latinos'] },
        { id: '103', name: 'invictor', youtubeUrl: 'https://youtu.be/e57xlonP88A?si=6xzONAlZWAqXSKUv', videoId: 'e57xlonP88A', tier: null, categories: ['Minecraft', 'Niños', 'Latinos'] },
        { id: '104', name: 'Timba Vk', youtubeUrl: 'https://youtu.be/s20ZdAFqCn0?si=2FYXt8kk_fIhdvxS', videoId: 's20ZdAFqCn0', tier: null, categories: ['Minecraft', 'Niños', 'Latinos'] },
        { id: '105', name: 'RaptorGamer', youtubeUrl: 'https://youtu.be/KXmHxcsBuG4?si=9skJma9aQrc-iYbc', videoId: 'KXmHxcsBuG4', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'], featuring: ['ilonqueen'] },
        { id: '106', name: 'Alexy', youtubeUrl: 'https://youtu.be/3ttJD7jeTH0?si=ovvw7YFHWD-dCk3L', videoId: '3ttJD7jeTH0', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '107', name: 'ElTrollino', youtubeUrl: 'https://youtu.be/6NpTJleajBs?si=loRFm64a2-Lcv2b3', videoId: '6NpTJleajBs', tier: null, categories: ['Minecraft', 'Niños', 'Latinos'], featuring: ['Mikecrack', 'Timba Vk'] },
        { id: '108', name: 'Apixelados', youtubeUrl: 'https://youtu.be/oh_35zaKOoA?si=rzvZrQPTkckAoR_W', videoId: 'oh_35zaKOoA', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'], featuring: ['Dagar'] },
        { id: '109', name: 'Bobicraft', youtubeUrl: 'https://youtu.be/GjS4lAc2Yjc?si=Uk-qGZj-O1qtOTEA', videoId: 'GjS4lAc2Yjc', tier: null, categories: ['Minecraft', 'Niños', 'Latinos'] },
        { id: '110', name: 'Tina Sánchez', youtubeUrl: 'https://youtu.be/woZCjjamUFM?si=CtEH8S8Gbm0dqAo1', videoId: 'woZCjjamUFM', tier: null, categories: ['Españoles'] },
        { id: '111', name: 'BPancri', youtubeUrl: 'https://youtu.be/cNi6ULhyjq8?si=ekZrc0MnwMYSixVs', videoId: 'cNi6ULhyjq8', tier: null, categories: ['Minecraft', 'Niños', 'Españoles'] },
        { id: '112', name: 'Jacky (CooLifeGame)', youtubeUrl: 'https://youtu.be/LmSNELQ6Tuc?si=sqYsxvtNaEnk1mgT', videoId: 'LmSNELQ6Tuc', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Zarcort', 'Cyclo', 'Keyblade'] },
        { id: '113', name: 'byViruZz', youtubeUrl: 'https://youtu.be/11YP9CA3tLk?si=rsN-zLG4Vmhnqmz6', videoId: '11YP9CA3tLk', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '114', name: 'Brunenger', youtubeUrl: 'https://youtu.be/WmXAqa8KwIQ?si=BC_EqNpqluaYUpFo', videoId: 'WmXAqa8KwIQ', tier: null, categories: ['Mainstream', 'Latinos'] },
        { id: '115', name: 'Folagor03', youtubeUrl: 'https://youtu.be/p7mpr5qyB3o?si=UY2fzewp_kOBBM13', videoId: 'p7mpr5qyB3o', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Sinapsis'] },
        { id: '116', name: 'Amouranth', youtubeUrl: 'https://youtu.be/3w597wLFSxg?si=e3wBpNajaoHGsFCL', videoId: '3w597wLFSxg', tier: null, categories: ['Mainstream'] },
        { id: '117', name: 'Papi Gavi', youtubeUrl: 'https://youtu.be/5MTiv9UGAhQ?si=fSxqIzFgBYwZNH6I', videoId: '5MTiv9UGAhQ', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '118', name: 'Ampeterby7', youtubeUrl: 'https://youtu.be/5rlEM7-nazc?si=5SiPxUNDSAoi8aSV', videoId: '5rlEM7-nazc', tier: null, categories: ['Mainstream', 'Españoles'], featuring: ['Sinapsis'] },
        { id: '119', name: 'TheGrefg', youtubeUrl: 'https://youtu.be/JG1-ciVWqIA?si=ZNaqBrWSe2QWIxNc', videoId: 'JG1-ciVWqIA', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '120', name: 'JHdelacruz777', youtubeUrl: 'https://youtu.be/jlskG_ett5M?si=8V6jF9BeMH56OdBo', videoId: 'jlskG_ett5M', tier: null, categories: ['Tiktokers', 'Latinos'] },
        { id: '121', name: 'Lolito Fdez', youtubeUrl: 'https://youtu.be/aLgEOEXitLI?si=gKRJuAIbR7BokT2v', videoId: 'aLgEOEXitLI', tier: null, categories: ['Mainstream', 'Españoles'] },
        { id: '122', name: 'Erra', youtubeUrl: 'https://youtu.be/WqH9c5Z8EBQ?si=3Q98p8reM6LCvMw8', videoId: 'WqH9c5Z8EBQ', tier: null, categories: ['Mainstream', 'Tiktokers', 'Españoles'], featuring: ['Juan Beato', 'Plex', 'Jopa', 'Adri', 'Borja'] },
        { id: '123', name: 'El Cejas', youtubeUrl: 'https://youtu.be/okf2nQC2R1E?si=f65BJ0MMvoAv9BW0', videoId: 'okf2nQC2R1E', tier: null, categories: ['Tiktokers', 'Españoles'] },
        { id: '124', name: 'Hamza Zaidi', youtubeUrl: 'https://youtu.be/4VEW-sHCvU4?si=uBmfUZ9oAP2eSecs', videoId: '4VEW-sHCvU4', tier: null, categories: ['Tiktokers', 'Españoles'], featuring: ['El Cejas', 'Omar Montes'] },
        { id: '125', name: 'Dudu', youtubeUrl: 'https://youtu.be/xhI3DA2SXg8?si=dYyjcLhdIH39m8wm', videoId: 'xhI3DA2SXg8', tier: null, categories: ['Españoles'] },
        { id: '126', name: 'Mar Lucas', youtubeUrl: 'https://youtu.be/dLiOguzsKOo?si=Hd1Z33X_NglUNMoK', videoId: 'dLiOguzsKOo', tier: null, categories: ['Tiktokers', 'Españoles'] },
        { id: '127', name: 'Paula Gonu', youtubeUrl: 'https://youtu.be/_IX4pzXqDZU?si=jhOXXPQ2ySfnhf44', videoId: '_IX4pzXqDZU', tier: null, categories: ['Tiktokers', 'Españoles'], featuring: ['Zarcort', 'Piter G', 'Cyclo'] },
        { id: '128', name: 'Paul Ferrer', youtubeUrl: 'https://youtu.be/HzHKUCl4DMU?si=yxyU0UMCp9uWSGmc', videoId: 'HzHKUCl4DMU', tier: null, categories: ['Tiktokers', 'Españoles'] },
        { id: '129', name: 'La Xinni', youtubeUrl: 'https://youtu.be/8P1snc4Cbeg?si=fvOi9eNCotE6O214', videoId: '8P1snc4Cbeg', tier: null, categories: ['Tiktokers', 'Españoles'] },
        { id: '130', name: 'Twin Melody', youtubeUrl: 'https://youtu.be/5zm0Nx8MpiU?si=ftMJNIyMAYqRKjRT', videoId: '5zm0Nx8MpiU', tier: null, categories: ['Tiktokers', 'Latinos'] },
        { id: '131', name: 'Peereira7', youtubeUrl: 'https://youtu.be/w9GwwXX5FJs?si=8OhSPl3-sbwDgKdN', videoId: 'w9GwwXX5FJs', tier: null, categories: ['Mainstream', 'Españoles', 'Minecraft'], featuring: ['Agustin51'] },
        { id: '132', name: 'El Patica', youtubeUrl: 'https://youtu.be/ATQFtsgBQIA?si=SIWbWWQuu9vK14WG', videoId: 'ATQFtsgBQIA', tier: null, categories: ['Tiktokers', 'Españoles'], featuring: ['Polifacetico'] },
        { id: '133', name: 'Zaira DLM', youtubeUrl: 'https://youtu.be/7I2nNlZFeAs?si=y9cydoYD5yA_2BMv', videoId: '7I2nNlZFeAs', tier: null, categories: ['Tiktokers', 'Españoles'] },
        { id: '134', name: 'Labrador', youtubeUrl: 'https://youtu.be/Sh88Tj3F0hQ?si=-XuzDzkjNGrPF-Gb', videoId: 'Sh88Tj3F0hQ', tier: null, categories: ['Tiktokers', 'Españoles'] },
        { id: '135', name: 'CeciArmy', youtubeUrl: 'https://youtu.be/T_UaR_kxWm8?si=R_MoQVhSMiBPrNtv', videoId: 'T_UaR_kxWm8', tier: null, categories: ['Tiktokers', 'Españoles'], featuring: ['Hamza Zaidi', 'Nil Ojeda'] },
        { id: '136', name: 'Ian Lucas', youtubeUrl: 'https://youtu.be/v5JFACAK3ws?si=4subz8O71hs0qyyA', videoId: 'v5JFACAK3ws', tier: null, categories: ['Latinos'] },
        { id: '137', name: 'Archie Ted', youtubeUrl: 'https://youtu.be/B7NdSrZdh8A?si=XRT4pFvm-qJdZbDE', videoId: 'B7NdSrZdh8A', tier: null, categories: ['Españoles'] },
        { id: '138', name: 'xBuyer', youtubeUrl: 'https://youtu.be/5B6CSWVCG68?si=DCPcm-QVsxG1hgxc', videoId: '5B6CSWVCG68', tier: null, categories: ['Españoles'] },
        { id: '139', name: 'Lucia De La Puerta', youtubeUrl: 'https://youtu.be/4EgD9RtpKdg?si=MP_Mu6wjeXU3QYTC', videoId: '4EgD9RtpKdg', tier: null, categories: ['Españoles'] },
        { id: '140', name: 'ilonqueen', youtubeUrl: 'https://youtu.be/FaVb-N7KfEo?si=Pw2JiXcJc44hKAqK', videoId: 'FaVb-N7KfEo', tier: null, categories: ['Latinos'] },
        { id: '141', name: 'Zarcort', youtubeUrl: 'https://youtu.be/wAMZ6KpMGQI?si=gyt6EuyImpJfYGsc', videoId: 'wAMZ6KpMGQI', tier: null, categories: ['Españoles'] },
        { id: '142', name: 'La Marrash', youtubeUrl: 'https://youtu.be/QOooudArnkE?si=2vMxE2pt3oPkR_IK', videoId: 'QOooudArnkE', tier: null, categories: ['Tiktokers', 'Españoles'] },
    ];

        // Datos de las canciones de fans - LISTA ACTUALIZADA
        const fansInfluencersData = [
            { id: '1000', name: 'Aroyitt', youtubeUrl: 'https://youtu.be/8M7qoUtjixc?si=EU4KEjHiUfGijMCv', videoId: '8M7qoUtjixc', tier: null },
            { id: '1001', name: 'Aroyitt (Cover)', youtubeUrl: 'https://youtu.be/BW3BGT3YqjU?si=3p7bsvmlUkVMSVYZ', videoId: 'BW3BGT3YqjU', tier: null },
            { id: '1002', name: 'Vegetta777', youtubeUrl: 'https://youtu.be/s1cj9Htf-Mg?si=zegfPcCQpNYzKyoo', videoId: 's1cj9Htf-Mg', tier: null },
            { id: '1003', name: 'Rivers', youtubeUrl: 'https://youtu.be/a2VX-d1kezY?si=k-FAHtTljrvteKL8', videoId: 'a2VX-d1kezY', tier: null },
            { id: '1004', name: 'Luzu', youtubeUrl: 'https://youtu.be/De8cf9txw-M?si=LRo6KmtxidezXFOH', videoId: 'De8cf9txw-M', tier: null },
            { id: '1005', name: 'Axozer (cover bichota)', youtubeUrl: 'https://youtu.be/_XPC_1ENvqs?si=59jnOVwdR2sVMAzs', videoId: '_XPC_1ENvqs', tier: null },
            { id: '1006', name: 'AuronPlay', youtubeUrl: 'https://youtu.be/82bb3TZLj9g?si=NTzpk5CcGXgAKJps', videoId: '82bb3TZLj9g', tier: null },
            { id: '1007', name: 'Elisa Waves', youtubeUrl: 'https://youtu.be/IQfvNIscci8?si=n2B3TJLJ3971mpfP', videoId: 'IQfvNIscci8', tier: null },
            { id: '1008', name: 'Reborn', youtubeUrl: 'https://youtu.be/IgXqlS5QTfg?si=ADaP-J-k-l7t3jJt', videoId: 'IgXqlS5QTfg', tier: null },
            { id: '1009', name: 'Fernanfloo', youtubeUrl: 'https://youtu.be/uHjW3zxbyf4?si=aRUlqUQIPCSJKqhf', videoId: 'uHjW3zxbyf4', tier: null },
            { id: '1010', name: 'ElRichMC', youtubeUrl: 'https://youtu.be/CbAGFpjNGdM?si=EN5gv8GkZ8ndtOXP', videoId: 'CbAGFpjNGdM', tier: null },
            { id: '1011', name: 'RedstoneCanarias', youtubeUrl: 'https://youtu.be/cWJmkyfAqhA?si=DRXGzXqf5gFrVtYi', videoId: 'cWJmkyfAqhA', tier: null }
        ];


        // Variables globales
        let selectedCategories = new Set(); // CAMBIO: Ahora es un Set para múltiples categorías
        let categoriesData = {}; // Se llenará dinámicamente
        let mainInfluencers = [...mainInfluencersData];
        let fansInfluencers = [...fansInfluencersData];
        let revealedCards = new Set();
        let isModalOpen = false;
        let nextId = 143;
        let fansToggleActive = false;
        let currentInfluencer = null;
        let draggedElement = null;
        let tierlistChart = null; // Instancia de la gráfica
        let draggedInfluencer = null;
        let isTierlistModalOpen = false; // <-- AÑADE ESTA LÍNEA
        let categoryFilterMode = 'or'; // 'or' o 'and'
        let isPartyModeActive = localStorage.getItem('cancinfluencers_partyMode') === 'true';
        let viewMode = 'grid'; // 'grid' o 'carousel'
        let carouselIndex = 0;
        let touchStartX = 0;
        let touchEndX = 0;

                // --- FUNCIÓN AUXILIAR: OBTENER LISTA FILTRADA (PARA GRID Y CARRUSEL) ---
        function getVisibleInfluencers() {
            let influencersToRender = [...mainInfluencers];

            // Filtro categorías
            if (selectedCategories.size > 0 && selectedCategories.size < Object.keys(categoriesData).length) {
                influencersToRender = influencersToRender.filter(influencer => {
                    if (!influencer.categories) return false;
                    if (categoryFilterMode === 'and') {
                        return [...selectedCategories].every(cat => influencer.categories.includes(cat));
                    } else {
                        return influencer.categories.some(cat => selectedCategories.has(cat));
                    }
                });
            }

            // Filtro búsqueda
            const searchInput = document.getElementById('searchInput');
            if (searchInput && searchInput.value.trim() !== '') {
                const searchTerm = searchInput.value.toLowerCase();
                influencersToRender = influencersToRender.filter(influencer => {
                    const nameMatch = influencer.name.toLowerCase().includes(searchTerm);
                    const featMatch = influencer.featuring && influencer.featuring.some(name => 
                        name.toLowerCase().includes(searchTerm)
                    );
                    return nameMatch || featMatch;
                });
            }
            return influencersToRender;
        }
  
                // --- FUNCIÓN: ESTABLECER MODO DE VISTA (ACTUALIZADA) ---
        function setViewMode(mode) {
            const cardsGrid = document.getElementById('cardsGrid');
            const carouselView = document.getElementById('carouselView');
            
            viewMode = mode;

            if (mode === 'carousel') {
                cardsGrid.style.display = 'none';
                carouselView.style.display = 'flex';
                renderCarousel();
            } else {
                cardsGrid.style.display = 'grid';
                carouselView.style.display = 'none';
                renderCards();
            }
            
            closeModesModal(); // Cerramos el modal al elegir
        }

        // --- FUNCIÓN: RENDERIZAR CARRUSEL ---
        function renderCarousel() {
            const track = document.getElementById('carouselTrack');
            const counter = document.getElementById('carouselCounter');
            const visibleInfluencers = getVisibleInfluencers();
            
            track.innerHTML = ''; // Limpiar
            
            // Manejar índice fuera de rango
            if (carouselIndex >= visibleInfluencers.length) {
                carouselIndex = Math.max(0, visibleInfluencers.length - 1);
            }
            
            if (visibleInfluencers.length === 0) {
                track.innerHTML = '<div class="no-results" style="display:block;">No hay cartas</div>';
                counter.textContent = '0 / 0';
                return;
            }

            const currentInfluencer = visibleInfluencers[carouselIndex];
            const card = createCard(currentInfluencer);
            track.appendChild(card);
            
            // Actualizar contador
            counter.textContent = `${carouselIndex + 1} / ${visibleInfluencers.length}`;
            
            // Actualizar estado de botones (opcional: desactivar en extremos)
            document.getElementById('carouselPrev').style.opacity = carouselIndex === 0 ? '0.5' : '1';
            document.getElementById('carouselNext').style.opacity = carouselIndex === visibleInfluencers.length - 1 ? '0.5' : '1';
        }

        // --- NAVEGACIÓN CARRUSEL ---
        function nextSlide() {
            const visible = getVisibleInfluencers();
            if (carouselIndex < visible.length - 1) {
                carouselIndex++;
                renderCarousel();
            }
        }

        function prevSlide() {
            if (carouselIndex > 0) {
                carouselIndex--;
                renderCarousel();
            }
        }

        // --- SISTEMA DE LOGROS ---
        let shuffleCount = parseInt(localStorage.getItem('cancinfluencers_shuffleCount') || '0');
        let modalOpenTimestamp = null; // Para medir tiempo del video
        let logoClickCount = 0;        // Para contar clics en el logo
        let logoClickTimeout = null;   // Para resetear el contador

        const defaultAchievements = [
            { id: 'first_reveal', name: 'Primera Canción', description: 'Revela tu primera carta', icon: '🎵', unlocked: false, progress: 0, maxProgress: 1 },
            { id: 'collector_50', name: 'Coleccionista', description: 'Revela 50 cartas', icon: '📦', unlocked: false, progress: 0, maxProgress: 50 },
            { id: 'critic_10', name: 'Crítico Novato', description: 'Clasifica 10 canciones', icon: '⭐', unlocked: false, progress: 0, maxProgress: 10 },
            { id: 'critic_50', name: 'Crítico Experto', description: 'Clasifica 50 canciones', icon: '🌟', unlocked: false, progress: 0, maxProgress: 50 },
            { id: 'critic_100', name: 'Crítico Maestro', description: 'Clasifica 100 canciones', icon: '👑', unlocked: false, progress: 0, maxProgress: 100 },
            { id: 'konami', name: 'Easter Egg', description: 'Descubre el secreto oculto', icon: '🥚', unlocked: false, progress: 0, maxProgress: 1 },
            { id: 'tinder', name: 'Tinder', description: 'Usa la calculadora de compatibilidad', icon: '❤️', unlocked: false, progress: 0, maxProgress: 1 },
            { id: 'exporter', name: 'El Exportador', description: 'Genera tu primer código para compartir', icon: '📤', unlocked: false, progress: 0, maxProgress: 1 },
            { id: 'customizer', name: 'Personalizador', description: 'Cambia el nombre de un tier por uno personalizado', icon: '🎨', unlocked: false, progress: 0, maxProgress: 1 },
            { id: 'intro_hater', name: 'Hater', description: 'Cierra el video en menos de 5 segundos', icon: '⏩', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'exorcist', name: 'El Exorcista', description: 'Intenta arrastrar una carta fuera de la tierlist', icon: '👻', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'logo_clicker', name: 'Clicker Oculto', description: 'Haz clic 5 veces en el logo', icon: '🖱️', unlocked: false, progress: 0, maxProgress: 5, hidden: true },
            { id: 'detective', name: 'El Detective', description: 'Busca al creador de la web', icon: '🕵️', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'no_results', name: 'Sin Resultados', description: 'Busca algo imposible de encontrar', icon: '🔭', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'archaeologist', name: 'Arqueólogo', description: 'Revela todas las "Viejas Reliquias" primero', icon: '🦴', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'team_minecraft', name: 'Team Minecraft', description: 'Clasifica a todos los influencers de Minecraft', icon: '⛏️', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'the_climb', name: 'El Ascenso', description: 'Mueve una carta directamente del Tier F al S', icon: '🚀', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'fresh_start', name: 'Borrón y Cuenta Nueva', description: 'Reinicia tu progreso usando el botón de reinicio', icon: '💣', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'pambisito', name: 'Pambisito', description: 'Encuentra la carta de Dalas Review sin usar el buscador', icon: '🍞', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'before_after', name: 'Antes y Después', description: 'Colecciona la carta de DaniRep 2017 y la de DaniRep Actual', icon: '⏮️', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'identity_crisis', name: 'Crisis de Identidad', description: 'Consigue ambas cartas de Joaquinpa/Jokki', icon: '🎭', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'hola_german', name: '¡Hola, soy German!', description: 'Consigue la carta de German Garmendia', icon: '👋', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'ninos_rata', name: 'Niños Rata', description: 'Consigue la carta de Zarcort', icon: '🐀', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'karmaland', name: 'Karmaland', description: 'Reúne a Quackity, ElRubiusOMG, Willyrex, illojuan y Lolito Fdez', icon: '🏝️', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'wii', name: 'Cuando Quieras Jugamos a la Wii', description: 'Consigue la carta de Folagor03', icon: '🎮', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'gemelos_2', name: 'La Casa de los Gemelos 2', description: 'Reúne a Ruth La Peke, La Marrash, El Patica, Zaira DLM y Labrador', icon: '🏚️', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'ruptura', name: 'Ruptura', description: 'Reúne a Illojuan y Masi', icon: '💔', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'juicio', name: 'Juicio', description: 'Reúne a DalasReview y Wismichu', icon: '⚖️', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'perros_minecraft', name: 'Los Perros de Minecraft', description: 'Reúne a Mikecrack y Bobicraft', icon: '🐕', unlocked: false, progress: 0, maxProgress: 1, hidden: true },
            { id: 'collector_all', name: 'Maestro Coleccionista', description: 'Revela todas las cartas', icon: '🏆', unlocked: false, progress: 0, maxProgress: 0 },

];


        let achievements = JSON.parse(JSON.stringify(defaultAchievements));

        // Nombres personalizados de tiers
        let customTierNames = {
            s: 'S',
            a: 'A',
            b: 'B',
            c: 'C',
            d: 'D',
            f: 'F'
        };

                // Colores por defecto
        let customTierColors = {
            s: '#ff7f7f',
            a: '#ffbf7f',
            b: '#ffff7f',
            c: '#7fff7f',
            d: '#7fffff',
            f: '#7f7fff'
        };

        // Función para cargar nombres personalizados desde localStorage
        function loadCustomTierNames() {
            const saved = localStorage.getItem('customTierNames');
            if (saved) {
                try {
                    customTierNames = JSON.parse(saved);
                } catch (e) {
                    console.error('Error al cargar nombres personalizados:', e);
                }
            }
        }

        // Función para generar el objeto de datos de categorías
function generateCategoriesData() {
    const data = {};
    mainInfluencersData.forEach(influencer => {
        if (influencer.categories) {
            influencer.categories.forEach(category => {
                if (!data[category]) {
                    data[category] = [];
                }
                data[category].push(influencer);
            });
        }
    });
    return data;
}

// Función para abrir el modal de categorías
function openCategoriesModal() {
    categoriesData = generateCategoriesData();
    renderCategories();
    
    // Actualizar estadísticas
    const totalCategoriesEl = document.getElementById('totalCategories');
    const totalInfluencersEl = document.getElementById('totalInfluencers');
    if (totalCategoriesEl) totalCategoriesEl.textContent = Object.keys(categoriesData).length;
    if (totalInfluencersEl) totalInfluencersEl.textContent = mainInfluencersData.length;

    const categoriesModal = document.getElementById('categoriesModal');
    categoriesModal.style.display = 'flex';
    setTimeout(() => {
        categoriesModal.classList.add('active');
    }, 10);
}

// Función para cerrar el modal de categorías
function closeCategoriesModal() {
    const categoriesModal = document.getElementById('categoriesModal');
    categoriesModal.classList.remove('active');
    setTimeout(() => {
        categoriesModal.style.display = 'none';
    }, 300);
}

// Función para renderizar las categorías en el modal - VERSIÓN CON CONTADOR
function renderCategories() {
    const container = document.getElementById('categoriesContainer');
    if (!container) return;
    container.innerHTML = '';

    // Añadir botón "Todos" al principio
    const allButton = document.createElement('button');
    allButton.className = 'category-header-btn all-btn';
    
    // Verificar si todas las categorías están seleccionadas
    const totalCats = Object.keys(categoriesData).length;
    const allCategoriesSelected = selectedCategories.size === totalCats;
    
    if (selectedCategories.size === 0 || allCategoriesSelected) {
        allButton.classList.add('selected');
    }
    
    // --- NUEVO: HTML con span para el contador ---
    allButton.innerHTML = `
        <span class="category-name">Todos</span>
        <span class="category-count">${mainInfluencersData.length} totales</span>
    `;
    
    allButton.addEventListener('click', () => {
        if (allCategoriesSelected) {
            selectedCategories.clear();
        } else {
            selectAllCategories();
        }
        renderCategories();
    });
    container.appendChild(allButton);

    // Renderizar categorías existentes
    Object.keys(categoriesData).forEach(categoryName => {
        const categoryButton = document.createElement('button');
        categoryButton.className = 'category-header-btn';
        
        if (selectedCategories.has(categoryName)) {
            categoryButton.classList.add('selected');
        }
        
        const count = categoriesData[categoryName].length;

        // --- NUEVO: HTML con span para el contador ---
        categoryButton.innerHTML = `
            <span class="category-name">${categoryName}</span>
            <span class="category-count">${count} influencers</span>
        `;

        categoryButton.addEventListener('click', () => {
            toggleCategory(categoryName);
        });
        container.appendChild(categoryButton);
    });

    // Actualizar contador de seleccionados y total de influencers
    updateSelectedCount();
    updateTotalInfluencersCount();
}

// Nueva función para contar influencers en categorías seleccionadas
function updateTotalInfluencersCount() {
    const el = document.getElementById('totalInfluencers');
    let unique = new Set();
    const totalCats = Object.keys(categoriesData).length;

    if (selectedCategories.size === 0 || selectedCategories.size === totalCats) {
        el.textContent = mainInfluencersData.length;
    } else {
        // Filtrar según el modo actual
            mainInfluencersData.filter(inf => {
            if (!inf.categories) return false;
            if (categoryFilterMode === 'and') {
                return [...selectedCategories].every(c => inf.categories.includes(c));
            } else {
                return inf.categories.some(c => selectedCategories.has(c));
            }
        }).forEach(i => unique.add(i.id));
        el.textContent = unique.size;
    }
}

// Corrección para la función selectAllCategories
function selectAllCategories() {
    // Limpiar selecciones actuales
    selectedCategories.clear();
    
    // Seleccionar todas las categorías disponibles
    Object.keys(categoriesData).forEach(categoryName => {
        selectedCategories.add(categoryName);
    });
    
    renderCategories();
}

// Función para toggle de categoría
function toggleCategory(categoryName) {
    if (selectedCategories.has(categoryName)) {
        selectedCategories.delete(categoryName);
    } else {
        selectedCategories.add(categoryName);
    }
    renderCategories();
}

        function toggleFilterLogic() {
            const switchEl = document.getElementById('logicSwitch');
            const slider = document.getElementById('logicSlider');
            const labelOr = document.getElementById('labelOr');
            const labelAnd = document.getElementById('labelAnd');

            if (categoryFilterMode === 'or') {
                categoryFilterMode = 'and';
                switchEl.classList.remove('or-active');
                switchEl.classList.add('and-active');
                slider.textContent = '➡';
                labelOr.classList.remove('active');
                labelAnd.classList.add('active');
                // ARIA
                switchEl.setAttribute('aria-checked', 'true');
            } else {
                categoryFilterMode = 'or';
                switchEl.classList.remove('and-active');
                switchEl.classList.add('or-active');
                slider.textContent = '⬅';
                labelAnd.classList.remove('active');
                labelOr.classList.add('active');
                // ARIA
                switchEl.setAttribute('aria-checked', 'false');
            }
            updateTotalInfluencersCount();
        }

// Función para actualizar el contador de categorías seleccionadas
function updateSelectedCount() {
    const selectedCountEl = document.getElementById('selectedCount');
    if (selectedCountEl) {
        const totalCategories = Object.keys(categoriesData).length;
        if (selectedCategories.size > 0 && selectedCategories.size < totalCategories) {
            selectedCountEl.style.display = 'block';
            selectedCountEl.textContent = `${selectedCategories.size} de ${totalCategories} categorías seleccionadas`;
        } else {
            selectedCountEl.style.display = 'none';
        }
    }
}

// Función para limpiar todas las selecciones
function clearAllCategories() {
    selectedCategories.clear();
    renderCategories();
}

// Función para aplicar filtros (ACTUALIZADA)
function applyFilters() {
    // Actualizar UI del filtro activo
    const activeCategoryInfo = document.getElementById('activeCategoryInfo');
    const activeCategoryName = document.getElementById('activeCategoryName');
    if (activeCategoryInfo && activeCategoryName) {
        if (selectedCategories.size > 0 && selectedCategories.size < Object.keys(categoriesData).length) {
            activeCategoryInfo.style.display = 'flex';
            const categoriesList = Array.from(selectedCategories).join(', ');
            activeCategoryName.textContent = `Filtrando por: ${categoriesList}`;
        } else {
            activeCategoryInfo.style.display = 'none';
        }
    }

    refreshActiveView(); // <--- CAMBIO CLAVE
    closeCategoriesModal();
    
    if (selectedCategories.size > 0 && selectedCategories.size < Object.keys(categoriesData).length) {
        showNotification(`Mostrando influencers de ${selectedCategories.size} categorías`);
    } else {
        showNotification('Mostrando todos los influencers');
    }
}

// Función para buscar influencers (ACTUALIZADA)
function searchInfluencers() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return;
    
    const searchTerm = searchInput.value.toLowerCase();
    
    if (searchTerm === '') {
        mainInfluencers = [...mainInfluencersData];
    } else {
        mainInfluencers = mainInfluencersData.filter(influencer => {
            const nameMatch = influencer.name.toLowerCase().includes(searchTerm);
            const featMatch = influencer.featuring && influencer.featuring.some(name => 
                name.toLowerCase().includes(searchTerm)
            );
            return nameMatch || featMatch;
        });
    }
    
    refreshActiveView(); // <--- CAMBIO CLAVE
    
    // Logros...
    const searchTermRaw = searchInput.value.toLowerCase();
    if (searchTermRaw.includes('maiquel3000') || searchTermRaw.includes('maiquel3k') || searchTermRaw === 'maiquel') {
        updateAchievement('detective', 1);
    }
    if (mainInfluencers.length === 0 && searchTermRaw.length >= 5) {
        updateAchievement('no_results', 1);
    }
}

// Función para limpiar el filtro de categoría (ACTUALIZADA)
function clearCategoryFilter() {
    selectedCategories.clear();
    mainInfluencers = [...mainInfluencersData];
    
    const activeCategoryInfo = document.getElementById('activeCategoryInfo');
    if (activeCategoryInfo) {
        activeCategoryInfo.style.display = 'none';
    }
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) searchInput.value = '';

    refreshActiveView(); // <--- CAMBIO CLAVE
    showNotification('Mostrando todos los influencers');
}

        // Función para guardar nombres personalizados en localStorage
        function saveCustomTierNames() {
            try {
                localStorage.setItem('customTierNames', JSON.stringify(customTierNames));
            } catch (e) {
                console.error('Error al guardar nombres personalizados:', e);
            }
        }

                // Función para cargar colores desde localStorage
        function loadCustomTierColors() {
            const saved = localStorage.getItem('customTierColors');
            if (saved) {
                try {
                    customTierColors = JSON.parse(saved);
                } catch (e) {
                    console.error('Error al cargar colores:', e);
                }
            }
        }

        // Función para guardar colores en localStorage
        function saveCustomTierColors() {
            try {
                localStorage.setItem('customTierColors', JSON.stringify(customTierColors));
            } catch (e) {
                console.error('Error al guardar colores:', e);
            }
        }

        // Función para aplicar los colores al CSS (Actualiza las variables CSS)
        function applyTierColors() {
            const root = document.documentElement;
            Object.keys(customTierColors).forEach(tier => {
                root.style.setProperty(`--tier-${tier}-color`, customTierColors[tier]);
            });
        }

        // Función para obtener el nombre del tier
        function getTierName(tier) {
            // Caso especial para "Sin Clasificar"
            if (tier === 'unclassified') {
                return 'Sin Clasificar';
            }
            // Para el resto, usa nombres personalizados o mayúsculas
            return customTierNames[tier] || tier.toUpperCase();
        }

        // Función para extraer el ID del video de YouTube de una URL
        function getYouTubeId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : null;
        }

        // Función para validar URL de YouTube
        function isValidYouTubeUrl(url) {
            const youtubeRegex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/;
            return youtubeRegex.test(url) && getYouTubeId(url) !== null;
        }

        // Función para crear una tarjeta
                function createCard(influencer) {
            const cardContainer = document.createElement('div');
            cardContainer.className = 'card-container';
            cardContainer.dataset.id = influencer.id;
            cardContainer.setAttribute('role', 'listitem');

            const card = document.createElement('div');
            card.className = 'card';
            
            // --- ACCESIBILIDAD: Atributos ARIA y Foco ---
            card.setAttribute('tabindex', '0');
            const isRevealed = revealedCards.has(influencer.id);
            const labelText = isRevealed 
                ? `${influencer.name}. Carta revelada. Pulsa para ver video.` 
                : `${influencer.name}. Carta oculta. Pulsa para revelar.`;
            card.setAttribute('aria-label', labelText);
            
            const cardFront = document.createElement('div');
            cardFront.className = 'card-face card-front';
            
            const musicIcon = document.createElement('div');
            musicIcon.className = 'music-icon';
            musicIcon.textContent = '🎶';
            musicIcon.setAttribute('aria-hidden', 'true'); // Icono decorativo
            
            const cardText = document.createElement('div');
            cardText.className = 'card-front-text';
            cardText.textContent = '¡Descubre!';
            
            const cardSubtext = document.createElement('div');
            cardSubtext.className = 'card-front-subtext';
            cardSubtext.textContent = 'Haz clic para ver el video';
            
            cardFront.appendChild(musicIcon);
            cardFront.appendChild(cardText);
            cardFront.appendChild(cardSubtext);
            
            const cardBack = document.createElement('div');
            cardBack.className = 'card-face card-back';
            
            const influencerHeader = document.createElement('div');
            influencerHeader.className = 'influencer-header';
            
            const influencerName = document.createElement('div');
            influencerName.className = 'influencer-name';
            influencerName.textContent = influencer.name;
            influencerHeader.appendChild(influencerName);

            if (influencer.featuring && influencer.featuring.length > 0) {
                const featElement = document.createElement('div');
                featElement.className = 'influencer-feat';
                featElement.textContent = 'ft. ' + influencer.featuring.join(', ');
                influencerHeader.appendChild(featElement);
            }
            cardBack.appendChild(influencerHeader);
            
            const videoContainer = document.createElement('div');
            videoContainer.className = 'video-container';
            
            const videoThumbnail = document.createElement('img');
            videoThumbnail.className = 'video-thumbnail';
            videoThumbnail.src = `https://img.youtube.com/vi/${influencer.videoId}/maxresdefault.jpg`;
            videoThumbnail.alt = ""; // Imagen decorativa
            videoThumbnail.dataset.videoId = influencer.videoId;
            videoThumbnail.onerror = function() { this.src = `https://img.youtube.com/vi/${this.dataset.videoId}/hqdefault.jpg`; };
            videoThumbnail.setAttribute('aria-hidden', 'true');
            
            const playButton = document.createElement('div');
            playButton.className = 'play-button';
            playButton.setAttribute('aria-hidden', 'true');
            
            videoContainer.appendChild(videoThumbnail);
            videoContainer.appendChild(playButton);
            cardBack.appendChild(influencerHeader);
            cardBack.appendChild(videoContainer);
            
            card.appendChild(cardFront);
            card.appendChild(cardBack);
            cardContainer.appendChild(card);
            
            // Eventos Ratón
            card.addEventListener('click', function() { handleCardClick(influencer, card); });
            playButton.addEventListener('click', function(e) { e.stopPropagation(); openModal(influencer); });
            videoThumbnail.addEventListener('click', function(e) { e.stopPropagation(); openModal(influencer); });

            // --- ACCESIBILIDAD: Eventos Teclado ---
            card.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    handleCardClick(influencer, card);
                }
            });
            
            return cardContainer;
        }

                // Función para manejar el clic en una tarjeta
        function handleCardClick(influencer, card) {
            if (card.classList.contains('flipped')) {
                openModal(influencer);
                return; // <--- El return termina la función aquí, el código de abajo no se ejecuta si ya estaba girada
            }
            
            card.classList.add('animating');
            
            setTimeout(() => {
                card.classList.remove('animating');
                card.classList.add('flipped');
                revealedCards.add(influencer.id);
                card.classList.add('revealed');
                
                // Añadir a la lista de no clasificados si no tiene tier
                if (!influencer.tier) {
                    tierlistData.unclassified.push(influencer);
                }

                // --- LOGRO: PAMBISITO (Lógica corregida) ---
                // Solo se desbloquea si encuentras a Dalas y el buscador está VACÍO en ese momento
                const searchInput = document.getElementById('searchInput');
                if (influencer.name === 'DalasReview' && searchInput && searchInput.value.trim() === '') {
                    updateAchievement('pambisito', 1);
                }
                // -------------------------------------------

                saveRevealedCardsToLocalStorage();
                saveTierlistDataToLocalStorage();
                // --- LOGRO: ARQUEÓLOGO ---
                // Verificar si la carta revelada es una "Vieja Reliquia"
                const isRelic = influencer.categories && influencer.categories.includes('Viejas Reliquias');

                if (isRelic) {
                    // Contar cuántas reliquias hay en total en los datos
                    const totalRelics = mainInfluencersData.filter(inf => 
                        inf.categories && inf.categories.includes('Viejas Reliquias')
                    ).length;

                    // Contar cuántas reliquias hemos revelado hasta ahora
                    const revealedRelicsCount = mainInfluencersData.filter(inf => 
                        inf.categories && inf.categories.includes('Viejas Reliquias') && revealedCards.has(inf.id)
                    ).length;

                    // Verificar condición: 
                    // 1. Hemos revelado todas las reliquias.
                    // 2. El número total de cartas reveladas es IGUAL al número de reliquias reveladas 
                    //    (significa que no hemos revelado nada más que reliquias).
                    if (revealedRelicsCount === totalRelics && revealedCards.size === revealedRelicsCount) {
                        updateAchievement('archaeologist', 1);
                    }
                }
                card.classList.add('revealed');
    
                saveRevealedCardsToLocalStorage();
                saveTierlistDataToLocalStorage();

                // --- CORRECCIÓN: LLAMAR AQUÍ DENTRO ---
                checkAllAchievements(); 

                openModal(influencer);
            }, 400);
        }

        // Función para añadir al tierlist
        function addToTierlist(influencer) {
    if (!influencer.tier) return;
    
    const tierContainer = document.getElementById(`tier-${influencer.tier}`);
    if (!tierContainer) return;
    
    // Verificar si ya existe en el tier
    const existingItem = tierContainer.querySelector(`[data-influencer-id="${influencer.id}"]`);
    if (existingItem) {
        existingItem.remove(); // Eliminar el existente para evitar duplicados
    }
    
    // Crear elemento del tierlist
    const tierItem = createTierItem(influencer);
    
    // Añadir al tierlist
    tierContainer.appendChild(tierItem);
    
    // Añadir a los datos (evitando duplicados)
    if (!tierlistData[influencer.tier]) {
        tierlistData[influencer.tier] = [];
    }
    
    // Eliminar si ya existe
    tierlistData[influencer.tier] = tierlistData[influencer.tier].filter(item => item.id !== influencer.id);
    
    // Añadir el nuevo
    tierlistData[influencer.tier].push(influencer);
    
    // Mostrar notificación
    const oldTier = tierlistData[influencer.tier].find(item => item.id === influencer.id)?.tier;
    if (oldTier && oldTier !== influencer.tier) {
        showNotification(`${influencer.name} movido de tier ${getTierName(oldTier)} a tier ${getTierName(influencer.tier)}`);
    } else if (!oldTier) {
        showNotification(`${influencer.name} añadido a tier ${getTierName(influencer.tier)}`);
    }
}


    // Función para crear un elemento del tierlist
        function createTierItem(influencer) {
        const tierItem = document.createElement('div');
        tierItem.className = 'tier-item';
        tierItem.dataset.influencerId = influencer.id;
        tierItem.draggable = true;
        
        const thumbnail = document.createElement('img');
        thumbnail.className = 'tier-item-thumbnail';
        thumbnail.src = `https://img.youtube.com/vi/${influencer.videoId}/mqdefault.jpg`;
        thumbnail.alt = influencer.name;
        
        const name = document.createElement('div');
        name.className = 'tier-item-name';
        name.textContent = influencer.name;
        
        const removeBtn = document.createElement('div');
        removeBtn.className = 'tier-item-remove';
        removeBtn.textContent = '×';
        removeBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // ¡Importante! Evita que se abra el modal al borrar
            removeFromTierlist(influencer.id);
        });
        
        tierItem.appendChild(thumbnail);
        tierItem.appendChild(name);
        tierItem.appendChild(removeBtn);
        
        // --- NUEVO: Añadir listener para abrir el video al hacer clic ---
        tierItem.addEventListener('click', function(e) {
            // Si el clic fue en el botón de eliminar, no hacer nada más
            if (e.target === removeBtn) {
                return;
            }
            // Abrir el modal del video con los datos del influencer
            openModal(influencer);
        });
        // --- FIN DEL NUEVO CÓDIGO ---
        
        // Event listeners para drag and drop (ya existían)
        tierItem.addEventListener('dragstart', handleDragStart);
        tierItem.addEventListener('dragend', handleDragEnd);
        
        return tierItem;
    }
    

        // Función para eliminar del tierlist
        function removeFromTierlist(influencerId) {
    const influencer = findInfluencerById(influencerId);
    if (!influencer) return;
    
    // Encontrar el tier actual del influencer (por si el estado es inconsistente)
    let currentTier = influencer.tier;
    if (!currentTier) {
        // Buscar en qué lista de datos está el influencer
        const allTiers = ['s', 'a', 'b', 'c', 'd', 'f', 'unclassified'];
        for (const tier of allTiers) {
            if (tierlistData[tier] && tierlistData[tier].some(item => item.id === influencerId)) {
                currentTier = tier;
                break;
            }
        }
    }
    
    // Si lo encontramos en algún tier, proceder a eliminarlo
    if (currentTier) {
        // Eliminar del DOM
        const tierContainer = document.getElementById(`tier-${currentTier}`);
        if (tierContainer) {
            const tierItem = tierContainer.querySelector(`[data-influencer-id="${influencerId}"]`);
            if (tierItem) {
                tierItem.remove();
            }
        }
        
        // Eliminar de los datos
        if (tierlistData[currentTier]) {
            tierlistData[currentTier] = tierlistData[currentTier].filter(item => item.id !== influencerId);
        }
        
        // Resetear el tier del influencer
        influencer.tier = null;
        
        // Añadir a "Sin Clasificar" solo si no está ya allí (para evitar duplicados)
        if (!tierlistData.unclassified.some(item => item.id === influencer.id)) {
            tierlistData.unclassified.push(influencer);
        }
        
        // Re-renderizar "Sin Clasificar" para asegurar que la UI esté sincronizada
        renderUnclassifiedTier();
        
        // GUARDAR: Guardar la tierlist después de eliminar
        saveTierlistDataToLocalStorage();

        // Actualizar estadísticas
        updateTierlistStats();
        
        // Mostrar notificación
        showNotification(`${influencer.name} movido a Sin Clasificar`);
    }
}


        // Función para encontrar un influencer por ID
        function findInfluencerById(id) {
            return [...mainInfluencersData, ...fansInfluencersData].find(inf => inf.id === id);
        }

        // Funciones de drag and drop
        function handleDragStart(e) {
            draggedElement = this;
            draggedInfluencer = findInfluencerById(this.dataset.influencerId);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // Eliminar clases drag-over de todos los tiers
            document.querySelectorAll('.tier-row').forEach(row => {
                row.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            
            const tierRow = this.closest('.tier-row');
            if (tierRow) {
                tierRow.classList.add('drag-over');
            }
            
            return false;
        }

        function handleDragLeave(e) {
            const tierRow = this.closest('.tier-row');
            if (tierRow) {
                tierRow.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            e.preventDefault();
            
            const newTier = this.closest('.tier-row').dataset.tier;
            
                if (draggedInfluencer && draggedElement && newTier !== draggedInfluencer.tier) {
                    const oldTierRow = draggedElement.closest('.tier-row');
                    const oldTier = oldTierRow ? oldTierRow.dataset.tier : null;

                    // --- LOGRO: EL ASCENSO ---
                    if (oldTier === 'f' && newTier === 's') {
                        updateAchievement('the_climb', 1);
                 }

                this.appendChild(draggedElement);
                
                draggedInfluencer.tier = newTier;
                
                if (oldTier && tierlistData[oldTier]) {
                    tierlistData[oldTier] = tierlistData[oldTier].filter(item => item.id !== draggedInfluencer.id);
                }

                if (!tierlistData[newTier]) {
                    tierlistData[newTier] = [];
                }
                
                tierlistData[newTier] = tierlistData[newTier].filter(item => item.id !== draggedInfluencer.id);
                tierlistData[newTier].push(draggedInfluencer);

                updateTierlistStats();
                saveTierlistDataToLocalStorage();
                
                // --- CAMBIO AQUÍ: Lógica para el mensaje ---
                let mensaje = '';
                if (newTier === 'unclassified') {
                    mensaje = `${draggedInfluencer.name} movido a Sin Clasificar`;
                } else {
                    mensaje = `${draggedInfluencer.name} movido a tier ${getTierName(newTier)}`;
                }
                showNotification(mensaje);
                // -------------------------------------------
            }
            
            document.querySelectorAll('.tier-row').forEach(row => {
                row.classList.remove('drag-over');
            });
            
            return false;
        }

                // Función para actualizar la gráfica circular
        function updateTierlistChart() {
            const ctx = document.getElementById('tierlistPieChart');
            if (!ctx) return;

            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            const labels = [];
            const data = [];
            const colors = [];

            tiers.forEach(tier => {
                labels.push(getTierName(tier));
                data.push(tierlistData[tier] ? tierlistData[tier].length : 0);
                colors.push(customTierColors[tier]);
            });

            labels.push('Sin Clasificar');
            data.push(tierlistData.unclassified ? tierlistData.unclassified.length : 0);
            colors.push('#6b7280');

            if (tierlistChart) {
                tierlistChart.destroy();
            }

            tierlistChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: '#1a1a2e',
                        borderWidth: 3,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // DESACTIVAMOS LA LEYENDA POR DEFECTO
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    let value = context.raw;
                                    let total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    let percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // --- GENERAR LEYENDA PERSONALIZADA EN GRID ---
            const legendContainer = document.getElementById('customChartLegend');
            if (!legendContainer) return;
            legendContainer.innerHTML = ''; // Limpiar

            tierlistChart.data.labels.forEach((label, index) => {
                const backgroundColor = tierlistChart.data.datasets[0].backgroundColor[index];
                const value = tierlistChart.data.datasets[0].data[index];

                const item = document.createElement('div');
                item.className = 'legend-item';
                item.onclick = () => {
                    // Lógica para ocultar/mostrar segmento
                    const meta = tierlistChart.getDatasetMeta(0);
                    meta.data[index].hidden = !meta.data[index].hidden;
                    tierlistChart.update();
                    item.classList.toggle('strikethrough');
                };

                // HTML del item del grid
                item.innerHTML = `
                    <span class="legend-color-box" style="background-color: ${backgroundColor}"></span>
                    <div class="legend-text-container">
                        <span class="legend-label">${label}</span>
                        <span class="legend-value">${value} canciones</span>
                    </div>
                `;
                legendContainer.appendChild(item);
            });
        }

        // Función para actualizar nombres de tiers en la UI
        function updateTierNames() {
            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            
            // Actualizar etiquetas en el modal de video
            tiers.forEach(tier => {
                const option = document.querySelector(`.tier-option[data-tier="${tier}"]`);
                if (option) {
                    option.textContent = getTierName(tier);
                }
            });
            
            // Actualizar etiquetas en la tierlist
            tiers.forEach(tier => {
                const label = document.querySelector(`.tier-row[data-tier="${tier}"] .tier-label`);
                if (label) {
                    label.textContent = getTierName(tier);
                }
            });
        }
        

        // NUEVA FUNCIÓN: Renderizar la categoría "Sin Clasificar"
        function renderUnclassifiedTier() {
            const unclassifiedContainer = document.getElementById('tier-unclassified');
            if (!unclassifiedContainer) return;

            unclassifiedContainer.innerHTML = '';
            tierlistData.unclassified.forEach(influencer => {
                const tierItem = createTierItem(influencer);
                unclassifiedContainer.appendChild(tierItem);
            });
        }

        // Función para abrir el modal
function openModal(influencer) {
    if (isModalOpen) return;
    
    currentInfluencer = influencer;
    isModalOpen = true;
    
    modalOpenTimestamp = Date.now(); // Guardar hora de apertura
    const modalTitle = document.getElementById('modalTitle');
    const modalVideo = document.getElementById('modalVideo');
    const tierSelectionStatus = document.getElementById('tierSelectionStatus');
    const tierOptions = document.querySelectorAll('.tier-option');
    
// --- MODIFICACIÓN: Añadir feat al título del modal ---
let titleText = influencer.name;
if (influencer.featuring && influencer.featuring.length > 0) {
    titleText += ' ft. ' + influencer.featuring.join(', ');
}
modalTitle.textContent = titleText;
// --------------------------------------------------- //
    modalVideo.src = `https://www.youtube.com/embed/${influencer.videoId}?rel=0&showinfo=0&modestbranding=1&autoplay=1`;
    
    // --- PASO 1: Resetear SIEMPRE la UI a su estado por defecto ---
    tierOptions.forEach(option => {
        option.classList.remove('selected', 'disabled');
        // Actualizar texto con nombres personalizados por si acaso
        const tier = option.dataset.tier;
        option.textContent = getTierName(tier);
    });
    
    // Resetear el mensaje de estado a su valor inicial
    tierSelectionStatus.textContent = 'Haz clic en un tier para clasificar esta canción';
    tierSelectionStatus.classList.remove('success');
    
    // --- PASO 2: Aplicar el estado del influencer actual (si lo tiene) ---
    if (influencer.tier) {
        const existingTierOption = document.querySelector(`.tier-option[data-tier="${influencer.tier}"]`);
        if (existingTierOption) {
            existingTierOption.classList.add('selected');
            tierSelectionStatus.textContent = `Esta canción está en tier ${getTierName(influencer.tier)}. Haz clic en otro tier para cambiarla.`;
            tierSelectionStatus.classList.add('success');
        }
    }
    
    // Lógica para mostrar el modal sobre la tierlist (si es necesario)
    const videoModal = document.getElementById('videoModal');
    if (isTierlistModalOpen) {
        videoModal.classList.add('on-top-of-tierlist');
    } else {
        videoModal.classList.remove('on-top-of-tierlist');
    }

                // --- NUEVO: LÓGICA PARA MOSTRAR BOTÓN DE ELIMINAR ---
            const deleteBtn = document.getElementById('deleteInfluencerBtn');
            
            // Mostrar solo si es una carta personalizada (ID >= 143) y no es de fans
            if (parseInt(influencer.id) >= 143 && parseInt(influencer.id) < 1000) {
                deleteBtn.style.display = 'block';
                // Asignamos el evento de click
                deleteBtn.onclick = function() { deleteInfluencer(influencer.id); };
            } else {
                deleteBtn.style.display = 'none';
            }
            // ----------------------------------------------------
    
    // Mostrar modal con animación
    videoModal.style.display = 'flex';
    setTimeout(() => {
        videoModal.classList.add('active');
    }, 10);
}

        // Función para cerrar el modal
function closeModalFunc() {
    // --- LOGRO: INTRO HATER ---
if (modalOpenTimestamp) {
    const elapsed = Date.now() - modalOpenTimestamp;
    if (elapsed < 5000) { // Menos de 5 segundos
        updateAchievement('intro_hater', 1);
    }
    modalOpenTimestamp = null; // Resetear
}
    // Limpiar el video inmediatamente para detener la reproducción
    const modalVideo = document.getElementById('modalVideo');
    modalVideo.src = '';
    
    const videoModal = document.getElementById('videoModal');
    videoModal.classList.remove('active');
    videoModal.classList.remove('on-top-of-tierlist'); // <-- IMPORTANTE: Quitar la clase al cerrar
    isModalOpen = false;
    currentInfluencer = null;
    
    setTimeout(() => {
        videoModal.style.display = 'none';
    }, 300);
}

        // Función para eliminar un influencer personalizado
        function deleteInfluencer(id) {
            const influencer = findInfluencerById(id);
            if (!influencer) return;

            // Confirmación
            const confirmDelete = confirm(`¿Seguro que quieres eliminar a "${influencer.name}"?\n\nEsta acción no se puede deshacer.`);
            if (!confirmDelete) return;

            // 1. Eliminar de la lista de datos principal
            const indexData = mainInfluencersData.findIndex(i => i.id === id);
            if (indexData > -1) {
                mainInfluencersData.splice(indexData, 1);
            }

            // 2. Eliminar de la lista de visualización actual
            const indexView = mainInfluencers.findIndex(i => i.id === id);
            if (indexView > -1) {
                mainInfluencers.splice(indexView, 1);
            }

            // 3. Eliminar de las cartas reveladas
            revealedCards.delete(id);

            // 4. Eliminar de la tierlist si está clasificado
            Object.keys(tierlistData).forEach(tierKey => {
                tierlistData[tierKey] = tierlistData[tierKey].filter(item => item.id !== id);
            });

            // 5. Guardar cambios en LocalStorage
            saveInfluencersDataToLocalStorage();
            saveRevealedCardsToLocalStorage();
            saveTierlistDataToLocalStorage();

            // 6. Actualizar UI
            closeModalFunc();
            renderCards();
            // Si el modal de tierlist está abierto, actualizarlo también
            if (isTierlistModalOpen) {
                renderAllTiers();
                updateTierlistStats();
            }
            
            showNotification('🗑️ Influencer eliminado correctamente');
        }

        // Función para manejar la selección de tier
        function handleTierSelection(tier) {
            if (!currentInfluencer) return;
            
            const oldTier = currentInfluencer.tier;
            
            if (oldTier === tier) {
                // ... lógica de mismo tier ...
                return;
            }
    
    // Si ya tenía un tier, eliminarlo del tier anterior
    if (oldTier) {
        // Eliminar del tier anterior en la UI
        const oldTierContainer = document.getElementById(`tier-${oldTier}`);
        if (oldTierContainer) {
            const tierItem = oldTierContainer.querySelector(`[data-influencer-id="${currentInfluencer.id}"]`);
            if (tierItem) {
                tierItem.remove();
            }
        }
        
        // Eliminar de los datos
        if (tierlistData[oldTier]) {
            tierlistData[oldTier] = tierlistData[oldTier].filter(item => item.id !== currentInfluencer.id);
        }
    } else {
        // Si no tenía tier, eliminar de sin clasificar
        tierlistData.unclassified = tierlistData.unclassified.filter(item => item.id !== currentInfluencer.id);
        renderUnclassifiedTier();
    }

    
    
    // Asignar el nuevo tier
    currentInfluencer.tier = tier;

    // --- LOGRO: EL ASCENSO (Botones) ---
    if (oldTier === 'f' && tier === 's') {
        updateAchievement('the_climb', 1);
    }

    // Añadir al nuevo tier
    addToTierlist(currentInfluencer);
    
    // Actualizar UI del modal
    const tierSelectionStatus = document.getElementById('tierSelectionStatus');
    if (oldTier) {
        tierSelectionStatus.textContent = `Cambiado de tier ${getTierName(oldTier)} a tier ${getTierName(tier)}!`;
    } else {
        tierSelectionStatus.textContent = `¡Clasificado en tier ${getTierName(tier)}!`;
    }
    tierSelectionStatus.classList.add('success');
    
            // Actualizar clases y ARIA
            const tierOptions = document.querySelectorAll('.tier-option');
            tierOptions.forEach(option => {
                option.classList.remove('selected');
                option.setAttribute('aria-pressed', 'false');
                if (option.dataset.tier === tier) {
                    option.classList.add('selected');
                    option.setAttribute('aria-pressed', 'true');
                }
            });

    

        // GUARDAR: Guardar la tierlist después de cada cambio
    saveTierlistDataToLocalStorage();
    
    // Actualizar estadísticas
    updateTierlistStats();
    checkAllAchievements();
}


        // Función para abrir el modal de añadir influencer
        function openAddModal() {
            const addModal = document.getElementById('addModal');
            addModal.style.display = 'flex';
            setTimeout(() => {
                addModal.classList.add('active');
            }, 10);
        }

        // Función para cerrar el modal de añadir influencer
        function closeAddModal() {
            const addModal = document.getElementById('addModal');
            addModal.classList.remove('active');
            
            setTimeout(() => {
                addModal.style.display = 'none';
                // Limpiar formulario
                const addInfluencerForm = document.getElementById('addInfluencerForm');
                if (addInfluencerForm) addInfluencerForm.reset();
                
                // Ocultar mensajes de error y éxito
                const nameError = document.getElementById('nameError');
                const urlError = document.getElementById('urlError');
                const successMessage = document.getElementById('successMessage');
                
                if (nameError) nameError.style.display = 'none';
                if (urlError) urlError.style.display = 'none';
                if (successMessage) successMessage.style.display = 'none';
            }, 300);
        }

                // Función para actualizar estadísticas del tierlist
        function updateTierlistStats() {
            const totalRevealed = revealedCards.size;
            const totalSongs = mainInfluencersData.length + fansInfluencersData.length;
            
            let classifiedCount = 0;
            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            tiers.forEach(tier => {
                if (tierlistData[tier]) {
                    classifiedCount += tierlistData[tier].length;
                }
            });

            const totalRevealedEl = document.getElementById('totalRevealed');
            const totalClassifiedEl = document.getElementById('totalClassified');
            const totalSongsEl = document.getElementById('totalSongs');
            
            if (totalRevealedEl) totalRevealedEl.textContent = totalRevealed;
            if (totalClassifiedEl) totalClassifiedEl.textContent = classifiedCount;
            if (totalSongsEl) totalSongsEl.textContent = totalSongs;

            // IMPORTANTE: Actualizar gráfica también aquí
            updateTierlistChart(); 
            
            updateCategoryGaps(); 
        }

                // --- FUNCIÓN: CALCULAR HUECOS POR CATEGORÍA ---
        function updateCategoryGaps() {
            const container = document.getElementById('categoryGapsContainer');
            if (!container) return;

            // 1. Obtener todas las categorías y contar totales
            const categoryMap = {};
            mainInfluencersData.forEach(inf => {
                if (inf.categories) {
                    inf.categories.forEach(cat => {
                        if (!categoryMap[cat]) {
                            categoryMap[cat] = { total: 0, classified: 0 };
                        }
                        categoryMap[cat].total++;
                    });
                }
            });

            // 2. Contar clasificados (Tiers S-F, excluyendo 'unclassified')
            const classifiedTiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            
            classifiedTiers.forEach(tier => {
                if (tierlistData[tier]) {
                    tierlistData[tier].forEach(inf => {
                        if (inf.categories) {
                            inf.categories.forEach(cat => {
                                if (categoryMap[cat]) {
                                    categoryMap[cat].classified++;
                            }
                        });
                        }  
                });
                }
            });

            // 3. Generar HTML
            container.innerHTML = '';
            
            // Ordenar: primero las no completadas (más huecos arriba)
            const sortedCategories = Object.keys(categoryMap).sort((a, b) => {
                const progA = categoryMap[a].classified / categoryMap[a].total;
                const progB = categoryMap[b].classified / categoryMap[b].total;
                return progA - progB; // Ascendente (los más incompletos primero)
            });

            sortedCategories.forEach(catName => {
                const data = categoryMap[catName];
                const missing = data.total - data.classified;
                const percent = Math.round((data.classified / data.total) * 100);
                
                const item = document.createElement('div');
                item.className = `gap-item ${missing === 0 ? 'completed' : 'missing'}`;
                
                let statusHTML = '';
                if (missing === 0) {
                    statusHTML = `<span class="gap-status complete">✅ ¡Completo!</span>`;
                } else {
                    statusHTML = `<span class="gap-status alert">Faltan ${missing}</span>`;
                }

                item.innerHTML = `
                    <div class="gap-header">
                        <span class="gap-name">${catName}</span>
                        ${statusHTML}
                    </div>
                    <div class="gap-progress-track">
                        <div class="gap-progress-fill" style="width: ${percent}%"></div>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

                // --- FUNCIONES MODAL DE MODOS ---
        function openModesModal() {
            const modal = document.getElementById('modesModal');
            updateSelectedModeUI(); // Resaltar el modo actual
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
        }

        function closeModesModal() {
            const modal = document.getElementById('modesModal');
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        // Función visual para marcar cuál está activo
        function updateSelectedModeUI() {
            const gridCard = document.getElementById('modalModeGrid');
            const carouselCard = document.getElementById('modalModeCarousel');
            
            if(gridCard) gridCard.classList.toggle('selected', viewMode === 'grid');
            if(carouselCard) carouselCard.classList.toggle('selected', viewMode === 'carousel');
        }

        // Función para abrir el modal de tierlist
        function openTierlistModal() {
            // Actualizar estadísticas
            updateTierlistStats();
            
            // Actualizar nombres de tiers
            updateTierNames();
            
            // Renderizar todas las categorías
            renderAllTiers();

            // Configurar drag and drop para los tiers
            setupTierlistDragAndDrop();
            
                isTierlistModalOpen = true; // <-- AÑADE ESTA LÍNEA

            // Mostrar modal con animación
            const tierlistModal = document.getElementById('tierlistModal');
            tierlistModal.style.display = 'flex';
            setTimeout(() => {
                tierlistModal.classList.add('active');
            }, 10);

            // AÑADIR ESTO: Actualizar gráfica al abrir
            updateTierlistChart(); 
        }

        // NUEVA FUNCIÓN: Renderizar todos los tiers a la vez
        function renderAllTiers() {
            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            
            // Renderizar la lista de sin clasificar primero
            renderUnclassifiedTier();

            // Renderizar el resto de los tiers
            tiers.forEach(tier => {
                const tierContainer = document.getElementById(`tier-${tier}`);
                if (!tierContainer) return;
                tierContainer.innerHTML = '';

                if (tierlistData[tier]) {
                    tierlistData[tier].forEach(influencer => {
                        const tierItem = createTierItem(influencer);
                        tierContainer.appendChild(tierItem);
                    });
                }
            });
        }

                // Función para abrir el modal de edición de tiers
        function openEditTiersModal() {
            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            tiers.forEach(tier => {
                // Cargar Nombre
                const nameInput = document.getElementById(`tier-name-${tier}`);
                if (nameInput) nameInput.value = customTierNames[tier];
                
                // Cargar Color
                const colorInput = document.getElementById(`tier-color-${tier}`);
                if (colorInput) colorInput.value = customTierColors[tier];
            });
            
            const editTiersModal = document.getElementById('editTiersModal');
            editTiersModal.style.display = 'flex';
            setTimeout(() => {
                editTiersModal.classList.add('active');
            }, 10);
        }

        // Función para cerrar el modal de edición de tiers
        function closeEditTiersModal() {
            const editTiersModal = document.getElementById('editTiersModal');
            editTiersModal.classList.remove('active');
            
            setTimeout(() => {
                editTiersModal.style.display = 'none';
            }, 300);
        }

                function saveTierNames() {
            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            let hasChanges = false;
            
            tiers.forEach(tier => {
                // Guardar Nombre
                const nameInput = document.getElementById(`tier-name-${tier}`);
                if (nameInput) {
                    const newName = nameInput.value.trim();
                    if (newName && newName !== customTierNames[tier]) {
                        customTierNames[tier] = newName;
                        hasChanges = true;
                    }
                }
                
                // Guardar Color
                const colorInput = document.getElementById(`tier-color-${tier}`);
                if (colorInput) {
                    const newColor = colorInput.value;
                    if (newColor && newColor !== customTierColors[tier]) {
                        customTierColors[tier] = newColor;
                        hasChanges = true;
                    }
                }
            });
            
            if (hasChanges) {
                saveCustomTierNames();
                saveCustomTierColors();
                updateTierNames(); // Actualiza etiquetas de las filas
                applyTierColors(); // Actualiza colores CSS de las filas
                updateTierlistChart(); // <--- AÑADE ESTA LÍNEA (Actualiza la gráfica)
                showNotification('Tiers actualizados correctamente');
                updateAchievement('customizer', 1);
            }
            
            closeEditTiersModal();
        }

                // Función para restablecer nombres y colores
        function resetTierNames() {
            // Resetear Nombres
            customTierNames = {
                s: 'S', a: 'A', b: 'B', c: 'C', d: 'D', f: 'F'
            };
            
            // Resetear Colores
            customTierColors = {
                s: '#ff7f7f',
                a: '#ffbf7f',
                b: '#ffff7f',
                c: '#7fff7f',
                d: '#7fffff',
                f: '#7f7fff'
            };
            
            saveCustomTierNames();
            saveCustomTierColors(); // Guardar reseteo de colores
            
            updateTierNames();
            applyTierColors(); // Aplicar colores por defecto
            
            // Actualizar inputs en el modal
            const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
            tiers.forEach(tier => {
                const nameInput = document.getElementById(`tier-name-${tier}`);
                if (nameInput) nameInput.value = customTierNames[tier];
                
                const colorInput = document.getElementById(`tier-color-${tier}`);
                if (colorInput) colorInput.value = customTierColors[tier];
            });
            
            showNotification('Tiers restablecidos');
        }

        // Función para cerrar el modal de tierlist
        function closeTierlistModal() {
            const tierlistModal = document.getElementById('tierlistModal');
            tierlistModal.classList.remove('active');
            isTierlistModalOpen = false; // <-- AÑADE ESTA LÍNEA

            
            setTimeout(() => {
                tierlistModal.style.display = 'none';
            },300);
        }

        // Función para añadir un nuevo influencer
        function addInfluencer(name, url) {
    const videoId = getYouTubeId(url);
    
    const newInfluencer = {
        id: nextId.toString(),
        name: name,
        youtubeUrl: url,
        videoId: videoId,
        tier: null,
        categories: []
    };
    
    mainInfluencers.push(newInfluencer);
    mainInfluencersData.push(newInfluencer);
    nextId++;
    
    // Guardar ambos: la lista de influencers Y el siguiente ID
    saveInfluencersDataToLocalStorage();
    saveNextIdToLocalStorage(); // <-- AÑADE ESTA LÍNEA
    
    // Mostrar mensaje de éxito
    const successMessage = document.getElementById('successMessage');
    if (successMessage) successMessage.style.display = 'block';
    
    renderCards();
    
    setTimeout(() => {
        closeAddModal();
    }, 750);
}

        // Reemplaza la función existente con esta versión actualizada
        function renderCards() {
            const cardsGrid = document.getElementById('cardsGrid');
            if (!cardsGrid) return;
            
            cardsGrid.innerHTML = '';
            
            // USAMOS LA FUNCIÓN COMÚN
            let influencersToRender = getVisibleInfluencers();

        // Aplicar filtro de categorías si hay categorías seleccionadas
        if (selectedCategories.size > 0 && selectedCategories.size < Object.keys(categoriesData).length) {
            influencersToRender = influencersToRender.filter(influencer => {
                if (!influencer.categories) return false;
                
                if (categoryFilterMode === 'and') {
                    // Lógica Y: Debe tener TODAS las seleccionadas
                    return [...selectedCategories].every(cat => influencer.categories.includes(cat));
                } else {
                    // Lógica O: Debe tener ALGUNA de las seleccionadas
                    return influencer.categories.some(cat => selectedCategories.has(cat));
                }
            });
        }
    
        // Aplicar filtro de búsqueda si hay texto
        const searchInput = document.getElementById('searchInput');
        if (searchInput && searchInput.value.trim() !== '') {
            const searchTerm = searchInput.value.toLowerCase();
            influencersToRender = influencersToRender.filter(influencer => {
                // Buscar en el nombre principal
                const nameMatch = influencer.name.toLowerCase().includes(searchTerm);
                
                // Buscar en featuring
                const featMatch = influencer.featuring && influencer.featuring.some(name => 
                    name.toLowerCase().includes(searchTerm)
                );
                
                return nameMatch || featMatch;
            });
        }

        if (influencersToRender.length === 0) {
            const noResults = document.getElementById('noResults');
            if (noResults) noResults.style.display = 'block';
            return;
        }
        
        const noResults = document.getElementById('noResults');
        if (noResults) noResults.style.display = 'none';
        
        influencersToRender.forEach(influencer => {
            const card = createCard(influencer);
            cardsGrid.appendChild(card);
            
            if (revealedCards.has(influencer.id)) {
                const cardElement = card.querySelector('.card');
                if (cardElement) {
                    cardElement.classList.add('flipped');
                    cardElement.classList.add('revealed');
                }
            }
        });
    }

            // --- FUNCIÓN AUXILIAR: ACTUALIZAR VISTA ACTUAL ---
        function refreshActiveView() {
            if (viewMode === 'carousel') {
                renderCarousel();
            } else {
                renderCards();
            }
        }

        // Función para renderizar las tarjetas de fans
        function renderFansCards() {
            const fansCardsGrid = document.getElementById('fansCardsGrid');
            if (!fansCardsGrid) return;
            
            fansCardsGrid.innerHTML = '';
            
            fansInfluencers.forEach(influencer => {
                const card = createCard(influencer);
                fansCardsGrid.appendChild(card);
                
                // Si la tarjeta ya fue revelada, marcarla
                if (revealedCards.has(influencer.id)) {
                    const cardElement = card.querySelector('.card');
                    if (cardElement) {
                        cardElement.classList.add('flipped');
                        cardElement.classList.add('revealed');
                    }
                }
            });
        }

        
// Función para reordenar las tarjetas
function shuffleCards() {
    // 1. Mezclamos los datos maestros (para que se guarde el nuevo orden)
    mainInfluencersData.sort(() => Math.random() - 0.5);
    
    // 2. Sincronizamos la copia de trabajo
    mainInfluencers = [...mainInfluencersData];
    
    // 3. GUARDAMOS el nuevo orden en LocalStorage
    saveInfluencersDataToLocalStorage();
    
    renderCards();
    
    if (fansToggleActive) {
        fansInfluencers = [...fansInfluencers].sort(() => Math.random() - 0.5);
        renderFansCards();
    }
    // Eliminado: contador de mezclas y logro 'shuffle_master'
}

        // Función para toggle de fans
        function toggleFans() {
            fansToggleActive = !fansToggleActive;
            
            const fansToggle = document.getElementById('fansToggle');
            const fansSection = document.getElementById('fansSection');
            
            if (fansToggle && fansSection) {
                if (fansToggleActive) {
                    fansToggle.classList.add('active');
                    fansSection.classList.add('active');
                    renderFansCards();
                } else {
                    fansToggle.classList.remove('active');
                    fansSection.classList.remove('active');
                }
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('URL copiada al portapapeles');
            }).catch(err => {
                console.error('Error al copiar al portapapeles:', err);
                showNotification('Error al copiar la URL');
            });
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            if (notification) {
                notification.textContent = message;
                notification.classList.add('show');
                
                // La notificación desaparecerá automáticamente después de 3 segundos
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000); 
            }
        }

        // --- FUNCIONES ACTUALIZADAS PARA EL NUEVO MODAL ---

        function showNotification(message) {
            const el = document.getElementById('notification');
            if (!el) return;
            el.textContent = message;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function showAchievementPopup(achievement) {
            const popup = document.getElementById('achievementPopup');
            const iconEl = document.getElementById('achievementPopupIcon');
            const nameEl = document.getElementById('achievementPopupName');
            
            if(iconEl) iconEl.textContent = achievement.icon;
            if(nameEl) nameEl.textContent = achievement.name;
            
            if(popup) {
                popup.classList.add('show');
                setTimeout(() => popup.classList.remove('show'), 4000);
            }
        }

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            if(!grid) return;
            grid.innerHTML = '';

            let hasHiddenLocked = false;

            achievements.forEach(achievement => {
                const isHiddenSecret = achievement.hidden && !achievement.unlocked;
                
                // Si es secreto y está bloqueado, NO lo renderizamos todavía
                if (isHiddenSecret) {
                    hasHiddenLocked = true;
                    return; // Saltamos al siguiente logro
                }

                // Renderizamos los logros visibles (bloqueados o desbloqueados) y los secretos ya desbloqueados
                const card = document.createElement('div');
                const progressPercent = achievement.maxProgress > 0 ? (achievement.progress / achievement.maxProgress) * 100 : 0;
                
                // Si está desbloqueado mostramos su icono, si no, un candado
                const displayIcon = achievement.unlocked ? achievement.icon : '🔒';
                
                card.className = `achievement-card ${achievement.unlocked ? 'unlocked' : ''}`;
                
                card.innerHTML = `
                    <div class="achievement-icon">${displayIcon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                        <div class="achievement-progress-bar">
                            <div class="achievement-progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="achievement-progress-text">${achievement.progress} / ${achievement.maxProgress}</div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Si encontramos al menos un logro secreto bloqueado, añadimos UNA sola tarjeta misteriosa
            if (hasHiddenLocked) {
                const hiddenCard = document.createElement('div');
                hiddenCard.className = 'achievement-card';
                hiddenCard.innerHTML = `
                    <div class="achievement-icon">❓</div>
                    <div class="achievement-info">
                        <div class="achievement-name">???</div>
                        <div class="achievement-description">Sigue jugando para descubrir logros ocultos</div>
                        <div class="achievement-progress-bar">
                            <div class="achievement-progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="achievement-progress-text">? / ?</div>
                    </div>
                `;
                grid.appendChild(hiddenCard);
            }

            updateAchievementsCount();
            checkPartyModeStatus();
        }

        function updateAchievementsCount() {
            const el = document.getElementById('achievementsCount');
            if(el) {
                const unlocked = achievements.filter(a => a.unlocked).length;
                
                // El total mostrado será: Logros visibles + Secretos desbloqueados
                // Así nunca sabemos cuántos secretos faltan por descubrir
                const visibleTotal = achievements.filter(a => !a.hidden).length;
                const unlockedSecrets = achievements.filter(a => a.hidden && a.unlocked).length;
                const displayTotal = visibleTotal + unlockedSecrets;
                
                el.textContent = `${unlocked} / ${displayTotal}`;
            }
        }

                // --- FUNCIONES PARA EL MODAL DE REVELAR ---

        function openRevealConfirmModal() {
            const modal = document.getElementById('revealConfirmModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
        }

                        const closeConfirmModal = (modalId) => {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        };
                async function executeRevealAll() {
            // 1. Cerrar modal
            closeConfirmModal('revealConfirmModal');
            
            // 2. Actualizar datos
            mainInfluencersData.forEach(inf => {
                revealedCards.add(inf.id);
                if (!inf.tier && !tierlistData.unclassified.find(i => i.id === inf.id)) tierlistData.unclassified.push(inf);
            });
            fansInfluencersData.forEach(inf => {
                revealedCards.add(inf.id);
                if (!inf.tier && !tierlistData.unclassified.find(i => i.id === inf.id)) tierlistData.unclassified.push(inf);
            });
            saveRevealedCardsToLocalStorage();
            saveTierlistDataToLocalStorage();

            // 3. Animación con velocidad variable
            const toReveal = document.querySelectorAll('.card:not(.flipped)');
            if (toReveal.length === 0) {
                showNotification('✅ ¡Todas las cartas ya estaban reveladas!');
                return;
            }

            for (let i = 0; i < toReveal.length; i++) {
                const card = toReveal[i];
                card.classList.add('pack-flip', 'flipped', 'revealed');
                card.classList.add('pack-flash');
                createCardExplosion(card);
                
                // --- LÓGICA DE VELOCIDAD AJUSTADA ---
                let delay;
                if (i < 12) {
                    // Primeras 12 cartas: Velocidad normal (60ms) para apreciar el efecto
                    delay = 60; 
                } else {
                    // Desde la 13 en adelante: Instantáneo (0ms)
                    delay = 0; 
                }
                
                await new Promise(r => setTimeout(r, delay));
            }

            updateAchievement('collector_50', revealedCards.size);
            checkAllAchievements();
            launchBigConfetti();
            showNotification('🎉 ¡Pack Opening Completado!');
        }

        // --- FUNCIONES PARA EL MODAL DE REINICIO ---
        
        function openResetConfirmModal() {
            const modal = document.getElementById('resetConfirmModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
        }

                function executeReset() {
            // 1. Recuperar orden
            const savedData = localStorage.getItem('cancinfluencers_mainInfluencersData');
            let orderedList = [];
            if (savedData) {
                try {
                    const fullList = JSON.parse(savedData);
                    orderedList = fullList.filter(inf => parseInt(inf.id) <= 142);
                } catch (e) { console.error(e); }
            }

            // 2. Borrar datos
            localStorage.removeItem('cancinfluencers_revealedCards');
            localStorage.removeItem('cancinfluencers_tierlistData');
            localStorage.removeItem('cancinfluencers_nextId');
            localStorage.removeItem('cancinfluencers_easterEggActivated');
            localStorage.removeItem('customTierNames');
            localStorage.removeItem('customTierColors');
            localStorage.removeItem('cancinfluencers_achievements');
            localStorage.removeItem('cancinfluencers_shuffleCount');
            localStorage.removeItem('cancinfluencers_mainInfluencersData');
            
            // --- NUEVO: BORRAR MODO FIESTA ---
            localStorage.removeItem('cancinfluencers_partyMode');
            isPartyModeActive = false;
            document.body.classList.remove('party-mode');
            
            // Eliminar el confeti persistente del DOM
            document.querySelectorAll('.party-confetti').forEach(el => el.remove());
            // --------------------------------
            
            // 3. Guardar lista limpia
            if (orderedList.length > 0) {
                localStorage.setItem('cancinfluencers_mainInfluencersData', JSON.stringify(orderedList));
                localStorage.setItem('cancinfluencers_firstVisit', 'true');
            } else {
                localStorage.clear();
                localStorage.setItem('cancinfluencers_firstVisit', 'true');
            }

            showNotification('✅ Progreso reiniciado.');
            setTimeout(() => location.reload(), 1500);
        }

        // Variables para el tierlist
        let tierlistData = {
            unclassified: [], // NUEVA CATEGORÍA
            s: [],
            a: [],
            b: [],
            c: [],
            d: [],
            f: []
        };

                // --- FUNCIONES DE LOGROS (VERSIÓN CORREGIDA) ---
        
                function updateAchievement(id, progress) {
            const achievement = achievements.find(a => a.id === id);
            if (!achievement) return;

            // Evitar errores si maxProgress es 0
            if (achievement.maxProgress === 0) return;

            const previousProgress = achievement.progress;
            
            // --- CORRECCIÓN: LÓGICA ANTIREGRESO ---
            // El progreso NUNCA debe bajar. Si tenías 5, no puedes volver a 1.
            // Además, una vez desbloqueado, siempre se queda desbloqueado.
            const newProgress = Math.min(progress, achievement.maxProgress);
            
            achievement.progress = Math.max(achievement.progress, newProgress);
            achievement.unlocked = achievement.unlocked || achievement.progress >= achievement.maxProgress;
            // -------------------------------------

            // Solo guardar y notificar si hubo cambio real
            if (achievement.progress !== previousProgress) {
                saveAchievements();
                
                // Si recien se desbloquea, mostrar popup
                // Como 'unlocked' ya es true para siempre, esto solo pasará 1 vez
                if (achievement.unlocked && previousProgress < achievement.maxProgress) {
                    showAchievementPopup(achievement);
                }
            }
            
            // Comprobar modo fiesta
            if (achievement.unlocked && !achievements.find(a => a.id === id).unlocked) {
                 checkPartyModeStatus();
            }
        }

        function showAchievementPopup(achievement) {
            const popup = document.getElementById('achievementPopup');
            const iconEl = document.getElementById('achievementPopupIcon');
            const nameEl = document.getElementById('achievementPopupName');
            
            if(iconEl) iconEl.textContent = achievement.icon;
            if(nameEl) nameEl.textContent = achievement.name;
            
            if(popup) {
                popup.classList.add('show');
                setTimeout(() => popup.classList.remove('show'), 4000);
            }
        }

                // Esta función calcula los conteos y actualiza los logros
        function checkAllAchievements() {
            const revealedCount = revealedCards.size;
            
            // Contamos clasificados (excluyendo 'unclassified')
            const classifiedCount = Object.keys(tierlistData).reduce((acc, key) => {
                if (key !== 'unclassified') return acc + tierlistData[key].length;
                return acc;
            }, 0);

            // Actualizamos progreso general
            updateAchievement('first_reveal', revealedCount >= 1 ? 1 : 0);
            updateAchievement('collector_50', revealedCount);
            updateAchievement('critic_10', classifiedCount);
            updateAchievement('critic_50', classifiedCount);
            updateAchievement('critic_100', classifiedCount);

            // --- LOGRO: TEAM MINECRAFT ---
            const minecraftInfluencers = mainInfluencersData.filter(inf => inf.categories && inf.categories.includes('Minecraft'));
            const allMinecraftClassified = minecraftInfluencers.length > 0 && minecraftInfluencers.every(inf => inf.tier && inf.tier !== 'unclassified');
            if (allMinecraftClassified) {
                updateAchievement('team_minecraft', 1);
            }

            // --- LOGROS DE COLECCIÓN (Ordenados para que no eclipsen al final) ---

            // 1. Antes y Después (DaniRep 2017 [52] y DaniRep Actual [53])
            if (revealedCards.has('52') && revealedCards.has('53')) {
                updateAchievement('before_after', 1);
            }

            // 2. Crisis de Identidad (Joaquinpa 'Jokki' [90] y Jokki 'Joaquinpa' [91])
            if (revealedCards.has('90') && revealedCards.has('91')) {
                updateAchievement('identity_crisis', 1);
            }

            // 3. ¡Hola, soy German! (German Garmendia [27])
            if (revealedCards.has('27')) {
                updateAchievement('hola_german', 1);
            }

            // 4. Niños Rata (Zarcort [141])
            if (revealedCards.has('141')) {
                updateAchievement('ninos_rata', 1);
            }

            // 5. Karmaland (Quackity [60], ElRubiusOMG [3], Willyrex [18], illojuan [9], Lolito Fdez [121])
            const karmalandIds = ['60', '3', '18', '9', '121'];
            if (karmalandIds.every(id => revealedCards.has(id))) {
                updateAchievement('karmaland', 1);
            }

            // 6. Cuando Quieras Jugamos a la Wii (Folagor03 [115])
            if (revealedCards.has('115')) {
                updateAchievement('wii', 1);
            }

            // 7. La Casa de los Gemelos 2
            const gemelosIds = ['70', '142', '132', '133', '134'];
            if (gemelosIds.every(id => revealedCards.has(id))) {
                updateAchievement('gemelos_2', 1);
            }

            // 8. Ruptura (Illojuan [9] y Masi [64])
            if (revealedCards.has('9') && revealedCards.has('64')) {
                updateAchievement('ruptura', 1);
            }

            // 9. Juicio (DalasReview [2] y Wismichu [40])
            if (revealedCards.has('2') && revealedCards.has('40')) {
                updateAchievement('juicio', 1);
            }

            // 10. Los Perros de Minecraft (Mikecrack [13] y Bobicraft [109])
            if (revealedCards.has('13') && revealedCards.has('109')) {
                updateAchievement('perros_minecraft', 1);
            }

            // --- LOGRO FINAL (EL MÁS IMPORTANTE) ---
            // Este se verifica al último para asegurar que su popup sea el que permanezca en pantalla
            updateAchievement('collector_all', revealedCount);
        }

        function updateAchievementsCount() {
            const el = document.getElementById('achievementsCount');
            if(el) {
                const unlocked = achievements.filter(a => a.unlocked).length;
                el.textContent = `${unlocked} / ${achievements.length}`;
            }
        }

        function saveAchievements() {
            localStorage.setItem('cancinfluencers_achievements', JSON.stringify(achievements));
        }

        function loadAchievements() {
            const saved = localStorage.getItem('cancinfluencers_achievements');
            if (saved) {
                try {
                    achievements = JSON.parse(saved);
                } catch (e) {
                    console.error("Error cargando logros", e);
                }
            }
            // Actualizar maxProgress dinámico para "Maestro Coleccionista"
            const collectorAll = achievements.find(a => a.id === 'collector_all');
            if (collectorAll) {
                collectorAll.maxProgress = mainInfluencersData.length + fansInfluencersData.length;
            }
        }

                // --- LÓGICA MODO FIESTA ---

        function activatePartyMode() {
            if (isPartyModeActive) return; // Si ya está activo, no hacer nada
            
            isPartyModeActive = true;
            localStorage.setItem('cancinfluencers_partyMode', 'true');
            
            // Añadir clase al body
            document.body.classList.add('party-mode');
            
            // Lanzar confeti inicial
            launchBigConfetti();
            showNotification('🎊 ¡MODO FIESTA ACTIVADO! 🎊');
            
            // Crear confeti CSS persistente
            createPersistentConfetti();
        }

                function createPersistentConfetti() {
            // Aumentado a 60 elementos para mayor densidad
            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'party-confetti';
                
                const colors = ['#ff0', '#f0f', '#0ff', '#f00', '#0f0', '#00f', '#ffd700'];
                const left = Math.random() * 100;
                const delay = Math.random() * 10;
                const duration = 5 + Math.random() * 10;
                
                confetti.style.left = `${left}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${delay}s`;
                confetti.style.animationDuration = `${duration}s`;
                
                document.body.appendChild(confetti);
            }
        }

        function checkPartyModeStatus() {
            // Verificar si todos los logros están desbloqueados
            const totalAchievements = achievements.length;
            const unlockedAchievements = achievements.filter(a => a.unlocked).length;
            
            if (unlockedAchievements === totalAchievements && totalAchievements > 0) {
                activatePartyMode();
            }
        }


        // Configurar event listeners - Versión simplificada y robusta
        function setupEventListeners() {
            console.log('Configurando event listeners...');


                    // --- AÑADIR LISTENERS DENTRO DE setupEventListeners ---   
            // --- LISTENERS (Añadir a setupEventListeners) ---
            // Modal Ciegas
            const closeBlindBtn = document.getElementById('closeBlindTestModal');
            if(closeBlindBtn) closeBlindBtn.addEventListener('click', closeBlindTestModal);

            const nextBlindBtn = document.getElementById('blindNextBtn');
            if(nextBlindBtn) nextBlindBtn.addEventListener('click', startBlindRound);
            
            // Skip button logic is inside the interval start now, but let's bind it:
            const skipBlindBtn = document.getElementById('blindSkipBtn');
            if(skipBlindBtn) skipBlindBtn.addEventListener('click', skipBlindRound);

            // Menu option
            const modeBlindTest = document.getElementById('modalModeBlindTest');
            if(modeBlindTest) {
                modeBlindTest.addEventListener('click', () => {
                    closeModesModal();
                    openBlindTestModal();
                });
            }

            // Close click outside
            const blindModal = document.getElementById('blindTestModal');
            if(blindModal) {
                blindModal.addEventListener('click', (e) => {
                    if(e.target === blindModal) closeBlindTestModal();
                });
            }

            // --- LISTENERS PARA CARRUSEL ---
            const viewModeBtn = document.getElementById('viewModeBtn');
            if(viewModeBtn) viewModeBtn.addEventListener('click', toggleViewMode);

            const carouselNext = document.getElementById('carouselNext');
            if(carouselNext) carouselNext.addEventListener('click', nextSlide);

            const carouselPrev = document.getElementById('carouselPrev');
            if(carouselPrev) carouselPrev.addEventListener('click', prevSlide);
            
                        // --- LISTENERS MODAL DE MODOS ---
            const modesBtn = document.getElementById('modesBtn');
            if (modesBtn) modesBtn.addEventListener('click', openModesModal);

            const closeModesModalBtn = document.getElementById('closeModesModal');
            if (closeModesModalBtn) closeModesModalBtn.addEventListener('click', closeModesModal);

            // Cerrar clic fuera
            const modesModal = document.getElementById('modesModal');
            if(modesModal) {
                modesModal.addEventListener('click', (e) => {
                    if (e.target === modesModal) closeModesModal();
                });
            }

            // Selección de modos dentro del modal
            document.getElementById('modalModeGrid')?.addEventListener('click', () => setViewMode('grid'));
            document.getElementById('modalModeCarousel')?.addEventListener('click', () => setViewMode('carousel'));
            
            // Soporte teclado (Enter/Espacio) para las tarjetas de modo
            document.getElementById('modalModeGrid')?.addEventListener('keydown', (e) => { if(e.key==='Enter') setViewMode('grid'); });
            document.getElementById('modalModeCarousel')?.addEventListener('keydown', (e) => { if(e.key==='Enter') setViewMode('carousel'); });

            // Swipe táctil para móvil
            const carouselTrack = document.getElementById('carouselTrack');
            if(carouselTrack) {
                carouselTrack.addEventListener('touchstart', (e) => {
                    touchStartX = e.changedTouches[0].screenX;
                }, {passive: true});

                carouselTrack.addEventListener('touchend', (e) => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe();
                }, {passive: true});
            }

            // --- "SALTAR A LAS CARTAS" -> ENFOCAR LA PRIMERA CARTA ---
            const skipLink = document.querySelector('.skip-link');
            if (skipLink) {
                // Función común para Click (Enter) y Espacio
                const handleSkipAction = (e) => {
                    e.preventDefault(); // Evita el salto estándar del navegador

                    // Buscar la primera carta en la cuadrícula
                    const firstCard = document.querySelector('#cardsGrid .card');
                    
                    if (firstCard) {
                        // Enfocar la primera carta directamente
                        firstCard.focus();
                        
                        // Asegurarse de que sea visible en pantalla
                        firstCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                        // Fallback: si no hay cartas, enfocar el contenedor
                        const mainContent = document.getElementById('main-content');
                        if (mainContent) mainContent.focus();
                    }
                };

                // Listener para Click (botón izquierdo o Enter en enlace)
                skipLink.addEventListener('click', handleSkipAction);
                

                // Listener para la barra espaciadora
                skipLink.addEventListener('keydown', function(e) {
                    if (e.key === ' ' || e.code === 'Space') {
                        handleSkipAction(e);
                    }
                });
            }
                        // --- NUEVO: Listener para exportar imagen ---
            const exportImageBtn = document.getElementById('exportImageBtn');
            if (exportImageBtn) {
                exportImageBtn.addEventListener('click', exportTierlistImage);
            }

            const calculateMatchBtn = document.getElementById('calculateMatchBtn');
            if (calculateMatchBtn) {
                calculateMatchBtn.addEventListener('click', calculateMatch);
            }

                        // --- LISTENERS PARA MODAL DE SUGERENCIAS ---
            const openSuggestionBtn = document.getElementById('openSuggestionBtn');
            const suggestionModal = document.getElementById('suggestionModal');
            const closeSuggestionModalBtn = document.getElementById('closeSuggestionModal');

            if (openSuggestionBtn) {
                openSuggestionBtn.addEventListener('click', () => {
                    suggestionModal.style.display = 'flex';
                    setTimeout(() => suggestionModal.classList.add('active'), 10);
                });
            }

            if (closeSuggestionModalBtn) {
                closeSuggestionModalBtn.addEventListener('click', () => {
                    suggestionModal.classList.remove('active');
                    setTimeout(() => suggestionModal.style.display = 'none', 300);
                });
            }
            
            // Cerrar clic fuera
            if (suggestionModal) {
                suggestionModal.addEventListener('click', (e) => {
                    if (e.target === suggestionModal) {
                        suggestionModal.classList.remove('active');
                        setTimeout(() => suggestionModal.style.display = 'none', 300);
                    }
                });
            }

                        // --- LISTENERS LOGROS ---
            const achievementsBtn = document.getElementById('achievementsBtn');
            if (achievementsBtn) {
                achievementsBtn.addEventListener('click', () => {
                    renderAchievements();
                    const modal = document.getElementById('achievementsModal');
                    modal.style.display = 'flex';
                    setTimeout(() => modal.classList.add('active'), 10);
                });
            }

            const achievementsModal = document.getElementById('achievementsModal');
            if (achievementsModal) {
                achievementsModal.addEventListener('click', function(e) {
                    // Si el clic fue en el fondo oscuro (el modal本身) y no en el contenido
                    if (e.target === achievementsModal) {
                        achievementsModal.classList.remove('active');
                        setTimeout(() => {
                            achievementsModal.style.display = 'none';
                        }, 300);
                    }
                });
            }

                        // --- ATAJO DE TECLADO: ESCAPE PARA CERRAR TODOS LOS MODALES ---
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    
                    // 1. Video Modal
                    const videoModal = document.getElementById('videoModal');
                    if (videoModal.classList.contains('active')) {
                        closeModalFunc();
                        return;
                    }

                    // 2. Add Modal
                    const addModal = document.getElementById('addModal');
                    if (addModal.classList.contains('active')) {
                        closeAddModal();
                        return;
                    }

                    // 3. Tierlist Modal
                    const tierlistModal = document.getElementById('tierlistModal');
                    if (tierlistModal.classList.contains('active')) {
                        closeTierlistModal();
                        return;
                    }

                    // 4. Edit Tiers Modal
                    const editTiersModal = document.getElementById('editTiersModal');
                    if (editTiersModal.classList.contains('active')) {
                        closeEditTiersModal();
                        return;
                    }

                    // 5. Categories Modal
                    const categoriesModal = document.getElementById('categoriesModal');
                    if (categoriesModal.classList.contains('active')) {
                        closeCategoriesModal();
                        return;
                    }

                    // 6. Share Code Modal
                    const shareCodeModal = document.getElementById('shareCodeModal');
                    if (shareCodeModal.classList.contains('active')) {
                        closeShareModal();
                        return;
                    }

                    // 7. Achievements Modal
                    const achievementsModal = document.getElementById('achievementsModal');
                    if (achievementsModal.classList.contains('active')) {
                        achievementsModal.classList.remove('active');
                        setTimeout(() => achievementsModal.style.display = 'none', 300);
                        return;
                    }

                    // 8. Suggestion Modal
                    const suggestionModal = document.getElementById('suggestionModal');
                    if (suggestionModal.classList.contains('active')) {
                        suggestionModal.classList.remove('active');
                        setTimeout(() => suggestionModal.style.display = 'none', 300);
                        return;
                    }

                    // 9. Modes Modal
                    const modesModal = document.getElementById('modesModal');
                    if (modesModal.classList.contains('active')) {
                        closeModesModal();
                        return;
                    }

                    // 10. Impostor Modal
                    const impostorModal = document.getElementById('impostorModal');
                    if (impostorModal.classList.contains('active')) {
                        closeImpostorModal();
                        return;
                    }

                    // 11. Reset Confirm Modal (NUEVO)
                    const resetConfirmModal = document.getElementById('resetConfirmModal');
                    if (resetConfirmModal.classList.contains('active')) {
                        closeConfirmModal('resetConfirmModal');
                        return;
                    }

                    // 12. Reveal Confirm Modal (NUEVO)
                    const revealConfirmModal = document.getElementById('revealConfirmModal');
                    if (revealConfirmModal.classList.contains('active')) {
                        closeConfirmModal('revealConfirmModal');
                        return;
                    }
                }
            });

            // --- INTERCEPTAR CTRL + F ---
            document.addEventListener('keydown', function(e) {
                 if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                    e.preventDefault();
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.select();
                    }
                }
            });

            // Botones principales
            const shuffleBtn = document.getElementById('shuffleBtn');
            if (shuffleBtn) {
                shuffleBtn.addEventListener('click', shuffleCards);
                console.log('Listener añadido a shuffleBtn');
            }
            
            // Listener para el toggle de lógica ---
            document.getElementById('logicSwitch').addEventListener('click', toggleFilterLogic);

                        // --- LISTENERS PARA LOS NUEVOS MODALES ---
                    


            // Listeners RESET
            const resetAppBtn = document.getElementById('resetAppBtn');
            if (resetAppBtn) resetAppBtn.addEventListener('click', openResetConfirmModal);
            
            const cancelResetBtn = document.getElementById('cancelResetBtn');
            if(cancelResetBtn) cancelResetBtn.addEventListener('click', () => closeConfirmModal('resetConfirmModal'));
            
            const confirmResetBtn = document.getElementById('confirmResetBtn');
            if(confirmResetBtn) confirmResetBtn.addEventListener('click', executeReset);
            
            // Cerrar clic fuera RESET
            const resetModal = document.getElementById('resetConfirmModal');
            if(resetModal) {
                resetModal.addEventListener('click', (e) => { if(e.target === resetModal) closeConfirmModal('resetConfirmModal'); });
            }

            // Listeners REVEAL (Aquí está la clave para que funcione el botón)
            const revealAllBtn = document.getElementById('revealAllBtn');
            if (revealAllBtn) revealAllBtn.addEventListener('click', openRevealConfirmModal);

            const cancelRevealBtn = document.getElementById('cancelRevealBtn');
            if(cancelRevealBtn) cancelRevealBtn.addEventListener('click', () => closeConfirmModal('revealConfirmModal'));

            // ESTE ES EL BOTÓN QUE NO TE FUNCIONABA:
            const confirmRevealBtn = document.getElementById('confirmRevealBtn');
            if(confirmRevealBtn) {
                confirmRevealBtn.addEventListener('click', executeRevealAll);
            }

            // Cerrar clic fuera REVEAL
            const revealModal = document.getElementById('revealConfirmModal');
            if(revealModal) {
                revealModal.addEventListener('click', (e) => { if(e.target === revealModal) closeConfirmModal('revealConfirmModal'); });
            }
            
            // Listener para el botón de categorías
            const categoriesBtn = document.getElementById('categoriesBtn');
            if (categoriesBtn) {
                categoriesBtn.addEventListener('click', openCategoriesModal);
            }

            // Listener para cerrar el modal de categorías
            const closeCategoriesModalBtn = document.getElementById('closeCategoriesModal');
            if (closeCategoriesModalBtn) {
                closeCategoriesModalBtn.addEventListener('click', closeCategoriesModal);
            }

            // Listener para el botón de limpiar filtro
            const clearFilterBtn = document.getElementById('clearFilterBtn');
            if (clearFilterBtn) {
                clearFilterBtn.addEventListener('click', clearCategoryFilter);
            }

            // Listener para aplicar filtros
            const applyFiltersBtn = document.getElementById('applyFiltersBtn');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', applyFilters);
            }

            // Listener para limpiar todo
            const clearAllBtn = document.getElementById('clearAllBtn');
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', clearAllCategories);
            }

            // Listener para cerrar modal haciendo clic fuera
            const categoriesModalEl = document.getElementById('categoriesModal');
            if (categoriesModalEl) {
                categoriesModalEl.addEventListener('click', function(e) {
                    if (e.target === categoriesModalEl) {
                        closeCategoriesModal();
                    }
                });
            
            
            }
            
            const addBtn = document.getElementById('addBtn');
            if (addBtn) {
                addBtn.addEventListener('click', openAddModal);
                console.log('Listener añadido a addBtn');
            }
            
            const tierlistBtn = document.getElementById('tierlistBtn');
            if (tierlistBtn) {
                tierlistBtn.addEventListener('click', openTierlistModal);
                console.log('Listener añadido a tierlistBtn');
            }
            
            // Cerrar modales
            const closeModal = document.getElementById('closeModal');
            if (closeModal) {
                closeModal.addEventListener('click', closeModalFunc);
            }
            
            const cancelAddBtn = document.getElementById('cancelAddBtn');
            if (cancelAddBtn) {
                cancelAddBtn.addEventListener('click', closeAddModal);
            }
            
            const closeTierlistModalBtn = document.getElementById('closeTierlistModal');
            if (closeTierlistModalBtn) {
                closeTierlistModalBtn.addEventListener('click', closeTierlistModal);
            }
            
            // Búsqueda
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', searchInfluencers);
            }
            
            // Toggle de fans
            const fansToggle = document.getElementById('fansToggle');
            if (fansToggle) {
                fansToggle.addEventListener('click', toggleFans);
            }
            
            // Formulario de añadir influencer
            const addInfluencerForm = document.getElementById('addInfluencerForm');
            if (addInfluencerForm) {
                addInfluencerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Resetear mensajes de error
                    const nameError = document.getElementById('nameError');
                    const urlError = document.getElementById('urlError');
                    
                    if (nameError) nameError.style.display = 'none';
                    if (urlError) urlError.style.display = 'none';
                    
                    const influencerNameInput = document.getElementById('influencerName');
                    const youtubeUrlInput = document.getElementById('youtubeUrl');
                    
                    if (!influencerNameInput || !youtubeUrlInput) return;
                    
                    const name = influencerNameInput.value.trim();
                    const url = youtubeUrlInput.value.trim();
                    
                    let hasError = false;
                    
                    // Validar nombre
                    if (name.length < 2) {
                        if (nameError) nameError.style.display = 'block';
                        hasError = true;
                    }
                    
                    // Validar URL
                    if (!isValidYouTubeUrl(url)) {
                        if (urlError) urlError.style.display = 'block';
                        hasError = true;
                    }
                    
                    if (!hasError) {
                        addInfluencer(name, url);
                    }
                });
            }
            
            // Event listeners para los tiers en el modal de video
            const tierOptions = document.querySelectorAll('.tier-option');
            tierOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const tier = this.dataset.tier;
                    handleTierSelection(tier);
                });
            });
            
            // Event listeners para edición de tiers
            const editTiersBtn = document.getElementById('editTiersBtn');
            if (editTiersBtn) {
                editTiersBtn.addEventListener('click', openEditTiersModal);
            }
            
            const saveTiersBtn = document.getElementById('saveTiersBtn');
            if (saveTiersBtn) {
                saveTiersBtn.addEventListener('click', saveTierNames);
            }
            
            const resetTiersBtn = document.getElementById('resetTiersBtn');
            if (resetTiersBtn) {
                resetTiersBtn.addEventListener('click', resetTierNames);
            }
            
            const closeEditTiersModalBtn = document.getElementById('closeEditTiersModal');
            if (closeEditTiersModalBtn) {
                closeEditTiersModal.addEventListener('click', closeEditTiersModal);
            }
            
            // Cerrar modales al hacer clic fuera
            const videoModal = document.getElementById('videoModal');
            if (videoModal) {
                videoModal.addEventListener('click', function(e) {
                    if (e.target === videoModal) {
                        closeModalFunc();
                    }
                });
            }
            
            const addModal = document.getElementById('addModal');
            if (addModal) {
                addModal.addEventListener('click', function(e) {
                    if (e.target === addModal) {
                        closeAddModal();
                    }
                });
            }
            
            const tierlistModal = document.getElementById('tierlistModal');
            if (tierlistModal) {
                tierlistModal.addEventListener('click', function(e) {
                    if (e.target === tierlistModal) {
                        closeTierlistModal();
                    }
                });
            }
            
            const editTiersModalEl = document.getElementById('editTiersModal');
            if (editTiersModalEl) {
                editTiersModalEl.addEventListener('click', function(e) {
                    if (e.target === editTiersModalEl) {
                        closeEditTiersModal();
                    }
                });
            }
            
            // Prevenir que el modal se cierre al hacer clic en el video
            const modalVideo = document.getElementById('modalVideo');
            if (modalVideo) {
                modalVideo.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
            
            // --- LOGRO: CLICKER OCULTO ---
            const headerLogo = document.querySelector('.header-logo');
            if (headerLogo) {
                headerLogo.style.cursor = 'pointer';
                headerLogo.addEventListener('click', () => {
                    logoClickCount++;
                    updateAchievement('logo_clicker', logoClickCount);
                    clearTimeout(logoClickTimeout);
                    logoClickTimeout = setTimeout(() => {
                        logoClickCount = 0;
                    }, 500);
                });
            }

            // --- LISTENERS PARA COMPARTIR/IMPORTAR (AÑADIR ESTO) ---
            const shareCodeBtn = document.getElementById('shareCodeBtn');
            if (shareCodeBtn) {
                shareCodeBtn.addEventListener('click', openShareModal);
            }
            
            const closeShareModalBtn = document.getElementById('closeShareModal');
            if (closeShareModalBtn) {
                closeShareModalBtn.addEventListener('click', closeShareModal);
            }
            
            const generateExportBtn = document.getElementById('generateExportBtn');
            if (generateExportBtn) {
                generateExportBtn.addEventListener('click', generateShareCode);
            }

            const copyCodeBtn = document.getElementById('copyCodeBtn');
            if (copyCodeBtn) {
                copyCodeBtn.addEventListener('click', copyShareCode);
            }

            const importCodeBtn = document.getElementById('importCodeBtn');
            if (importCodeBtn) {
                importCodeBtn.addEventListener('click', importShareCode);
            }

            // Cerrar modal al hacer clic fuera
            const shareCodeModal = document.getElementById('shareCodeModal');
            if (shareCodeModal) {
                shareCodeModal.addEventListener('click', function(e) {
                    if (e.target === shareCodeModal) {
                        closeShareModal();
                    }
                });
            }

            console.log('Todos los event listeners configurados');
            
            // LLAMADA A LA FUNCIÓN DE PESTAÑAS AL FINAL
            setupSidebarTabs(); 

                // --- FUNCIÓN MOVIDA: Exportar Tierlist a Imagen ---
        function exportTierlistImage() {
            showNotification('Generando imagen...');
            
            const modalContent = document.querySelector('.tierlist-modal-content');
            const tierlistContainer = modalContent.querySelector('.tierlist-container');

            // Crear un clon para manipularlo sin afectar la vista real
            const clone = modalContent.cloneNode(true);
            const cloneContainer = clone.querySelector('.tierlist-container');
            const cloneActions = clone.querySelector('.tierlist-actions');
            
            // Eliminar botones de acción del clon
            if (cloneActions) cloneActions.remove();
            
            // Estilos para el clon
            clone.style.position = 'absolute';
            clone.style.left = '-9999px';
            clone.style.top = '0';
            clone.style.width = '1200px'; 
            clone.style.height = 'auto';
            clone.style.maxHeight = 'none';
            clone.style.overflow = 'visible';
            clone.style.zIndex = '-1';
            clone.style.borderRadius = '16px';
            clone.style.padding = '20px';

            cloneContainer.style.height = 'auto';
            cloneContainer.style.maxHeight = 'none';
            cloneContainer.style.overflow = 'visible';
            cloneContainer.style.paddingRight = '0';
            
            clone.querySelectorAll('.tier-row').forEach(row => {
                row.style.flexGrow = '0';
                row.style.minHeight = '60px';
            });

            document.body.appendChild(clone);

            html2canvas(clone, {
                backgroundColor: '#1f2937',
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                document.body.removeChild(clone);
                
                const link = document.createElement('a');
                link.download = 'mi-tierlist-cancinfluencers.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                showNotification('✅ ¡Imagen descargada!');
            }).catch(err => {
                document.body.removeChild(clone);
                console.error(err);
                showNotification('❌ Error al generar la imagen');
            });
        }

        // --- FUNCIÓN MOVIDA: Lógica de Pestañas del Sidebar ---
        function setupSidebarTabs() {
            const tabs = document.querySelectorAll('.sidebar-tab-btn');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetId = tab.dataset.tab;
                    
                    // 1. Cambiar estado de botones
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // 2. Cambiar visibilidad de paneles
                    document.querySelectorAll('.tab-panel').forEach(panel => {
                        panel.classList.remove('active');
                    });
                    
                    const targetPanel = document.getElementById(`tab-${targetId}`);
                    if(targetPanel) targetPanel.classList.add('active');

                    // 3. Redibujar gráfica si es necesario
                    if (targetId === 'distribution' && tierlistChart) {
                        setTimeout(() => {
                            tierlistChart.resize();
                        }, 50);
                    }
                });
            });
        }
        }

        function handleSwipe() {
            const threshold = 50; // Mínimo movimiento para considerar swipe
            if (touchEndX < touchStartX - threshold) {
                nextSlide(); // Swipe izquierda -> Siguiente
            }
            if (touchEndX > touchStartX + threshold) {
                prevSlide(); // Swipe derecha -> Anterior
            }
        }

        // Función para configurar drag and drop en la tierlist
        function setupTierlistDragAndDrop() {
            const tierItems = document.querySelectorAll('.tier-items');
            
            tierItems.forEach(tier => {
                tier.addEventListener('dragover', handleDragOver);
                tier.addEventListener('drop', handleDrop);
                tier.addEventListener('dragleave', handleDragLeave);
            });

            // --- LOGRO: EL EXORCISTA (VERSIÓN MEJORADA) ---
            const tierlistModal = document.getElementById('tierlistModal');
            
            if (tierlistModal) {
                // Permitimos soltar en el fondo oscuro del modal
                tierlistModal.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Necesario para permitir el drop
                    // Opcional: Añadir una clase para indicar visualmente que estás "fuera"
                    tierlistModal.classList.add('drag-outside'); 
                });

                tierlistModal.addEventListener('dragleave', (e) => {
                    tierlistModal.classList.remove('drag-outside');
                });

                tierlistModal.addEventListener('drop', (e) => {
                    // Si soltamos el elemento directamente en el fondo oscuro del modal
                    // (y no dentro de la caja blanca '.tierlist-modal-content')
                    if (e.target === tierlistModal) {
                        updateAchievement('exorcist', 1);
                    }
                    tierlistModal.classList.remove('drag-outside');
                });
            }
        }

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
    console.log('Inicializando aplicación...');
    
            // 1. Cargar nombres y colores
            loadCustomTierNames();
            loadCustomTierColors(); // <--- AÑADIR ESTO
            
            // Aplicar colores guardados al iniciar
            applyTierColors(); // <--- AÑADIR ESTO
    
    // 2. CARGAR DATOS DESDE LOCALSTORAGE
    loadInfluencersDataFromLocalStorage(); 
    loadNextIdFromLocalStorage();          
    
    // --- LÓGICA: PRIMERA VISITA VS RECARGA ---
    
    // Si NO hay datos guardados...
    if (!localStorage.getItem('cancinfluencers_mainInfluencersData')) {
        // ...verificamos si es la primera vez histórica
        if (!localStorage.getItem('cancinfluencers_firstVisit')) {
            // CASO 1: PRIMERA VISITA
            mainInfluencersData.sort(() => Math.random() - 0.5);
            saveInfluencersDataToLocalStorage(); // GUARDAMOS EL ORDEN INICIAL
            localStorage.setItem('cancinfluencers_firstVisit', 'true');
        }
        // CASO 2: RESET (datos borrados pero marca existe)
        // No hacemos nada, usa el orden por defecto del código
    }
    // CASO 3: RECARGA (F5) o EXISTEN DATOS
    // loadInfluencersDataFromLocalStorage() ya cargó el orden guardado arriba.
    
    // Sincronizar copia de trabajo
    mainInfluencers = [...mainInfluencersData];
    
    // 3. Cargar resto de datos
    loadRevealedCardsFromLocalStorage();
    loadTierlistDataFromLocalStorage();
    syncInfluencerTiersFromLoadedData();
    
    // 4. Cargar Easter Egg
    loadEasterEgg();
    
    // 5. Cargar Logros (ANTES de los listeners)
    loadAchievements();
            // --- NUEVO: ACTIVAR MODO FIESTA SI PROCEDE ---
            if (isPartyModeActive) {
                document.body.classList.add('party-mode');
                createPersistentConfetti();
            }
            // ----------------------------------------------

    // 6. Configurar listeners
    setupEventListeners();
    
    // 7. Limpiar buscador y Renderizar UI
    const searchInput = document.getElementById('searchInput');
    if (searchInput) searchInput.value = ''; 
    
    renderCards();

    // --- AÑADIR ESTO: Dibujar gráfica al inicio ---
    updateTierlistChart(); 
    // --------------------------------------------

    const fansCount = document.getElementById('fansCount');
    if (fansCount) {
        fansCount.textContent = `${fansInfluencersData.length} canciones disponibles`;
    }
    
    console.log('Aplicación inicializada.');
    });

        // --- FUNCIONES PARA COMPARTIR E IMPORTAR ---

                function openShareModal() {
            // 1. Limpiar el área de texto del código generado
            const exportArea = document.getElementById('exportCodeArea');
            if (exportArea) exportArea.value = '';

            // 2. Restaurar botones a su estado inicial
            const genBtn = document.getElementById('generateExportBtn');
            const copyBtn = document.getElementById('copyCodeBtn');
            if (genBtn) genBtn.style.display = 'block';
            if (copyBtn) copyBtn.style.display = 'none';

            // 3. Limpiar el área de importar
            const importArea = document.getElementById('importCodeArea');
            if (importArea) importArea.value = '';

            // 4. Limpiar área de Match y ocultar resultado
            const matchArea = document.getElementById('matchCodeArea');
            if (matchArea) matchArea.value = '';
            
            const matchResult = document.getElementById('matchResult');
            if (matchResult) matchResult.style.display = 'none';
            // ---------------------------------------

            const shareCodeModal = document.getElementById('shareCodeModal');
            shareCodeModal.style.display = 'flex';
            setTimeout(() => {
                shareCodeModal.classList.add('active');
            }, 10);
        }

        function closeShareModal() {
            const shareCodeModal = document.getElementById('shareCodeModal');
            shareCodeModal.classList.remove('active');
            setTimeout(() => {
                shareCodeModal.style.display = 'none';
            }, 300);
        }

        function generateShareCode() {
            try {
                // Preparamos los datos: solo IDs y nombres personalizados
                const dataToExport = {
                    v: 1, // Versión por si cambias el formato en el futuro
                    t: {
                        s: tierlistData.s.map(i => i.id),
                        a: tierlistData.a.map(i => i.id),
                        b: tierlistData.b.map(i => i.id),
                        c: tierlistData.c.map(i => i.id),
                        d: tierlistData.d.map(i => i.id),
                        f: tierlistData.f.map(i => i.id),
                        unclassified: tierlistData.unclassified.map(i => i.id)
                    },
                    n: customTierNames
                };

                const jsonString = JSON.stringify(dataToExport);
                // Codificación Base64 segura para Unicode (emojis, tildes)
                const base64 = btoa(unescape(encodeURIComponent(jsonString)));
                
                const exportArea = document.getElementById('exportCodeArea');
                const genBtn = document.getElementById('generateExportBtn');
                const copyBtn = document.getElementById('copyCodeBtn');
                
                exportArea.value = base64;
                genBtn.style.display = 'none';
                copyBtn.style.display = 'block';
                
                showNotification('✅ ¡Código generado!');
                        // --- LOGRO: EL EXPORTADOR ---
                        updateAchievement('exporter', 1);
            } catch (e) {
                console.error(e);
                showNotification('❌ Error al generar el código');
            }
        }

        function copyShareCode() {
            const exportArea = document.getElementById('exportCodeArea');
            if (!exportArea.value) {
                showNotification('Primero genera un código');
                return;
            }
            
            navigator.clipboard.writeText(exportArea.value).then(() => {
                showNotification('📋 ¡Código copiado al portapapeles!');
            }).catch(err => {
                console.error('Error al copiar:', err);
                showNotification('Error al copiar');
            });
        }

                function importShareCode() {
            const importArea = document.getElementById('importCodeArea');
            const code = importArea.value.trim();
            
            if (!code) {
                showNotification('❌ Pega un código primero');
                return;
            }

            try {
                // Decodificación Base64 segura
                const jsonString = decodeURIComponent(escape(atob(code)));
                const importedData = JSON.parse(jsonString);

                // Validación básica
                if (!importedData.t || !importedData.n) {
                    throw new Error('Formato inválido');
                }

                // Confirmación
                const confirmImport = confirm("¿Estás seguro? Esto reemplazará tu tierlist actual con la del código importado.");
                if (!confirmImport) return;

                // 1. Resetear tiers en los datos maestros
                [...mainInfluencersData, ...fansInfluencersData].forEach(inf => inf.tier = null);

                // 2. Resetear estructura de datos
                tierlistData = {
                    s: [], a: [], b: [], c: [], d: [], f: [], unclassified: []
                };

                // Variable para guardar los IDs importados
                const importedIds = new Set();

                // 3. Asignar según el código
                const tiers = ['s', 'a', 'b', 'c', 'd', 'f', 'unclassified'];
                
                tiers.forEach(tierKey => {
                    if (importedData.t[tierKey]) {
                        importedData.t[tierKey].forEach(id => {
                            const influencer = findInfluencerById(id);
                            if (influencer) {
                                influencer.tier = tierKey;
                                tierlistData[tierKey].push(influencer);
                                importedIds.add(id); // Guardamos el ID
                            }
                        });
                    }
                });

                // --- NUEVO: REVELAR CARTAS IMPORTADAS ---
                // Marcamos todas las cartas importadas como reveladas
                importedIds.forEach(id => revealedCards.add(id));
                saveRevealedCardsToLocalStorage();
                // ---------------------------------------

                // 4. Aplicar nombres personalizados
                customTierNames = importedData.n;
                saveCustomTierNames();
                updateTierNames();

                // 5. Guardar y actualizar UI
                saveTierlistDataToLocalStorage();
                renderAllTiers(); // Re-renderizar los items en la tierlist
                renderCards(); // <--- IMPORTANTE: Actualizar la cuadrícula principal para mostrarlas reveladas
                updateTierlistStats();
                
                closeShareModal();
                showNotification('🎉 ¡Tierlist importada correctamente!');

            } catch (e) {
                console.error(e);
                showNotification('❌ Código inválido o corrupto');
            }
        }

                // --- FUNCIÓN CALCULADORA DE MATCH ---
        function calculateMatch() {
            const code = document.getElementById('matchCodeArea').value.trim();
            
            if (!code) {
                showNotification('❌ Pega un código para comparar');
                return;
            }

            try {
                // --- LOGRO: TINDER ---
                updateAchievement('tinder', 1);
                // 1. Decodificar código externo
                const jsonString = decodeURIComponent(escape(atob(code)));
                const externalData = JSON.parse(jsonString);

                if (!externalData.t) {
                    throw new Error('Formato inválido');
                }

                // 2. Preparar mapas de datos (ID -> Tier)
                // Mapa local (tu tierlist actual)
                const localMap = {};
                const tiers = ['s', 'a', 'b', 'c', 'd', 'f'];
                
                tiers.forEach(t => {
                    if (tierlistData[t]) {
                        tierlistData[t].forEach(item => {
                            localMap[item.id] = t;
                        });
                    }
                });

                // Mapa externo (el del amigo)
                const externalMap = {};
                tiers.forEach(t => {
                    if (externalData.t[t]) {
                        externalData.t[t].forEach(id => {
                            externalMap[id] = t;
                        });
                    }
                });

                // 3. Calcular coincidencias
                let totalCommon = 0;
                let matches = 0;
                
                // Unimos todos los IDs presentes en ambos mapas
                const allIds = new Set([...Object.keys(localMap), ...Object.keys(externalMap)]);

                allIds.forEach(id => {
                    // Solo comparamos si AMBOS tienen la canción clasificada (ignora 'unclassified')
                    if (localMap[id] && externalMap[id]) {
                        totalCommon++;
                        if (localMap[id] === externalMap[id]) {
                            matches++;
                        }
                    }
                });

                // 4. Mostrar resultado
                const resultDiv = document.getElementById('matchResult');
                const percentageDiv = document.getElementById('matchPercentage');
                const detailsDiv = document.getElementById('matchDetails');
                
                if (totalCommon === 0) {
                    percentageDiv.textContent = "0%";
                    detailsDiv.textContent = "No tienen canciones en común clasificadas.";
                } else {
                    const percentage = Math.round((matches / totalCommon) * 100);
                    percentageDiv.textContent = percentage + "%";
                    
                    let emoji = "🤝";
                    if (percentage > 90) emoji = "💕 Almas Gemelas";
                    else if (percentage > 70) emoji = "❤️ Gran compatibilidad";
                    else if (percentage > 50) emoji = "😊 Buena onda";
                    else if (percentage > 30) emoji = "🤔 Interesante...";
                    else emoji = "😂 Polos opuestos";

                    detailsDiv.textContent = `${emoji} ¡Teneis ${matches} coincidencias de ${totalCommon} canciones en común!`;
                }

                resultDiv.style.display = 'block';

            } catch (e) {
                console.error(e);
                showNotification('❌ Código inválido para comparar');
            }
        }

                // --- FUNCIONES AUXILIARES PARA EFECTOS VISUALES ---

        // 1. Crear Canvas de Confeti Global
        const confettiCanvas = document.createElement('canvas');
        confettiCanvas.id = 'confetti-canvas';
        document.body.appendChild(confettiCanvas);
        const ctx = confettiCanvas.getContext('2d');
        let confettiParticles = [];

        function resizeConfettiCanvas() {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeConfettiCanvas);
        resizeConfettiCanvas();

        // 2. Lógica de Confeti
        function createConfettiParticle() {
            const colors = ['#ff0', '#f0f', '#0ff', '#f00', '#0f0', '#00f', '#ff7f7f', '#ffff7f'];
            return {
                x: Math.random() * confettiCanvas.width,
                // Si el modo fiesta está activo, nacen arriba (-50). Si no, random (para el burst inicial)
                y: isPartyModeActive ? -50 : Math.random() * confettiCanvas.height - confettiCanvas.height,
                size: Math.random() * 10 + 5,
                color: colors[Math.floor(Math.random() * colors.length)],
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 4 - 2,
                rotation: Math.random() * 360,
                rotationSpeed: Math.random() * 10 - 5
            };
        }

                function animateConfetti() {
            ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            
            // --- NUEVO: LLUVIA INFINITA ---
            // Si el modo fiesta está activo, añadimos partículas constantemente
            if (isPartyModeActive) {
                if (Math.random() > 0.85) { // Probabilidad de aparición
                    confettiParticles.push(createConfettiParticle());
                }
            }
            // ------------------------------

            confettiParticles.forEach((p, index) => {
                p.y += p.speedY;
                p.x += p.speedX;
                p.rotation += p.rotationSpeed;
                
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation * Math.PI / 180);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size / 2);
                ctx.restore();

                if (p.y > confettiCanvas.height) {
                    confettiParticles.splice(index, 1);
                }
            });

            // Seguir animando si hay partículas O si el modo fiesta está activo
            if (confettiParticles.length > 0 || isPartyModeActive) {
                requestAnimationFrame(animateConfetti);
            }
        }

        function launchBigConfetti() {
            for (let i = 0; i < 150; i++) {
                confettiParticles.push(createConfettiParticle());
            }
            animateConfetti();
        }

        // 3. Explosión de partículas en una carta específica
        function createCardExplosion(cardElement) {
            const rect = cardElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const colors = ['#FFD700', '#FF4500', '#00FFFF', '#FF69B4', '#7FFF00'];

            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 8 + 4;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 80 + 40; // Distancia
                
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;

                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.backgroundColor = color;
                particle.style.left = `${centerX}px`;
                particle.style.top = `${centerY}px`;
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);
                
                document.body.appendChild(particle);

                setTimeout(() => particle.remove(), 800);
            }
        }

                // --- VARIABLES Y FUNCIONES MODO IMPOSTOR ---
        let impostorGameData = null;

        function openImpostorModal() {
            const modal = document.getElementById('impostorModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
            startImpostorGame();
        }

        function closeImpostorModal() {
            const modal = document.getElementById('impostorModal');
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        }

        function startImpostorGame() {
            // Reset UI
            document.getElementById('impostorResult').style.display = 'none';
            document.getElementById('playAgainImpostorBtn').style.display = 'none';
            
            // 1. Obtener influencers con categorías
            const withCats = mainInfluencersData.filter(inf => inf.categories && inf.categories.length > 0);
            
            // 2. Agrupar por categoría
            const categoryMap = {};
            withCats.forEach(inf => {
                inf.categories.forEach(cat => {
                    if (!categoryMap[cat]) categoryMap[cat] = [];
                    categoryMap[cat].push(inf);
                });
            });

            // 3. Encontrar categoría con al menos 3 miembros
            const validCategories = Object.keys(categoryMap).filter(cat => categoryMap[cat].length >= 3);
            if (validCategories.length === 0) {
                showNotification("No hay suficientes datos para jugar.");
                return;
            }

            // 4. Elegir categoría y grupo
            const chosenCat = validCategories[Math.floor(Math.random() * validCategories.length)];
            const members = categoryMap[chosenCat].sort(() => Math.random() - 0.5);
            const groupOfThree = members.slice(0, 3);

            // 5. Elegir impostor (que NO tenga esa categoría)
            const groupIds = new Set(groupOfThree.map(i => i.id));
            const potentialImpostors = mainInfluencersData.filter(inf => 
                !groupIds.has(inf.id) && (!inf.categories || !inf.categories.includes(chosenCat))
            );

            if (potentialImpostors.length === 0) {
                // Si no encuentra impostor, reiniciar
                return startImpostorGame();
            }

            const impostor = potentialImpostors[Math.floor(Math.random() * potentialImpostors.length)];
            
            // 6. Mezclar los 4
            const gameSet = [...groupOfThree, impostor].sort(() => Math.random() - 0.5);

            // Guardar estado
            impostorGameData = {
                impostorId: impostor.id,
                categoryName: chosenCat,
                influencers: gameSet
            };

            renderImpostorGame();
        }

        function renderImpostorGame() {
            const grid = document.getElementById('impostorGrid');
            grid.innerHTML = '';

            impostorGameData.influencers.forEach(inf => {
                const card = document.createElement('div');
                card.className = 'impostor-card';
                card.dataset.id = inf.id;
                card.innerHTML = `
                    <img src="https://img.youtube.com/vi/${inf.videoId}/mqdefault.jpg" class="impostor-card-image" alt="${inf.name}">
                    <div class="impostor-card-name">${inf.name}</div>
                    <div class="impostor-result-overlay">
                        <span class="impostor-icon"></span>
                        <span style="font-size: 0.8rem; font-weight:bold;"></span>
                    </div>
                `;
                card.addEventListener('click', () => checkImpostorGuess(inf.id, card));
                grid.appendChild(card);
            });
        }

        function checkImpostorGuess(id, cardElement) {
            if (!impostorGameData) return;

            const isCorrect = id === impostorGameData.impostorId;
            
            // Mostrar resultado en las cartas
            document.querySelectorAll('.impostor-card').forEach(card => {
                card.style.pointerEvents = 'none'; // Bloquear clics
                card.classList.add('revealed');
                
                const overlay = card.querySelector('.impostor-result-overlay');
                const icon = overlay.querySelector('.impostor-icon');
                const text = overlay.querySelector('span:last-child');

                if (card.dataset.id == impostorGameData.impostorId) {
                    card.classList.add('correct');
                    icon.textContent = '🤡';
                    text.textContent = '¡IMPOSTOR!';
                } else {
                    card.classList.add('wrong');
                    icon.textContent = '✅';
                    text.textContent = 'Pertenecía';
                }
            });

            // Mostrar panel de resultado
            const resultDiv = document.getElementById('impostorResult');
            const title = document.getElementById('impostorResultTitle');
            const text = document.getElementById('impostorResultText');

            if (isCorrect) {
                title.textContent = "Pertenecía! 🎉";
                title.style.color = "#10b981";
            } else {
                title.textContent = "¡IMPOSTOR! 💀";
                title.style.color = "#ef4444";
            }
            
            text.textContent = `La categoría era: "${impostorGameData.categoryName}". El impostor era ${findInfluencerById(impostorGameData.impostorId).name}.`;
            
            resultDiv.style.display = 'block';
            document.getElementById('playAgainImpostorBtn').style.display = 'block';
        }

                // --- MODO IMPOSTOR (VERSIÓN INFINITA) ---
        
        // Variables de estado
        let currentImpostorData = null;
        let impostorGameActive = false;

        function openImpostorModal() {
            const modal = document.getElementById('impostorModal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
            startImpostorRound(); // Inicia la primera ronda
        }

        function closeImpostorModal() {
            const modal = document.getElementById('impostorModal');
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
            impostorGameActive = false;
        }

        // Inicia una nueva ronda
        function startImpostorRound() {
            impostorGameActive = true;
            
            // Reset UI
            const grid = document.getElementById('impostorGrid');
            grid.innerHTML = '';
            
            document.getElementById('impostorFeedback').style.display = 'none';
            document.getElementById('skipImpostorBtn').style.display = 'block';
            document.getElementById('nextImpostorBtn').style.display = 'none';

            // 1. Obtener influencers con categorías
            const withCats = mainInfluencersData.filter(inf => inf.categories && inf.categories.length > 0);
            if (withCats.length < 4) {
                showNotification("No hay suficientes influencers para jugar.");
                return;
            }

            // 2. Agrupar por categoría
            const categoryMap = {};
            withCats.forEach(inf => {
                inf.categories.forEach(cat => {
                    if (!categoryMap[cat]) categoryMap[cat] = [];
                    categoryMap[cat].push(inf);
                });
            });

            // 3. Encontrar categoría válida (>=3 miembros)
            const validCats = Object.keys(categoryMap).filter(c => categoryMap[c].length >= 3);
            if (validCats.length === 0) return startImpostorRound(); // Retry si falla

            // 4. Selección
            const secretCat = validCats[Math.floor(Math.random() * validCats.length)];
            const members = categoryMap[secretCat].sort(() => Math.random() - 0.5);
            const threeMembers = members.slice(0, 3);

            // 5. Elegir impostor
            const threeIds = new Set(threeMembers.map(i => i.id));
            const impostorPool = mainInfluencersData.filter(inf => 
                !threeIds.has(inf.id) && (!inf.categories || !inf.categories.includes(secretCat))
            );

            if (impostorPool.length === 0) return startImpostorRound(); // Retry

            const impostor = impostorPool[Math.floor(Math.random() * impostorPool.length)];

            // Guardar datos de la ronda
            currentImpostorData = {
                secretCategory: secretCat,
                impostorId: impostor.id,
                influencers: [...threeMembers, impostor].sort(() => Math.random() - 0.5)
            };

            // Renderizar cartas
            currentImpostorData.influencers.forEach(inf => {
                const card = document.createElement('div');
                card.className = 'impostor-card';
                card.dataset.id = inf.id;
                card.innerHTML = `
                    <img src="https://img.youtube.com/vi/${inf.videoId}/mqdefault.jpg" class="impostor-card-image" alt="${inf.name}">
                    <div class="impostor-card-name">${inf.name}</div>
                    <div class="impostor-result-overlay">
                        <span class="impostor-icon"></span>
                        <span style="font-size: 0.9rem; font-weight:bold;"></span>
                    </div>
                `;
                card.onclick = () => handleImpostorGuess(inf.id);
                grid.appendChild(card);
            });
        }

        // Manejar click en carta
        function handleImpostorGuess(id) {
            if (!impostorGameActive) return;
            impostorGameActive = false; // Bloquear más clics

            const isCorrect = id === currentImpostorData.impostorId;
            
            // Revelar todas las cartas
            document.querySelectorAll('.impostor-card').forEach(card => {
                card.classList.add('revealed');
                const overlay = card.querySelector('.impostor-result-overlay');
                const icon = overlay.querySelector('.impostor-icon');
                
                if (card.dataset.id == currentImpostorData.impostorId) {
                    card.classList.add('correct');
                    icon.textContent = '🤡';
                    overlay.querySelector('span:last-child').textContent = 'IMPOSTOR';
                } else {
                    card.classList.add('wrong');
                    icon.textContent = '✅';
                    overlay.querySelector('span:last-child').textContent = 'Pertenecía';
                }
            });

            showImpostorResult(isCorrect, false);
        }

        // Manejar Skip
        function skipImpostorRound() {
            if (!impostorGameActive) return;
            impostorGameActive = false;

            // Revelar respuesta correcta
            document.querySelectorAll('.impostor-card').forEach(card => {
                card.classList.add('revealed');
                if (card.dataset.id == currentImpostorData.impostorId) {
                    card.classList.add('correct');
                    card.querySelector('.impostor-icon').textContent = '🤡';
                    card.querySelector('span:last-child').textContent = 'IMPOSTOR';
                }
            });

            showImpostorResult(false, true);
        }

        // Mostrar panel de resultados
        function showImpostorResult(wasCorrect, wasSkipped) {
            const feedback = document.getElementById('impostorFeedback');
            const catText = document.getElementById('revealCategoryText');
            const msgText = document.getElementById('resultMessage');

            // Revelar categoría SIEMPRE
            catText.textContent = `Categoría: ${currentImpostorData.secretCategory}`;

            if (wasSkipped) {
                msgText.innerHTML = `<span style="color:#9ca3af">¡Saltado! El impostor era <strong>${findInfluencerById(currentImpostorData.impostorId).name}</strong>.</span>`;
            } else if (wasCorrect) {
                msgText.innerHTML = `<span style="color:#10b981">¡Correcto! El impostor era <strong>${findInfluencerById(currentImpostorData.impostorId).name}</strong>.</span>`;
            } else {
                msgText.innerHTML = `<span style="color:#ef4444">¡Fallaste! El impostor era <strong>${findInfluencerById(currentImpostorData.impostorId).name}</strong>.</span>`;
            }

            feedback.style.display = 'block';
            
            // Cambiar botones
            document.getElementById('skipImpostorBtn').style.display = 'none';
            document.getElementById('nextImpostorBtn').style.display = 'block';
        }

          // --- MODO CIEGAS (AUTOMÁTICO + DETECTOR ANUNCIOS) ---
        
        let blindTestData = {
            score: 0,
            currentInfluencer: null,
            timer: null,
            timeLeft: 15,
            roundActive: false
        };
        let blindTestPlayer = null;
        let adCheckInterval = null; // Variable para revisar anuncios

        function openBlindTestModal() {
            const modal = document.getElementById('blindTestModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('active');
                blindTestData.score = 0;
                document.getElementById('blindScore').textContent = '0';
                startBlindRound(); // Inicia automáticamente
            }, 100);
        }

        function closeBlindTestModal() {
            const modal = document.getElementById('blindTestModal');
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
            
            if (blindTestPlayer) {
                blindTestPlayer.destroy();
                blindTestPlayer = null;
            }
            clearInterval(blindTestData.timer);
            clearInterval(adCheckInterval); // Limpiar checker de anuncios
            blindTestData.roundActive = false;
        }

        function startBlindRound() {
            clearInterval(blindTestData.timer);
            clearInterval(adCheckInterval);
            blindTestData.roundActive = false;
            
            // 1. Reset UI
            document.getElementById('adNotification').style.display = 'none';
            document.getElementById('blindTimer').textContent = "15";
            document.getElementById('blindTimer').classList.remove('warning');
            document.getElementById('blindSkipBtn').style.display = 'block';
            document.getElementById('blindNextBtn').style.display = 'none';
            document.getElementById('blindVisualizer').style.opacity = '0.3';
            document.getElementById('blindOptions').innerHTML = '<p style="grid-column: span 2; color:#9ca3af;">Cargando sonido...</p>';

            // 2. Seleccionar influencer
            const randomIndex = Math.floor(Math.random() * mainInfluencersData.length);
            blindTestData.currentInfluencer = mainInfluencersData[randomIndex];

            const options = [blindTestData.currentInfluencer];
            while (options.length < 4) {
                const rand = mainInfluencersData[Math.floor(Math.random() * mainInfluencersData.length)];
                if (!options.find(o => o.id === rand.id)) options.push(rand);
            }
            options.sort(() => Math.random() - 0.5);

            const optionsGrid = document.getElementById('blindOptions');
            optionsGrid.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'blindtest-option';
                btn.textContent = opt.name;
                btn.disabled = true; 
                btn.onclick = () => checkBlindAnswer(opt.id, btn);
                optionsGrid.appendChild(btn);
            });

            // 3. Crear/Usar Player
            if (blindTestPlayer && typeof blindTestPlayer.loadVideoById === 'function') {
                // Si ya existe, cargamos el video
                blindTestPlayer.loadVideoById(blindTestData.currentInfluencer.videoId);
            } else {
                // Si no, creamos el reproductor
                blindTestPlayer = new YT.Player('blindTestPlayer', {
                    height: '100%',
                    width: '100%',
                    videoId: blindTestData.currentInfluencer.videoId,
                    playerVars: {
                        'autoplay': 1,
                        'controls': 0,
                        'showinfo': 0,
                        'rel': 0,
                        'modestbranding': 1,
                        'mute': 1 // IMPORTANTE: Inicia muteado para evitar bloqueos
                    },
                    events: {
                        'onReady': (event) => {
                            // TRUCO: Desmutear inmediatamente
                            event.target.unMute();
                            event.target.playVideo();
                        },
                        'onStateChange': (event) => {
                            // Si el video empieza a sonar (state 1)
                            if (event.data === YT.PlayerState.PLAYING) {
                                blindTestData.roundActive = true;
                                document.getElementById('blindVisualizer').style.opacity = '1';
                                document.querySelectorAll('.blindtest-option').forEach(btn => btn.disabled = false);
                                
                                // Iniciar Timer
                                clearInterval(blindTestData.timer);
                                blindTestData.timeLeft = 15;
                                document.getElementById('blindTimer').textContent = "15";
                                blindTestData.timer = setInterval(() => {
                                    blindTestData.timeLeft--;
                                    document.getElementById('blindTimer').textContent = blindTestData.timeLeft;
                                    if (blindTestData.timeLeft <= 5) document.getElementById('blindTimer').classList.add('warning');
                                    if (blindTestData.timeLeft <= 0) blindTimeOut();
                                }, 1000);

                                // INICIAR DETECTOR DE ANUNCIOS
                                startAdDetector();
                            }
                            
                            // Si el video termina solo (poco probable en 15s)
                            if (event.data === YT.PlayerState.ENDED) {
                                blindTimeOut();
                            }
                        },
                        'onError': (event) => {
                            // Si el video da error, saltamos
                            showNotification("⚠️ Video no disponible, saltando...");
                            skipBlindRound();
                        }
                    }
                });
            }
        }

        // --- DETECTOR DE ANUNCIOS ---
        function startAdDetector() {
            // Limpiamos intervalos previos
            clearInterval(adCheckInterval);
            
            // Revisamos cada 500ms si hay un anuncio
            adCheckInterval = setInterval(() => {
                if (!blindTestPlayer || !blindTestData.roundActive) {
                    clearInterval(adCheckInterval);
                    return;
                }

                try {
                    const adState = blindTestPlayer.getAdState(); // 0: No ad, 1: Ad
                    const currentTime = blindTestPlayer.getCurrentTime();

                    // Si getAdState devuelve 1, hay anuncio
                    if (adState === 1) {
                        handleAdDetected();
                    }
                    
                    // TRUCO ADICIONAL: Si el video lleva 3 segundos sonando pero el tiempo es 0, suele ser anuncio no declarado
                    // (A veces la API no detecta bien el estado 1)
                    if (blindTestData.timeLeft < 12 && currentTime < 1.0) {
                         // Si ya pasaron 3s del timer pero el video no avanza, asumimos anuncio o carga infinita
                         // Comentado para evitar falsos positivos, pero útil a veces:
                         // handleAdDetected(); 
                    }

                } catch (e) {
                    console.log("Ad check failed", e);
                }
            }, 500);
        }

        function handleAdDetected() {
            clearInterval(adCheckInterval);
            document.getElementById('adNotification').style.display = 'block';
            
            // Detenemos todo
            stopBlindAudio();
            clearInterval(blindTestData.timer);
            blindTestData.roundActive = false;
            document.querySelectorAll('.blindtest-option').forEach(btn => btn.disabled = true);

            // Saltamos a la siguiente ronda tras 2 segundos
            setTimeout(() => {
                startBlindRound();
            }, 2000);
        }

        function stopBlindAudio() {
            if (blindTestPlayer && typeof blindTestPlayer.stopVideo === 'function') {
                blindTestPlayer.stopVideo();
            }
        }

        function checkBlindAnswer(id, btnElement) {
            if (!blindTestData.roundActive) return;
            blindTestData.roundActive = false;
            clearInterval(blindTestData.timer);
            clearInterval(adCheckInterval); // Paramos detector
            stopBlindAudio();

            const isCorrect = id === blindTestData.currentInfluencer.id;
            const allBtns = document.querySelectorAll('.blindtest-option');

            allBtns.forEach(btn => {
                btn.disabled = true; 
                if (btn.textContent === blindTestData.currentInfluencer.name) {
                    btn.classList.add('correct');
                } else if (btn === btnElement && !isCorrect) {
                    btn.classList.add('wrong');
                }
            });

            if (isCorrect) {
                const points = Math.max(1, Math.floor(blindTestData.timeLeft));
                blindTestData.score += points;
                document.getElementById('blindScore').textContent = blindTestData.score;
                showNotification(`¡+${points} puntos!`);
            }

            endBlindRound();
        }

        function blindTimeOut() {
            if (!blindTestData.roundActive) return;
            blindTestData.roundActive = false;
            clearInterval(blindTestData.timer);
            clearInterval(adCheckInterval);
            stopBlindAudio();

            const allBtns = document.querySelectorAll('.blindtest-option');
            allBtns.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === blindTestData.currentInfluencer.name) btn.classList.add('correct');
            });
            endBlindRound();
        }

        function skipBlindRound() {
            if (!blindTestData.roundActive) return;
            blindTestData.roundActive = false;
            clearInterval(blindTestData.timer);
            clearInterval(adCheckInterval);
            stopBlindAudio();
            
            const allBtns = document.querySelectorAll('.blindtest-option');
            allBtns.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === blindTestData.currentInfluencer.name) btn.classList.add('correct');
            });
            endBlindRound();
        }

        function endBlindRound() {
            document.getElementById('blindVisualizer').style.opacity = '0.3';
            document.getElementById('blindSkipBtn').style.display = 'none';
            document.getElementById('blindNextBtn').style.display = 'block';
        }

               
    </script>
            <!-- Modal para Sugerencias (Integrado) -->
        <div class="modal" id="suggestionModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">📬 Sugerir Nuevo Influencer</h3>
                    <button class="close-btn" id="closeSuggestionModal">×</button>
                </div>
                <div class="modal-body">
                    <!-- URL de Google Forms Incrustado -->
                    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfHzxYuqJkUPvX2_aE-eznQWpnbGCpPBoDhVnpmrvrer_4xIQ/viewform?embedded=true">Cargando formulario…</iframe>
                </div>
            </div>
        </div>

        <!-- Notificación -->
        <div class="notification" id="notification"></div>

        <!-- Botón flotante de Sugerencias -->
        <button class="suggestion-btn" id="openSuggestionBtn" title="Sugerir un influencer nuevo">
            ✉️
            <span class="suggestion-tooltip">Sugerir influencer</span>
        </button>
            <!-- Modal de Logros -->
    <div class="modal" id="achievementsModal" role="dialog" aria-modal="true">
        <div class="modal-content achievements-modal-content">
            <div class="modal-header">
            <h2 class="modal-title">🏆 <span class="text-gradient">Logros</span></h2>
            <button class="close-btn" id="closeAchievementsModal" aria-label="Cerrar">×</button>
            </div>
            <div class="modal-body">
                <div style="text-align:center;margin-bottom:20px">
                    <div style="font-size:3rem" id="achievementsCount">0/0</div>
                    <p style="color:var(--text-muted)">Logros desbloqueados</p>
                </div>
                <div class="achievements-grid" id="achievementsGrid"></div>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <div style="font-size:3rem" id="achievementPopupIcon"></div>
        <div>
            <h3>Logro Desbloqueado!</h3>
            <p id="achievementPopupName"></p>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

            <!-- Modal de Confirmación: REINICIAR -->
        <div class="modal" id="resetConfirmModal">
            <div class="confirm-modal-content danger">
                <div class="confirm-icon">🗑️</div>
                <h3>¿Reiniciar Progreso?</h3>
                <p>Estás a punto de borrar todo tu avance en esta sesión.</p>
                <ul>
                    <li>Tu tierlist completa</li>
                    <li>Influencers añadidos manualmente</li>
                    <li>Cartas reveladas</li>
                    <li>Logros desbloqueados</li>
                </ul>
                <p class="warning-text"><strong>¡Esta acción no se puede deshacer!</strong></p>
                <div class="confirm-buttons">
                    <button class="btn cancel-btn" id="cancelResetBtn">Cancelar</button>
                    <button class="btn danger-btn" id="confirmResetBtn">Sí, Borrar Todo</button>
                </div>
            </div>
        </div>

        <!-- Modal de Confirmación: REVELAR TODO (Sin texto de partículas) -->
        <div class="modal" id="revealConfirmModal">
            <div class="confirm-modal-content success">
                <div class="confirm-icon">🎁</div>
                <h3>¡Pack Opening Total!</h3>
                <p>Se revelarán <strong>todas</strong> las cartas de golpe.</p>
                <div class="confirm-buttons">
                    <button class="btn cancel-btn" id="cancelRevealBtn">Mejor no</button>
                    <button class="btn success-btn" id="confirmRevealBtn">¡Abrir Pack!</button>
                </div>
            </div>
        </div>

            <!-- Modal para seleccionar Modo de Vista -->
    <div class="modal" id="modesModal">
        <div class="modal-content modes-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Modo de Visualización</h3>
                <button class="close-btn" id="closeModesModal" aria-label="Cerrar">×</button>
            </div>
            <div class="modal-body">
                <p style="color: #9ca3af; margin-bottom: 20px;">Elige cómo quieres ver las cartas</p>
                
                <div class="mode-selector-grid">
                    <!-- Opción Cuadrícula -->
                    <div class="mode-option-card selected" id="modalModeGrid" role="button" tabindex="0">
                        <span class="mode-option-icon">📊</span>
                        <span class="mode-option-label">Cuadrícula</span>
                        <span style="font-size: 0.8rem; color: #9ca3af;">Clásico</span>
                    </div>

                    <!-- Opción Carrusel -->
                    <div class="mode-option-card" id="modalModeCarousel" role="button" tabindex="0">
                        <span class="mode-option-icon">📱</span>
                        <span class="mode-option-label">Carrusel</span>
                        <span style="font-size: 0.8rem; color: #9ca3af;">Estilo Swipe</span>
                    </div>

                                    <!-- AÑADE ESTE TERCER BOTÓN DENTRO DE .mode-selector-grid -->
                <div class="mode-option-card" id="modalModeImpostor" role="button" tabindex="0">
                    <span class="mode-option-icon">🕵️</span>
                    <span class="mode-option-label">Impostor</span>
                    <span style="font-size: 0.8rem; color: #9ca3af;">Minijuego</span>
                </div>

                                <!-- Opción Ciegas -->
                <div class="mode-option-card" id="modalModeBlindTest" role="button" tabindex="0">
                    <span class="mode-option-icon">🎧</span>
                    <span class="mode-option-label">Ciegas</span>
                    <span style="font-size: 0.8rem; color: #9ca3af;">Blind Test</span>
                </div>
            </div>
            </div>
        </div>
    </div>

        <!-- Modal para el Juego Ciegas (Blind Test) -->
    <div class="modal" id="blindTestModal">
        <div class="modal-content blindtest-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🎧 Modo Ciegas</h3>
                <button class="close-btn" id="closeBlindTestModal" aria-label="Cerrar">×</button>
            </div>
            
            <div class="modal-body" style="position: relative; min-height: 400px;">
                
                <!-- UI del Juego -->
                <div style="position: relative; z-index: 2;">
                    
                    <!-- Notificación de Anuncio (Oculto por defecto) -->
                    <div id="adNotification" style="display:none; background: rgba(239, 68, 68, 0.2); border:1px solid #ef4444; color:#fca5a5; padding:10px; border-radius:8px; margin-bottom:10px; text-align:center;">
                        ⚠️ Anuncio detectado. Saltando canción automáticamente...
                    </div>

                    <div class="blindtest-status">
                        <div class="blindtest-score">Puntos: <span id="blindScore">0</span></div>
                        <div class="blindtest-timer" id="blindTimer">15</div>
                    </div>

                    <!-- Visualizador -->
                    <div class="blindtest-visualizer" id="blindVisualizer">
                        <div class="blindtest-bar" style="animation-delay: 0.1s"></div>
                        <div class="blindtest-bar" style="animation-delay: 0.3s"></div>
                        <div class="blindtest-bar" style="animation-delay: 0.2s"></div>
                        <div class="blindtest-bar" style="animation-delay: 0.4s"></div>
                        <div class="blindtest-bar" style="animation-delay: 0.1s"></div>
                    </div>

                    <div class="blindtest-options" id="blindOptions"></div>

                    <div class="blindtest-controls">
                        <button class="blindtest-btn skip" id="blindSkipBtn">Saltar</button>
                        <button class="blindtest-btn next" id="blindNextBtn" style="display:none;">Siguiente ➡️</button>
                    </div>
                </div>

                <!-- Player Invisible -->
                <div id="blindTestPlayer" class="blindtest-player-hidden"></div>
            </div>
        </div>
    </div>
</div>
    </div>
</body>
</html>
